

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Supported schedulers &mdash; AiiDA 1.2.1 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
        <script src="../_static/togglebutton.js"></script>
        <script src="../_static/contentui.js"></script>
        <script >var togglebuttonSelector = '.toggle';</script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/togglebutton.css" type="text/css" />
  <link rel="stylesheet" href="../_static/contentui.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> AiiDA
          

          
          </a>

          
            
            
              <div class="version">
                1.2
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../intro/about.html">What is AiiDA</a></li>
<li class="toctree-l1"><a class="reference internal" href="../intro/get_started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../intro/installation.html">Advanced Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../intro/troubleshooting.html">Troubleshooting</a></li>
</ul>
<p class="caption"><span class="caption-text">Tutorial</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../tutorial/placeholder.html">Placeholder</a></li>
</ul>
<p class="caption"><span class="caption-text">How-To Guides</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../howto/placeholder.html">Placeholder</a></li>
</ul>
<p class="caption"><span class="caption-text">Topics</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../topics/placeholder.html">Placeholder</a></li>
</ul>
<p class="caption"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../reference/placeholder.html">Placeholder</a></li>
</ul>
<p class="caption"><span class="caption-text">Plugins</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../plugins/placeholder.html">Placeholder</a></li>
</ul>
<p class="caption"><span class="caption-text">Development</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../development/placeholder.html">Placeholder</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">AiiDA</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
      <li>Supported schedulers</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/scheduler/index.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="supported-schedulers">
<span id="my-reference-to-scheduler"></span><h1>Supported schedulers<a class="headerlink" href="#supported-schedulers" title="Permalink to this headline">¶</a></h1>
<p>The list below describes the supported <em>schedulers</em>, i.e. the batch job schedulers that manage the job queues and execution on any given computer.</p>
<div class="section" id="pbspro">
<h2>PBSPro<a class="headerlink" href="#pbspro" title="Permalink to this headline">¶</a></h2>
<p>The <a class="reference external" href="http://www.pbsworks.com/Product.aspx?id=1">PBSPro</a> scheduler is supported (and it has been tested with version 12.1).</p>
<p>All the main features are supported with this scheduler.</p>
<p>The <a class="reference internal" href="#job-resources"><span class="std std-ref">JobResource</span></a> class to be used when setting the job resources is the <a class="reference internal" href="#nodenumberjobresource"><span class="std std-ref">NodeNumberJobResource (PBS-like)</span></a>.</p>
</div>
<div class="section" id="slurm">
<h2>SLURM<a class="headerlink" href="#slurm" title="Permalink to this headline">¶</a></h2>
<p>The <a class="reference external" href="https://slurm.schedmd.com/">SLURM</a> scheduler is supported (and it has been tested with version 2.5.4).</p>
<p>All the main features are supported with this scheduler.</p>
<p>The <a class="reference internal" href="#job-resources"><span class="std std-ref">JobResource</span></a> class to be used when setting the job resources is the <a class="reference internal" href="#nodenumberjobresource"><span class="std std-ref">NodeNumberJobResource (PBS-like)</span></a>.</p>
</div>
<div class="section" id="sge">
<h2>SGE<a class="headerlink" href="#sge" title="Permalink to this headline">¶</a></h2>
<p>The <a class="reference external" href="https://en.wikipedia.org/wiki/Oracle_Grid_Engine">SGE</a> scheduler (Sun Grid Engine, now called Oracle Grid Engine)
is supported (and it has been tested with version GE 6.2u3),
together with some of the main variants/forks.</p>
<p>All the main features are supported with this scheduler.</p>
<p>The <a class="reference internal" href="#job-resources"><span class="std std-ref">JobResource</span></a> class to be used when setting the job resources is the <a class="reference internal" href="#parenvjobresource"><span class="std std-ref">ParEnvJobResource (SGE-like)</span></a>.</p>
</div>
<div class="section" id="lsf">
<h2>LSF<a class="headerlink" href="#lsf" title="Permalink to this headline">¶</a></h2>
<p>The IBM <a class="reference external" href="https://www-01.ibm.com/support/knowledgecenter/SSETD4_9.1.3/lsf_welcome.html">LSF</a> scheduler is supported and has been tested with version 9.1.3
on the CERN <cite>lxplus</cite> cluster.</p>
</div>
<div class="section" id="torque">
<h2>Torque<a class="headerlink" href="#torque" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="http://www.adaptivecomputing.com/products/open-source/torque/">Torque</a> (based on OpenPBS) is supported (and it has been tested with Torque v.2.4.16 from Ubuntu).</p>
<p>All the main features are supported with this scheduler.</p>
<p>The <a class="reference internal" href="#job-resources"><span class="std std-ref">JobResource</span></a> class to be used when setting the job resources is the <a class="reference internal" href="#nodenumberjobresource"><span class="std std-ref">NodeNumberJobResource (PBS-like)</span></a>.</p>
</div>
<div class="section" id="direct-execution-bypassing-schedulers">
<h2>Direct execution (bypassing schedulers)<a class="headerlink" href="#direct-execution-bypassing-schedulers" title="Permalink to this headline">¶</a></h2>
<p>The direct scheduler, to be used mainly for debugging, is an implementation of a scheduler plugin that does not require a real scheduler installed, but instead directly executes a command, puts it in the background, and checks for its process ID (PID) to discover if the execution is completed.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The direct execution mode is very fragile. Currently, it spawns a separate Bash shell to execute a job and track each shell by process ID (PID). This poses following problems:</p>
<ul class="simple">
<li><p>PID numeration is reset during reboots;</p></li>
<li><p>PID numeration is different from machine to machine, thus direct execution is <em>not</em> possible in multi-machine clusters, redirecting each SSH login to a different node in round-robin fashion;</p></li>
<li><p>there is no real queueing, hence, all calculation started will be run in parallel.</p></li>
</ul>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Direct execution bypasses schedulers, so it should be used with care in order not to disturb the functioning of machines.</p>
</div>
<p>All the main features are supported with this scheduler.</p>
<p>The <a class="reference internal" href="#job-resources"><span class="std std-ref">JobResource</span></a> class to be used when setting the job resources is the <a class="reference internal" href="#nodenumberjobresource"><span class="std std-ref">NodeNumberJobResource (PBS-like)</span></a></p>
</div>
</div>
<div class="section" id="job-resources">
<span id="id6"></span><h1>Job resources<a class="headerlink" href="#job-resources" title="Permalink to this headline">¶</a></h1>
<p>When asking a scheduler to allocate some nodes/machines for a given job, we have to specify some job resources, such as the number of required nodes or the numbers of MPI processes per node.</p>
<p>Unfortunately, the way of specifying this information is different on different clusters. In AiiDA, this is implemented in different subclasses of the <a class="reference internal" href="../apidoc/aiida.schedulers.html#aiida.schedulers.datastructures.JobResource" title="aiida.schedulers.datastructures.JobResource"><code class="xref py py-class docutils literal notranslate"><span class="pre">aiida.schedulers.datastructures.JobResource</span></code></a> class. The subclass that should be used is given by the scheduler, as described in the previous section.</p>
<p>The interfaces of these subclasses are not all exactly the same. Instead, specifying the resources is similar to writing a scheduler script.  All classes define at least one method, <a class="reference internal" href="../apidoc/aiida.schedulers.html#aiida.schedulers.datastructures.JobResource.get_tot_num_mpiprocs" title="aiida.schedulers.datastructures.JobResource.get_tot_num_mpiprocs"><code class="xref py py-meth docutils literal notranslate"><span class="pre">get_tot_num_mpiprocs</span></code></a>, that returns the total number of MPI processes requested.</p>
<p>In the following, the different <a class="reference internal" href="../apidoc/aiida.schedulers.html#aiida.schedulers.datastructures.JobResource" title="aiida.schedulers.datastructures.JobResource"><code class="xref py py-class docutils literal notranslate"><span class="pre">JobResource</span></code></a> subclasses are described:</p>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#nodenumberjobresource-pbs-like" id="id7">NodeNumberJobResource (PBS-like)</a></p></li>
<li><p><a class="reference internal" href="#parenvjobresource-sge-like" id="id8">ParEnvJobResource (SGE-like)</a></p></li>
</ul>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>you can manually load a <cite>specific</cite> <a class="reference internal" href="../apidoc/aiida.schedulers.html#aiida.schedulers.datastructures.JobResource" title="aiida.schedulers.datastructures.JobResource"><code class="xref py py-class docutils literal notranslate"><span class="pre">JobResource</span></code></a> subclass by directly importing it, e..g.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">aiida.schedulers.datastructures</span> <span class="kn">import</span> <span class="n">NodeNumberJobResource</span>
</pre></div>
</div>
<p>However, in general, you will pass the fields to set directly in the <code class="docutils literal notranslate"><span class="pre">metadata.options</span></code> input dictionary of the <a class="reference internal" href="../apidoc/aiida.engine.processes.calcjobs.html#aiida.engine.processes.calcjobs.calcjob.CalcJob" title="aiida.engine.processes.calcjobs.calcjob.CalcJob"><code class="xref py py-class docutils literal notranslate"><span class="pre">CalcJob</span></code></a>.
For instance:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">aiida.orm</span> <span class="kn">import</span> <span class="n">load_code</span>

<span class="c1"># This example assumes that the computer is configured to use a scheduler with job resources of type :py:class:`~aiida.schedulers.datastructures.NodeNumberJobResource`</span>
<span class="n">inputs</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;code&#39;</span><span class="p">:</span> <span class="n">load_code</span><span class="p">(</span><span class="s1">&#39;somecode@localhost&#39;</span><span class="p">),</span>  <span class="c1"># The configured code to be used, which also defines the computer</span>
    <span class="s1">&#39;metadata&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;options&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;resources&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;num_machines&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;num_mpiprocs_per_machine&#39;</span><span class="p">:</span> <span class="mi">16</span><span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="nodenumberjobresource-pbs-like">
<span id="nodenumberjobresource"></span><h2><a class="toc-backref" href="#id7">NodeNumberJobResource (PBS-like)</a><a class="headerlink" href="#nodenumberjobresource-pbs-like" title="Permalink to this headline">¶</a></h2>
<p>This is the way of specifying the job resources in PBS and SLURM. The class is <a class="reference internal" href="../apidoc/aiida.schedulers.html#aiida.schedulers.datastructures.NodeNumberJobResource" title="aiida.schedulers.datastructures.NodeNumberJobResource"><code class="xref py py-class docutils literal notranslate"><span class="pre">NodeNumberJobResource</span></code></a>.</p>
<p>Once an instance of the class is obtained, you have the following fields that you can set:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">res.num_machines</span></code>: specify the number of machines (also called nodes) on which the code should run</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">res.num_mpiprocs_per_machine</span></code>: number of MPI processes to use on each machine</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">res.tot_num_mpiprocs</span></code>: the total number of MPI processes that this job is requesting</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">res.num_cores_per_machine</span></code>: specify the number of cores to use on each machine</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">res.num_cores_per_mpiproc</span></code>: specify the number of cores to run each MPI process</p></li>
</ul>
<p>Note that you need to specify only two among the first three fields above, but they have to be defined upon construction, for instance:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">res</span> <span class="o">=</span> <span class="n">NodeNumberJobResource</span><span class="p">(</span><span class="n">num_machines</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">num_mpiprocs_per_machine</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
</pre></div>
</div>
<p>asks the scheduler to allocate 4 machines, with 16 MPI processes on each machine. This will automatically ask for a total of <code class="docutils literal notranslate"><span class="pre">4*16=64</span></code> total number of MPI processes.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you specify res.num_machines, res.num_mpiprocs_per_machine, and res.tot_num_mpiprocs fields (not recommended), make sure that they satisfy:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">res</span><span class="o">.</span><span class="n">num_machines</span> <span class="o">*</span> <span class="n">res</span><span class="o">.</span><span class="n">num_mpiprocs_per_machine</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">tot_num_mpiprocs</span>
</pre></div>
</div>
<p>Moreover, if you specify <code class="docutils literal notranslate"><span class="pre">res.tot_num_mpiprocs</span></code>, make sure that this is a multiple of <code class="docutils literal notranslate"><span class="pre">res.num_machines</span></code> and/or <code class="docutils literal notranslate"><span class="pre">res.num_mpiprocs_per_machine</span></code>.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>When creating a new computer, you will be asked for a <code class="docutils literal notranslate"><span class="pre">default_mpiprocs_per_machine</span></code>. If you specify it, then you can avoid to specify <code class="docutils literal notranslate"><span class="pre">num_mpiprocs_per_machine</span></code> when creating the resources for that computer, and the default number will be used.</p>
<p>Of course, all the requirements between <code class="docutils literal notranslate"><span class="pre">num_machines</span></code>, <code class="docutils literal notranslate"><span class="pre">num_mpiprocs_per_machine</span></code> and <code class="docutils literal notranslate"><span class="pre">tot_num_mpiprocs</span></code> still apply.</p>
<p>Moreover, you can explicitly specify <code class="docutils literal notranslate"><span class="pre">num_mpiprocs_per_machine</span></code> if you want to use a value different from the default one.</p>
</div>
<p>The num_cores_per_machine and num_cores_per_mpiproc fields are optional. If you specify num_mpiprocs_per_machine and num_cores_per_machine fields, make sure that:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">res</span><span class="o">.</span><span class="n">num_cores_per_mpiproc</span> <span class="o">*</span> <span class="n">res</span><span class="o">.</span><span class="n">num_mpiprocs_per_machine</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">num_cores_per_machine</span>
</pre></div>
</div>
<p>If you want to specifiy single value in num_mpiprocs_per_machine and  num_cores_per_machine, please make sure that res.num_cores_per_machine is multiple of res.num_cores_per_mpiproc and/or res.num_mpiprocs_per_machine.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In PBSPro, the num_mpiprocs_per_machine and num_cores_per_machine fields are used for mpiprocs and ppn respectively.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In Torque, the num_mpiprocs_per_machine field is used for ppn unless the num_mpiprocs_per_machine is specified.</p>
</div>
</div>
<div class="section" id="parenvjobresource-sge-like">
<span id="parenvjobresource"></span><h2><a class="toc-backref" href="#id8">ParEnvJobResource (SGE-like)</a><a class="headerlink" href="#parenvjobresource-sge-like" title="Permalink to this headline">¶</a></h2>
<p>In SGE and similar schedulers, one has to specify a <em>parallel environment</em> and the <em>total number of CPUs</em> requested. The class is <a class="reference internal" href="../apidoc/aiida.schedulers.html#aiida.schedulers.datastructures.ParEnvJobResource" title="aiida.schedulers.datastructures.ParEnvJobResource"><code class="xref py py-class docutils literal notranslate"><span class="pre">ParEnvJobResource</span></code></a>.</p>
<p>Once an instance of the class is obtained, you have the following fields that you can set:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">res.parallel_env</span></code>: specify the parallel environment in which you want to run your job (a string)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">res.tot_num_mpiprocs</span></code>: the total number of MPI processes that this job is requesting</p></li>
</ul>
<p>Remember to always specify both fields. No checks are done on the consistency between the specified parallel environment and the total number of MPI processes requested (for instance, some parallel environments may have been configured by your cluster administrator to run on a single machine). It is your responsibility to make sure that the information is valid, otherwise the  submission will fail.</p>
<p>Some examples:</p>
<ul>
<li><p>setting the fields directly in the class constructor:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">res</span> <span class="o">=</span> <span class="n">ParEnvJobResource</span><span class="p">(</span><span class="n">parallel_env</span><span class="o">=</span><span class="s1">&#39;mpi&#39;</span><span class="p">,</span> <span class="n">tot_num_mpiprocs</span><span class="o">=</span><span class="mi">64</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p>even better, you will pass the fields to set directly in the <code class="docutils literal notranslate"><span class="pre">metadata.options</span></code> input dictionary of the <a class="reference internal" href="../apidoc/aiida.engine.processes.calcjobs.html#aiida.engine.processes.calcjobs.calcjob.CalcJob" title="aiida.engine.processes.calcjobs.calcjob.CalcJob"><code class="xref py py-class docutils literal notranslate"><span class="pre">CalcJob</span></code></a>.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">inputs</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;metadata&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;options&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="n">resources</span><span class="s1">&#39;, {&#39;</span><span class="n">parallel_env</span><span class="s1">&#39;: &#39;</span><span class="n">mpi</span><span class="s1">&#39;, &#39;</span><span class="n">tot_num_mpiprocs</span><span class="s1">&#39;: 64}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
</ul>
</div>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, ECOLE POLYTECHNIQUE FEDERALE DE LAUSANNE (Theory and Simulation of Materials (THEOS) and National Centre for Computational Design and Discovery of Novel Materials (NCCR MARVEL)), Switzerland and ROBERT BOSCH LLC, USA. All rights reserved

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>