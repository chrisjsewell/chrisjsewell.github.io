

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Setup a code &mdash; AiiDA 1.2.1 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
        <script src="../_static/togglebutton.js"></script>
        <script src="../_static/contentui.js"></script>
        <script >var togglebuttonSelector = '.toggle';</script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/togglebutton.css" type="text/css" />
  <link rel="stylesheet" href="../_static/contentui.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> AiiDA
          

          
          </a>

          
            
            
              <div class="version">
                1.2
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../intro/about.html">What is AiiDA</a></li>
<li class="toctree-l1"><a class="reference internal" href="../intro/get_started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../intro/installation.html">Advanced Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../intro/troubleshooting.html">Troubleshooting</a></li>
</ul>
<p class="caption"><span class="caption-text">Tutorial</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../tutorial/placeholder.html">Placeholder</a></li>
</ul>
<p class="caption"><span class="caption-text">How-To Guides</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../howto/placeholder.html">Placeholder</a></li>
</ul>
<p class="caption"><span class="caption-text">Topics</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../topics/placeholder.html">Placeholder</a></li>
</ul>
<p class="caption"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../reference/placeholder.html">Placeholder</a></li>
</ul>
<p class="caption"><span class="caption-text">Plugins</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../plugins/placeholder.html">Placeholder</a></li>
</ul>
<p class="caption"><span class="caption-text">Development</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../development/placeholder.html">Placeholder</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">AiiDA</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
      <li>Setup a code</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/get_started/codes.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="setup-a-code">
<span id="setup-code"></span><h1>Setup a code<a class="headerlink" href="#setup-a-code" title="Permalink to this headline">¶</a></h1>
<p>Once you have at least one computer configured, you can configure the codes.
In AiiDA, for full reproducibility of each calculation, we store each code in
the database, and attach to each calculation a given code. This has the further
advantage to make very easy to query for all calculations that were run with
a given code (for instance because I am looking for phonon calculations, or
because I discovered that a specific version had a bug and I want to rerun
the calculations).</p>
<p>In AiiDA, we distinguish two types of codes: <strong>remote</strong> codes and <strong>local</strong> codes,
where the distinction between the two is described here below.</p>
<div class="section" id="remote-codes">
<h2>Remote codes<a class="headerlink" href="#remote-codes" title="Permalink to this headline">¶</a></h2>
<p>With remote codes we denote codes that are installed/compiled
on the remote computer. Indeed, this is very often the case for codes installed
in supercomputers for high-performance computing applications, because the
code is typically installed and optimized on the supercomputer.</p>
<p>In AiiDA, a remote code is identified by two mandatory pieces of information:</p>
<ul class="simple">
<li><p>A computer on which the code is (that must be a previously configured computer);</p></li>
<li><p>The absolute path of the code executable on the remote computer.</p></li>
</ul>
</div>
<div class="section" id="local-codes">
<h2>Local codes<a class="headerlink" href="#local-codes" title="Permalink to this headline">¶</a></h2>
<p>With local codes we denote codes for which the code is not
already present on the remote machine, and must be copied for every submission.
This is the case if you have for instance a small, machine-independent Python
script that you did not copy previously in all your clusters.</p>
<p>In AiiDA, a local code can be set up by specifying:</p>
<ul class="simple">
<li><p>A folder, containing all files to be copied over at every submission</p></li>
<li><p>The name of executable file among the files inside the folder specified above</p></li>
</ul>
</div>
<div class="section" id="setting-up-a-code">
<h2>Setting up a code<a class="headerlink" href="#setting-up-a-code" title="Permalink to this headline">¶</a></h2>
<p>The:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">verdi</span> <span class="n">code</span>
</pre></div>
</div>
<p>command allows to manage codes in AiiDA.</p>
<p>To setup a new code, you execute:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">verdi</span> <span class="n">code</span> <span class="n">setup</span>
</pre></div>
</div>
<p>and you will be guided through a process to setup your code.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>The setup will ask you a few pieces of information. At every prompt, you can
type the <code class="docutils literal notranslate"><span class="pre">?</span></code> character and press <code class="docutils literal notranslate"><span class="pre">&lt;enter&gt;</span></code> to get a more detailed
explanation of what is being asked.</p>
</div>
<p>You will be asked for:</p>
<ul class="simple">
<li><p><strong>Label</strong>:  A label to refer to this code. Note: this label is not enforced
to be unique. However, if you try to keep it unique, at least within
the same computer, you can use it later
to refer and use to your code. Otherwise, you need to remember its <code class="docutils literal notranslate"><span class="pre">ID</span></code> or <code class="docutils literal notranslate"><span class="pre">UUID</span></code>.</p></li>
<li><p><strong>Description</strong>: A human-readable description of this code (for instance “Quantum
Espresso v.5.0.2 with 5.0.3 patches, pw.x code, compiled with openmpi”).</p></li>
<li><p><strong>Default calculation input plugin</strong>: A string that identifies the default input plugin to
be used to generate new calculations to use with this code.
This string has to be a valid string recognized by the <code class="docutils literal notranslate"><span class="pre">CalculationFactory</span></code>
function. To get the list of all available Calculation plugin strings,
use the <code class="docutils literal notranslate"><span class="pre">verdi</span> <span class="pre">plugin</span> <span class="pre">list</span> <span class="pre">aiida.calculations</span></code> command.</p></li>
<li><p><strong>Installed on target computer</strong>: either True (for local codes) or False (for remote
codes). For the meaning of the distinction, see above. Depending
on your choice, you will be asked for:</p>
<ul>
<li><p>REMOTE CODES:</p>
<ul>
<li><p><strong>Remote computer name</strong>: The computer name on which the code resides,
as configured and stored in the AiiDA database.</p></li>
<li><p><strong>Remote absolute path</strong>: The (full) absolute path of the code executable
on the remote machine, <em>including the name of the executable</em>.</p></li>
</ul>
</li>
<li><p>LOCAL CODES:</p>
<ul>
<li><p><strong>Local directory containing the code</strong>: The absolute path where the executable and all other
files needed to run the code are stored; these will be copied over to
the remote computers for every submitted calculation.</p></li>
<li><p><strong>Relative path of executable inside code folder</strong>: The relative path of the executable
file inside the folder entered in the previous step.</p></li>
</ul>
</li>
</ul>
</li>
</ul>
<p>At the end of these steps, you will be prompted to edit a script,
and you will have the opportunity to include <code class="docutils literal notranslate"><span class="pre">bash</span></code> commands that will
be executed <em>before</em> running the submission script (after the
‘pre execution script’ lines) and <em>after</em> running the submission script
(after the ‘Post execution script’ separator).
This is intended for code-dependent settings, for instance to load modules or set variables
that are needed by the code. For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">module</span> <span class="n">load</span> <span class="n">intelmpi</span>
</pre></div>
</div>
<p>At the end, you will get a confirmation command, and also the ID of the code in the
database (the <code class="docutils literal notranslate"><span class="pre">pk</span></code>, i.e. the principal key, and the <code class="docutils literal notranslate"><span class="pre">uuid</span></code>).</p>
<p>In a manner analogous to a computer setup, it is also possible to provide some (or all) the information
described above via a configuration file using</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">verdi</span> <span class="n">code</span> <span class="n">setup</span> <span class="o">--</span><span class="n">config</span> <span class="n">code</span><span class="o">.</span><span class="n">yml</span>
</pre></div>
</div>
<p>where <code class="docutils literal notranslate"><span class="pre">code.yml</span></code> is a configuration file in the
<a class="reference external" href="https://en.wikipedia.org/wiki/YAML#Syntax">YAML format</a>.</p>
<p>This file contains the information in a series of key:value pairs:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nn">---</span>
<span class="nt">label</span><span class="p">:</span> <span class="s">&quot;qe-6.3-pw&quot;</span>
<span class="nt">description</span><span class="p">:</span> <span class="s">&quot;quantum_espresso</span><span class="nv"> </span><span class="s">v6.3&quot;</span>
<span class="nt">input_plugin</span><span class="p">:</span> <span class="s">&quot;quantumespresso.pw&quot;</span>
<span class="nt">on_computer</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="nt">remote_abs_path</span><span class="p">:</span> <span class="s">&quot;/path/to/code/pw.x&quot;</span>
<span class="nt">computer</span><span class="p">:</span> <span class="s">&quot;localhost&quot;</span>
<span class="nt">prepend_text</span><span class="p">:</span> <span class="p p-Indicator">|</span>
  <span class="no">module load module1</span>
  <span class="no">module load module2</span>
<span class="nt">append_text</span><span class="p">:</span> <span class="s">&quot;</span><span class="nv"> </span><span class="s">&quot;</span>
</pre></div>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>The keys mirror the available options of the command, which you can print using:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">verdi</span> <span class="n">code</span> <span class="n">setup</span> <span class="o">--</span><span class="n">help</span>
</pre></div>
</div>
<p>Note the syntax differences: remove the <code class="docutils literal notranslate"><span class="pre">--</span></code> prefix
and replace <code class="docutils literal notranslate"><span class="pre">-</span></code> within the keys by the underscore <code class="docutils literal notranslate"><span class="pre">_</span></code>.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Codes are a subclass of the <a class="reference internal" href="../apidoc/aiida.orm.nodes.html#aiida.orm.nodes.Node" title="aiida.orm.nodes.Node"><code class="xref py py-class docutils literal notranslate"><span class="pre">Node</span></code></a> class,
and as such you can attach any set of attributes to the code. These can
be extremely useful for querying: for instance, you can attach the version
of the code as an attribute, or the code family (for instance: “pw.x code of
Quantum Espresso”) to later query for all runs done with a pw.x code and
version more recent than 5.0.0, for instance.  However, in the
present AiiDA version you cannot add attributes from the command line using
<code class="docutils literal notranslate"><span class="pre">verdi</span></code>, but you have to do it using Python code.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You can change the label of a code by using the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">verdi</span> <span class="n">code</span> <span class="n">relabel</span> <span class="s2">&quot;ID&quot;</span> <span class="s2">&quot;new-label&quot;</span>
</pre></div>
</div>
<p>(Without the quotation marks!) “ID” can either be the numeric ID (PK) of
the code (preferentially), or possibly its label (or <code class="docutils literal notranslate"><span class="pre">label&#64;computername</span></code>),
if this string uniquely identifies a code.</p>
<p>You can also list all available codes (and their relative IDs) with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">verdi</span> <span class="n">code</span> <span class="nb">list</span>
</pre></div>
</div>
<p>which also accepts some flags to filter only codes on a
given computer, only codes using a specific plugin, etc.; use the <code class="docutils literal notranslate"><span class="pre">-h</span></code>
command line option to see the documentation of all possible options.</p>
<p>You can then get the information of a specific code with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">verdi</span> <span class="n">code</span> <span class="n">show</span> <span class="s2">&quot;ID&quot;</span>
</pre></div>
</div>
<p>Finally, to delete a code use:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">verdi</span> <span class="n">code</span> <span class="n">delete</span> <span class="s2">&quot;ID&quot;</span>
</pre></div>
</div>
<p>(only if it wasn’t used by any calculation, otherwise an exception
is raised).</p>
</div>
<p>And now, you are ready to launch your calculations!</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, ECOLE POLYTECHNIQUE FEDERALE DE LAUSANNE (Theory and Simulation of Materials (THEOS) and National Centre for Computational Design and Discovery of Novel Materials (NCCR MARVEL)), Switzerland and ROBERT BOSCH LLC, USA. All rights reserved

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>