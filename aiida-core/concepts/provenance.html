

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Graph concept &mdash; AiiDA 1.2.1 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
        <script src="../_static/togglebutton.js"></script>
        <script src="../_static/contentui.js"></script>
        <script >var togglebuttonSelector = '.toggle';</script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/togglebutton.css" type="text/css" />
  <link rel="stylesheet" href="../_static/contentui.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> AiiDA
          

          
          </a>

          
            
            
              <div class="version">
                1.2
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../intro/about.html">What is AiiDA</a></li>
<li class="toctree-l1"><a class="reference internal" href="../intro/get_started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../intro/installation.html">Advanced Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../intro/troubleshooting.html">Troubleshooting</a></li>
</ul>
<p class="caption"><span class="caption-text">Tutorial</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../tutorial/placeholder.html">Placeholder</a></li>
</ul>
<p class="caption"><span class="caption-text">How-To Guides</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../howto/placeholder.html">Placeholder</a></li>
</ul>
<p class="caption"><span class="caption-text">Topics</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../topics/placeholder.html">Placeholder</a></li>
</ul>
<p class="caption"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../reference/placeholder.html">Placeholder</a></li>
</ul>
<p class="caption"><span class="caption-text">Plugins</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../plugins/placeholder.html">Placeholder</a></li>
</ul>
<p class="caption"><span class="caption-text">Development</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../development/placeholder.html">Placeholder</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">AiiDA</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
      <li>Graph concept</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/concepts/provenance.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="graph-concept">
<span id="concepts-provenance"></span><h1>Graph concept<a class="headerlink" href="#graph-concept" title="Permalink to this headline">¶</a></h1>
<div class="section" id="nodes-and-links">
<h2>Nodes and links<a class="headerlink" href="#nodes-and-links" title="Permalink to this headline">¶</a></h2>
<p>The two most important concepts in AiiDA are <strong>data</strong> and <strong>processes</strong>.
The former are pieces of data, such as a simple integer or float, all the way to more complex data concepts such as a dictionary of parameters, a folder of files or a crystal structure.
Processes operate on this data in order to produce new data.</p>
<p>Processes come in two different forms:</p>
<ul class="simple">
<li><p><strong>Calculations</strong> are processes that are able to <strong>create</strong> new data. This is the case, for instance, for externals simulation codes, that generate new data</p></li>
<li><p><strong>Workflows</strong> are processes that <strong>orchestrate</strong> other workflows and calculations, i.e. they manage the logical flow, being able to <strong>call</strong> other processes. Workflows have data inputs, but cannot generate new data. They can only return data that is already in the database (one typical case is to return data created by a calculation they called).</p></li>
</ul>
<p>Data and processes are represented in the AiiDA provenance graph as the <strong>nodes</strong> of that graph.
The graph edges are referred to as <strong>links</strong> and come in different forms:</p>
<ul class="simple">
<li><p><strong>input</strong> links: connect data nodes to the process nodes that used them as input, both calculations and workflows</p></li>
<li><p><strong>create</strong> links: connect calculation nodes to the data nodes that they created</p></li>
<li><p><strong>return</strong> links: connect workflow nodes to the data nodes that they returned</p></li>
<li><p><strong>call</strong> links: connecting workflow nodes to the process nodes that they directly called, be it calculations or workflows</p></li>
</ul>
<p>Note that the <strong>create</strong> and <strong>return</strong> links are often collectively referred to as <strong>output</strong> links.</p>
</div>
<div class="section" id="data-provenance-and-logical-provenance">
<h2>Data provenance and logical provenance<a class="headerlink" href="#data-provenance-and-logical-provenance" title="Permalink to this headline">¶</a></h2>
<p>AiiDA automatically stores entities in its database and links them forming a <strong>directed graph</strong>.
This directed graph automatically tracks the <strong>provenance</strong> of all data produced by calculations or returned by workflows.
By tracking the provenance in this way, one can always fully retrace how a particular piece of data came into existence, thus ensuring its reproducibility.</p>
<p>In particular, we define two types of provenance:</p>
<ul class="simple">
<li><p>The <strong>data provenance</strong>, consisting of the part of the graph that <em>only</em> consists of data and calculations (i.e. without considering workflows), and only the <strong>input</strong> and <strong>create</strong> links that connect them. The data provenance records the full history of how data has been generated. Due to the causality principle, the data provenance part of the graph is a <strong>directed acyclic graph</strong> (DAG), i.e. its nodes are connected by directed edges and it does not contain any cycles.</p></li>
<li><p>The <strong>logical provenance</strong> which consists of workflow and data nodes, together with the <strong>input</strong>, <strong>return</strong> and <strong>call</strong> links that connect them. The logical provenance is <em>not</em> acyclic, e.g. a workflow that acts as a filter can return one of its own inputs, directly introducing a cycle.</p></li>
</ul>
<p>The data provenance is essentially a log of which calculation generated what data using certain inputs.
The data provenance alone already guarantees reproducibility (one could run again one by one the calculations with the provided input and would obtain the same outputs).
The logical provenance gives additional information on why a specific calculation was run.
Imagine the case in which you start from 100 structures, you have a filter operation that picks one, and then you run a simulation on it.
The data provenance only shows the simulation you run on the structure that was picked, while the logical provenance can also show that the specific structure was not picked at random but via a specific workflow logic.</p>
</div>
<div class="section" id="other-entities">
<h2>Other entities<a class="headerlink" href="#other-entities" title="Permalink to this headline">¶</a></h2>
<p>Beside nodes (data and processes), AiiDA defines a few more entities, like a <a class="reference internal" href="../apidoc/aiida.orm.html#aiida.orm.computers.Computer" title="aiida.orm.computers.Computer"><code class="xref py py-class docutils literal notranslate"><span class="pre">Computer</span></code></a> (representing a computer, supercomputer or computer cluster where calculations are run or data is stored), a <a class="reference internal" href="../apidoc/aiida.orm.html#aiida.orm.groups.Group" title="aiida.orm.groups.Group"><code class="xref py py-class docutils literal notranslate"><span class="pre">Group</span></code></a> (that group nodes together for organizational purposes) and the <a class="reference internal" href="../apidoc/aiida.orm.html#aiida.orm.users.User" title="aiida.orm.users.User"><code class="xref py py-class docutils literal notranslate"><span class="pre">User</span></code></a> (to keep track of the user who first generated a given node, computer or group).</p>
<p>In the following section we describe in more detail how the general provenance concepts above are actually implemented in AiiDA, with specific reference to the python classes that implement them and the class-inheritance relationships.</p>
</div>
</div>
<div class="section" id="implementation">
<span id="concepts-provenance-implementation"></span><h1>Implementation<a class="headerlink" href="#implementation" title="Permalink to this headline">¶</a></h1>
<div class="section" id="graph-nodes">
<h2>Graph nodes<a class="headerlink" href="#graph-nodes" title="Permalink to this headline">¶</a></h2>
<p>The <strong>nodes</strong> of the AiiDA provenance graph can be grouped into two main <strong>types</strong>: <strong>process nodes</strong> (<code class="docutils literal notranslate"><span class="pre">ProcessNode</span></code>), that represent the execution of calculations or workflows, and <strong>data nodes</strong> (<code class="docutils literal notranslate"><span class="pre">Data</span></code>), that represent pieces of data.</p>
<p>In particular, <strong>process nodes</strong> are divided into two sub categories:</p>
<blockquote>
<div><ul>
<li><p><strong>calculation nodes</strong> (<code class="docutils literal notranslate"><span class="pre">CalculationNode</span></code>): Represent code execution that creates new data. These are further subdivided in two subclasses:</p>
<blockquote>
<div><ul class="simple">
<li><p><a class="reference internal" href="../apidoc/aiida.orm.nodes.process.calculation.html#aiida.orm.nodes.process.calculation.calcjob.CalcJobNode" title="aiida.orm.nodes.process.calculation.calcjob.CalcJobNode"><code class="xref py py-class docutils literal notranslate"><span class="pre">CalcJobNode</span></code></a>: Represents the execution of a calculation external to AiiDA, typically via a job batch scheduler (see the concept of <a class="reference internal" href="calculations.html#concepts-calcjobs"><span class="std std-ref">calculation jobs</span></a>).</p></li>
<li><p><a class="reference internal" href="../apidoc/aiida.orm.nodes.process.calculation.html#aiida.orm.nodes.process.calculation.calcfunction.CalcFunctionNode" title="aiida.orm.nodes.process.calculation.calcfunction.CalcFunctionNode"><code class="xref py py-class docutils literal notranslate"><span class="pre">CalcFunctionNode</span></code></a>: Represents the execution of a python function (see the concept of <a class="reference internal" href="calculations.html#concepts-calcfunctions"><span class="std std-ref">calculation functions</span></a>).</p></li>
</ul>
</div></blockquote>
</li>
<li><p><strong>workflow nodes</strong> (<code class="docutils literal notranslate"><span class="pre">WorkflowNode</span></code>): Represent python code that orchestrates the execution of other workflows and calculations, that optionally return the data created by the processes they called. These are further subdivided in two subclasses:</p>
<blockquote>
<div><ul class="simple">
<li><p><a class="reference internal" href="../apidoc/aiida.orm.nodes.process.workflow.html#aiida.orm.nodes.process.workflow.workchain.WorkChainNode" title="aiida.orm.nodes.process.workflow.workchain.WorkChainNode"><code class="xref py py-class docutils literal notranslate"><span class="pre">WorkChainNode</span></code></a>: Represents the execution of a python class instance with built-in checkpoints, such that the process may be paused/stopped/resumed (see the concept of <a class="reference internal" href="workflows.html#concepts-workchains"><span class="std std-ref">work chains</span></a>).</p></li>
<li><p><a class="reference internal" href="../apidoc/aiida.orm.nodes.process.workflow.html#aiida.orm.nodes.process.workflow.workfunction.WorkFunctionNode" title="aiida.orm.nodes.process.workflow.workfunction.WorkFunctionNode"><code class="xref py py-class docutils literal notranslate"><span class="pre">WorkFunctionNode</span></code></a>: Represents the execution of a python function calling other processes (see the concept of <a class="reference internal" href="workflows.html#concepts-workfunctions"><span class="std std-ref">work functions</span></a>).</p></li>
</ul>
</div></blockquote>
</li>
</ul>
</div></blockquote>
<p>The class hierarchy of the process nodes is shown in the figure below.</p>
<div class="figure align-default" id="id4">
<span id="fig-provenance-class-hierarchy"></span><img alt="../_images/class_hierarchy.png" src="../_images/class_hierarchy.png" />
<p class="caption"><span class="caption-text">The hierarchy of the ORM classes for the process nodes. Only instances of the lowest level of classes will actually enter into the provenance graph. The two upper levels have a mostly taxonomical purpose as they allow us to refer to multiple classes at once when reasoning about the graph as well as a place to define common functionality (see section on <a class="reference internal" href="processes.html#concepts-processes"><span class="std std-ref">processes</span></a>).</span><a class="headerlink" href="#id4" title="Permalink to this image">¶</a></p>
</div>
<p>For what concerns data nodes, the base class (<code class="docutils literal notranslate"><span class="pre">Data</span></code>) is subclassed to provide functionalities specific to the data type and python methods to operate on it.
Often, the name of the subclass contains the word “Data” appended to it, but this is not a requirement. A few examples:</p>
<ul class="simple">
<li><p><a class="reference internal" href="../apidoc/aiida.orm.nodes.data.html#aiida.orm.nodes.data.float.Float" title="aiida.orm.nodes.data.float.Float"><code class="xref py py-class docutils literal notranslate"><span class="pre">Float</span></code></a>, <a class="reference internal" href="../apidoc/aiida.orm.nodes.data.html#aiida.orm.nodes.data.int.Int" title="aiida.orm.nodes.data.int.Int"><code class="xref py py-class docutils literal notranslate"><span class="pre">Int</span></code></a>, <a class="reference internal" href="../apidoc/aiida.orm.nodes.data.html#aiida.orm.nodes.data.bool.Bool" title="aiida.orm.nodes.data.bool.Bool"><code class="xref py py-class docutils literal notranslate"><span class="pre">Bool</span></code></a>, <a class="reference internal" href="../apidoc/aiida.orm.nodes.data.html#aiida.orm.nodes.data.str.Str" title="aiida.orm.nodes.data.str.Str"><code class="xref py py-class docutils literal notranslate"><span class="pre">Str</span></code></a>, <a class="reference internal" href="../apidoc/aiida.orm.nodes.data.html#aiida.orm.nodes.data.list.List" title="aiida.orm.nodes.data.list.List"><code class="xref py py-class docutils literal notranslate"><span class="pre">List</span></code></a>, …</p></li>
<li><p><a class="reference internal" href="../apidoc/aiida.orm.nodes.data.html#aiida.orm.nodes.data.dict.Dict" title="aiida.orm.nodes.data.dict.Dict"><code class="xref py py-class docutils literal notranslate"><span class="pre">Dict</span></code></a>: represents a dictionary of key-value pairs - these are parameters of a general nature that do not need to belong to more specific data sub-classes</p></li>
<li><p><a class="reference internal" href="../apidoc/aiida.orm.nodes.data.html#aiida.orm.nodes.data.structure.StructureData" title="aiida.orm.nodes.data.structure.StructureData"><code class="xref py py-class docutils literal notranslate"><span class="pre">StructureData</span></code></a>: represents crystal structure data (containing chemical symbols, atomic positions of the atoms, periodic cell for periodic structures, …)</p></li>
<li><p><a class="reference internal" href="../apidoc/aiida.orm.nodes.data.array.html#aiida.orm.nodes.data.array.array.ArrayData" title="aiida.orm.nodes.data.array.array.ArrayData"><code class="xref py py-class docutils literal notranslate"><span class="pre">ArrayData</span></code></a>: represents generic numerical arrays of data (python numpy arrays)</p></li>
<li><p><a class="reference internal" href="../apidoc/aiida.orm.nodes.data.array.html#aiida.orm.nodes.data.array.kpoints.KpointsData" title="aiida.orm.nodes.data.array.kpoints.KpointsData"><code class="xref py py-class docutils literal notranslate"><span class="pre">KpointsData</span></code></a>: represents a numerical array of k-points data, is a sub-class of <code class="docutils literal notranslate"><span class="pre">ArrayData</span></code></p></li>
</ul>
<p>For more detailed information see <a class="reference internal" href="../datatypes/index.html#datatypes"><span class="std std-ref">AiiDA data types</span></a>.</p>
<p>In the next section we introduce the links between nodes, creating the AiiDA graph, and then we show some examples to clarify what we introduced up to now.</p>
</div>
<div class="section" id="graph-links">
<h2>Graph links<a class="headerlink" href="#graph-links" title="Permalink to this headline">¶</a></h2>
<p>Process nodes are connected to their input and output data nodes through directed links.
Calculation processes can <em>create</em> data, while workflow processes can <em>call</em> calculations and <em>return</em> their outputs.
Consider the following graph example, where we represent <strong>data nodes</strong> with circles, <strong>calculation nodes</strong> with squares and <strong>workflow nodes</strong> with diamond shapes.</p>
<div class="figure align-default" id="id5">
<span id="fig-provenance-simple-workflow"></span><img alt="../_images/schematic_provenance_01_simple_workflow.png" src="../_images/schematic_provenance_01_simple_workflow.png" />
<p class="caption"><span class="caption-text">Simple provenance graph for a workflow (W<sub>1</sub>) <em>calling</em> a calculation (C<sub>1</sub>). The workflow takes a single <strong>data node</strong> (D<sub>1</sub>) as input, and passes it to the calculation when <em>calling</em> it. The calculation <em>creates</em> a new <strong>data node</strong> (D<sub>2</sub>) that is also <em>returned</em> by the <strong>workflow node</strong>.</span><a class="headerlink" href="#id5" title="Permalink to this image">¶</a></p>
</div>
<p>Notice that the different style and names for the two links coming into D<sub>2</sub> is intentional, because it was the calculation that <em>created</em> the new data, whereas the workflow merely <em>returned</em> it.
This subtle distinction has big consequences.
By allowing workflow processes to <em>return</em> data, it can also <em>return</em> data that was among its inputs.</p>
<div class="figure align-default" id="id6">
<span id="fig-provenance-cycle"></span><img alt="../_images/schematic_provenance_02_cycle.png" src="../_images/schematic_provenance_02_cycle.png" />
<p class="caption"><span class="caption-text">Provenance graph example of a <strong>workflow node</strong> that receives three <strong>data nodes</strong> as input and <em>returns</em> one of those inputs. The input link from D<sub>3</sub> to W<sub>1</sub> and the return link from W<sub>1</sub> to D<sub>3</sub> introduce a cycle in the graph.</span><a class="headerlink" href="#id6" title="Permalink to this image">¶</a></p>
</div>
<p>A scenario like this, represented in <code class="xref std std-numref docutils literal notranslate"><span class="pre">fig_provenance_cycle</span></code>, would create a cycle in the provenance graph, breaking the “acyclicity” of the DAG.
To restore the directed acyclic graph, we separate the entire provenance graph into two planes as described above: the <strong>data provenance</strong> and the <strong>logical provenance</strong>.
With this division, the acyclicity of the graph is restored in the data provenance plane.</p>
<p>An additional benefit of thinking of the provenance graph in these two planes, is that it allows you to inspect it with different layers of granularity.
Imagine a high level workflow that calls a large number of calculations and sub-workflows, that each may also call more sub-processes, to finally produce and return one or more data nodes as its result.</p>
</div>
<div class="section" id="graph-examples">
<h2>Graph examples<a class="headerlink" href="#graph-examples" title="Permalink to this headline">¶</a></h2>
<p>With these basic definitions of AiiDA’s provenance graph in place, let’s take a look at some examples.
Consider the sequence of computations that adds two numbers <cite>x</cite> and <cite>y</cite>, and then multiplies the result with a third number <cite>z</cite>.
This sequence as represented in the provenance graph would look something like what is shown in <code class="xref std std-numref docutils literal notranslate"><span class="pre">fig_provenance_add_multiply_data</span></code>.</p>
<div class="figure align-default" id="id7">
<span id="fig-provenance-add-multiply-data"></span><img alt="../_images/add_multiply_calcfunction_data.png" src="../_images/add_multiply_calcfunction_data.png" />
<p class="caption"><span class="caption-text">The DAG for computing <cite>(x+y)*z</cite>. We have two simple calculations: C<sub>1</sub> represents the addition and C<sub>2</sub> the multiplication.
The two data nodes D<sub>1</sub> and D<sub>2</sub> are the inputs of C<sub>1</sub>, which <em>creates</em> the data node D<sub>4</sub>.
Together with D<sub>3</sub>, D<sub>4</sub> then forms the input of C<sub>2</sub>, which multiplies their values that <em>creates</em> the product, represented by D<sub>5</sub>.</span><a class="headerlink" href="#id7" title="Permalink to this image">¶</a></p>
</div>
<p>In this simple example, there was no external process that controlled the exact sequence of these operations.
This may be imagined however, by adding a workflow that calls the two calculations in succession, as shown in <code class="xref std std-numref docutils literal notranslate"><span class="pre">fig_provenance_add_multiply_full</span></code>.</p>
<div class="figure align-default" id="id8">
<span id="fig-provenance-add-multiply-full"></span><img alt="../_images/add_multiply_calcfunction_full.png" src="../_images/add_multiply_calcfunction_full.png" />
<p class="caption"><span class="caption-text">The same calculation <cite>(x+y)*z</cite> is performed using a workflow. Here the data nodes D<sub>1</sub>, D<sub>2</sub>, and D<sub>3</sub> are the inputs of the workflow W<sub>1</sub>, which <em>calls</em> calculation C<sub>1</sub> with inputs D<sub>1</sub> and D<sub>2</sub>.
It then <em>calls</em> calculation C<sub>2</sub>, using as inputs D<sub>3</sub> and D<sub>4</sub> (which was <em>created</em> by C<sub>2</sub>).
Calculation C<sub>2</sub> <em>creates</em> data node D<sub>5</sub>, which is finally <em>returned</em> by workflow W<sub>1</sub>.</span><a class="headerlink" href="#id8" title="Permalink to this image">¶</a></p>
</div>
<p>Notice that if we were to omit the workflow nodes and all its links from the provenance graph in <code class="xref std std-numref docutils literal notranslate"><span class="pre">fig_provenance_add_multiply_full</span></code>, one would end up with the exact same graph as shown in <code class="xref std std-numref docutils literal notranslate"><span class="pre">fig_provenance_add_multiply_data</span></code> (the <strong>data provenance</strong> graph).</p>
</div>
</div>
<div class="section" id="consistency">
<span id="id1"></span><h1>Consistency<a class="headerlink" href="#consistency" title="Permalink to this headline">¶</a></h1>
<p>Because of the very nature of scientific research, it becomes indispensable to be able to both delete parts of a database (e.g., if errors are made, inputs are misspelled, or useless calculations are performed) or export it (for collaboration or publication purposes).
Both these features, which are provided by AiiDA, have one aspect in common: they can easily lead to a provenance graph with incomplete information.
To better understand why, let’s take a look at the following basic provenance graph:</p>
<div class="figure align-default" id="delexp-example01a">
<img alt="../_images/delexp_example01a.png" src="../_images/delexp_example01a.png" />
</div>
<p>Even in this simple case, if we were to export only the calculation node and the output data node (or, equivalently, delete just the input data node), then we would have lost part of the critical information needed to run the calculation (the D<sub>1</sub> node), thus losing the reproducibility of the calculation C<sub>1</sub>.
In this simple case, therefore, in order to have a consistent provenance, whenever you export a calculation node you must also import <em>all</em> of its input nodes (or, symmetrically, whenever you delete a data node you must also delete all calculations that used it as an input).</p>
<p>This is just one of the many rules that must be considered when trying to manually edit a provenance database.
The key message to remember is that AiiDA will not only delete or export the nodes explicitly targeted by the user, but will also include any other nodes that are needed for keeping a consistent provenance in the resulting database.</p>
<p>It is also worth noting that if you do successive exports of partial information, AiiDA will be able to reconstruct links that might have been broken when dividing the data for export.
So if you first where to export the previous graph, and then you exported the next section of your full database:</p>
<div class="figure align-default" id="delexp-example01b">
<img alt="../_images/delexp_example01b.png" src="../_images/delexp_example01b.png" />
</div>
<p>Then AiiDA will be able to automatically identify the shared node D<sub>2</sub> and connect both sections back together during the import process.
For this kind of recognition it doesn’t matter which sub-graph was exported first.</p>
<p>In the following section we will explain in more detail the criteria for including other nodes and the corresponding traversal rules.</p>
<div class="section" id="traversal-rules">
<h2>Traversal Rules<a class="headerlink" href="#traversal-rules" title="Permalink to this headline">¶</a></h2>
<p>When you run <code class="docutils literal notranslate"><span class="pre">verdi</span> <span class="pre">node</span> <span class="pre">delete</span> <span class="pre">[NODE_IDS]</span></code> or <code class="docutils literal notranslate"><span class="pre">verdi</span> <span class="pre">export</span> <span class="pre">create</span> <span class="pre">-N</span> <span class="pre">[NODE_IDS]</span></code>, AiiDA will look at the links incoming or outgoing from the nodes that you specified and decide if there are other nodes that are critical to keep.</p>
<p>For this decision, it is not only important to consider the type of link, but also if we are following it along its direction (we will call this <code class="docutils literal notranslate"><span class="pre">forward</span></code> direction) or in the reversed direction (<code class="docutils literal notranslate"><span class="pre">backward</span></code> direction).
To clarify this, in the example above, when deleting data node D<sub>1</sub>, AiiDA will follow the <code class="docutils literal notranslate"><span class="pre">input_calc</span></code> link in the <code class="docutils literal notranslate"><span class="pre">forward</span></code> direction (in this case, it will decide that the linked node (C<sub>1</sub>) must then also be deleted).
If the initial target node was, instead, C<sub>1</sub> the <code class="docutils literal notranslate"><span class="pre">input_calc</span></code> link would be followed in the <code class="docutils literal notranslate"><span class="pre">backward</span></code> direction (and in this case the node D<sub>1</sub> will not be deleted, as we will explain below).</p>
<p>This process will be repeated recursively for every node that has just been included for deletion or export, until no more nodes need to be added.
The rules defining whether a linked node should be added or not to the delete/export list (based on the kind and direction of the link) are called <em>traversal rules</em>.
In the following section we will describe these rules both for the export and delete procedures.</p>
<p>The tables below are grouped according to the type of nodes and links involved.
We also provide illustrations of the cases considered, where the encircled node is the one being targeted, and the other node (to which the red arrow is pointing) is the one that is being considered for addition into the delete/export list.</p>
<div class="section" id="data-and-calculation-nodes">
<h3>Data and Calculation Nodes<a class="headerlink" href="#data-and-calculation-nodes" title="Permalink to this headline">¶</a></h3>
<p>The first example above already discusses the case of deleting an input node: in this case, it is necessary to also delete any calculation that uses it as an input.</p>
<p>In AiiDA, we apply the same criterion also when deleting an output: in this case, we follow the <code class="docutils literal notranslate"><span class="pre">create</span></code> link in the <code class="docutils literal notranslate"><span class="pre">backward</span></code> direction and we mark for deletion also the calculation that created it.
The reason for this is that a calculation with missing outputs could be misleading. For instance, some calculations produce optional outputs depending on the combination of input flags that are used.
A missing output might be interpreted as if that piece of information was not computed by the calculation.
In the case of export, the rules are typically the reverse of those used for deletion.
Therefore, in this case, the following rule applies: when exporting a calculation node, all its input data nodes and created output nodes must be exported as well.</p>
<p>On the other hand, when exporting a data node, users typically do not need to also export all the calculations that used it as an input.
These may represent further work that, by default, does not need to be exported as well (unless explicitly specified by the user in the list of nodes).
Equivalently, when deleting a calculation, one typically wants to keep its inputs, as they might be used by other unrelated calculations.</p>
<p>What should happen instead for the outputs of a calculation to be deleted?
Often, one might want to delete (recursively) all the outputs generated by it.
However, we leave the option to users to just delete the calculation, keeping its outputs in the database.
While we emphasize that this operation removes all provenance information for the output nodes, there are cases in which this is useful or even needed (removal of inputs that are protected by copyright, or creating a smaller export file to transfer to collaborators who want to work with the output data).</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 27%" />
<col style="width: 14%" />
<col style="width: 30%" />
<col style="width: 29%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Illustrative diagram (explicitly targeted
node is encircled)</p></th>
<th class="head"><p>Name of Rule</p></th>
<th class="head"><p>Behavior when exporting target node</p></th>
<th class="head"><p>Behavior when deleting target node</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><a class="reference internal image-reference" href="../_images/delexp_caseDC1.png"><img alt="../_images/delexp_caseDC1.png" src="../_images/delexp_caseDC1.png" style="width: 196.79999999999998px; height: 77.39999999999999px;" /></a>
</td>
<td><p><code class="docutils literal notranslate"><span class="pre">input_calc_forward</span></code></p></td>
<td><ul class="simple">
<li><p>Default Value: <code class="docutils literal notranslate"><span class="pre">False</span></code></p></li>
<li><p>Linked node <strong>won’t</strong> be exported <strong>by default</strong>.</p></li>
</ul>
</td>
<td><ul class="simple">
<li><p>Fixed Value: <code class="docutils literal notranslate"><span class="pre">True</span></code></p></li>
<li><p>Linked node <strong>will always</strong> be deleted.</p></li>
</ul>
</td>
</tr>
<tr class="row-odd"><td><a class="reference internal image-reference" href="../_images/delexp_caseDC2.png"><img alt="../_images/delexp_caseDC2.png" src="../_images/delexp_caseDC2.png" style="width: 196.79999999999998px; height: 77.39999999999999px;" /></a>
</td>
<td><p><code class="docutils literal notranslate"><span class="pre">input_calc_backward</span></code></p></td>
<td><ul class="simple">
<li><p>Fixed Value: <code class="docutils literal notranslate"><span class="pre">True</span></code></p></li>
<li><p>Linked node <strong>will always</strong> be exported.</p></li>
</ul>
</td>
<td><ul class="simple">
<li><p>Fixed Value: <code class="docutils literal notranslate"><span class="pre">False</span></code> <a class="footnote-reference brackets" href="#f01" id="id2">1</a></p></li>
<li><p>Linked node <strong>will never</strong> be deleted.</p></li>
</ul>
</td>
</tr>
<tr class="row-even"><td><a class="reference internal image-reference" href="../_images/delexp_caseCD1.png"><img alt="../_images/delexp_caseCD1.png" src="../_images/delexp_caseCD1.png" style="width: 196.79999999999998px; height: 77.39999999999999px;" /></a>
</td>
<td><p><code class="docutils literal notranslate"><span class="pre">create_forward</span></code></p></td>
<td><ul class="simple">
<li><p>Fixed Value: <code class="docutils literal notranslate"><span class="pre">True</span></code></p></li>
<li><p>Linked node <strong>will always</strong> be exported.</p></li>
</ul>
</td>
<td><ul class="simple">
<li><p>Default Value: <code class="docutils literal notranslate"><span class="pre">True</span></code></p></li>
<li><p>Linked node <strong>will</strong> be deleted <strong>by default</strong>.</p></li>
</ul>
</td>
</tr>
<tr class="row-odd"><td><a class="reference internal image-reference" href="../_images/delexp_caseCD2.png"><img alt="../_images/delexp_caseCD2.png" src="../_images/delexp_caseCD2.png" style="width: 201.6px; height: 79.2px;" /></a>
</td>
<td><p><code class="docutils literal notranslate"><span class="pre">create_backward</span></code></p></td>
<td><ul class="simple">
<li><p>Default Value: <code class="docutils literal notranslate"><span class="pre">True</span></code>.</p></li>
<li><p>Linked node <strong>will</strong> be exported <strong>by default</strong>.</p></li>
</ul>
</td>
<td><ul class="simple">
<li><p>Fixed Value: <code class="docutils literal notranslate"><span class="pre">True</span></code></p></li>
<li><p>Linked node <strong>will always</strong> be deleted.</p></li>
</ul>
</td>
</tr>
</tbody>
</table>
<dl class="footnote brackets">
<dt class="label" id="f01"><span class="brackets"><a class="fn-backref" href="#id2">1</a></span></dt>
<dd><p>Although we provide the option to automatically export all calculations that use as input any targeted data node (by specifying <code class="docutils literal notranslate"><span class="pre">input_calc_forward=True</span></code>) we <em>currently</em> do not provide the reciprocal option to delete all the data node inputs when targeting calculation nodes.
This is mainly for the potential danger that would imply automatically enabling upwards traversal of the data provenance when deleting, which would make it extremely hard to predict or control the nodes that will be ultimately affected.</p>
</dd>
</dl>
</div>
<div class="section" id="data-and-workflow-nodes">
<h3>Data and Workflow Nodes<a class="headerlink" href="#data-and-workflow-nodes" title="Permalink to this headline">¶</a></h3>
<p>The behavior when considering <code class="docutils literal notranslate"><span class="pre">input_work</span></code> links is exactly the same as when considering <code class="docutils literal notranslate"><span class="pre">input_calc</span></code> links for the same reasons.
The case for <code class="docutils literal notranslate"><span class="pre">return</span></code> links is partially similar to the one for <code class="docutils literal notranslate"><span class="pre">create</span></code> one.
Indeed, it isn’t desirable to have a resulting database with missing outputs, so when exporting a workflow the returned data nodes will also be included (and when deleting a data node, the returning workflow will also be removed).
However, when exporting a returned node, the default behavior is <em>not</em> to traverse backwards through the <code class="docutils literal notranslate"><span class="pre">return</span></code> links, since a data node might be returned by several unrelated workflows (representing selection procedures for other studies, for example) that are unrelated to its creation.
The workflow responsible for coordinating its creation will be included in the export, not directly, but through the chain effect of including the creating calculation (through <code class="docutils literal notranslate"><span class="pre">create_backward</span></code>) and then including its calling workflows (through <code class="docutils literal notranslate"><span class="pre">call_calc_backward</span></code> and <code class="docutils literal notranslate"><span class="pre">call_work_backward</span></code>, see next sections).</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 27%" />
<col style="width: 14%" />
<col style="width: 30%" />
<col style="width: 29%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Illustrative diagram (explicitly targeted
node is encircled)</p></th>
<th class="head"><p>Name of Rule</p></th>
<th class="head"><p>Behavior when exporting target node</p></th>
<th class="head"><p>Behavior when deleting target node</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><a class="reference internal image-reference" href="../_images/delexp_caseDW1.png"><img alt="../_images/delexp_caseDW1.png" src="../_images/delexp_caseDW1.png" style="width: 232.2px; height: 90.6px;" /></a>
</td>
<td><p><code class="docutils literal notranslate"><span class="pre">input_work_forward</span></code></p></td>
<td><ul class="simple">
<li><p>Default Value: <code class="docutils literal notranslate"><span class="pre">False</span></code></p></li>
<li><p>Linked node <strong>won’t</strong> be exported <strong>by default</strong>.</p></li>
</ul>
</td>
<td><ul class="simple">
<li><p>Fixed Value: <code class="docutils literal notranslate"><span class="pre">True</span></code></p></li>
<li><p>Linked node <strong>will always</strong> be deleted.</p></li>
</ul>
</td>
</tr>
<tr class="row-odd"><td><a class="reference internal image-reference" href="../_images/delexp_caseDW2.png"><img alt="../_images/delexp_caseDW2.png" src="../_images/delexp_caseDW2.png" style="width: 228.6px; height: 90.6px;" /></a>
</td>
<td><p><code class="docutils literal notranslate"><span class="pre">input_work_backward</span></code></p></td>
<td><ul class="simple">
<li><p>Fixed Value: <code class="docutils literal notranslate"><span class="pre">True</span></code></p></li>
<li><p>Linked node <strong>will always</strong> be exported.</p></li>
</ul>
</td>
<td><ul class="simple">
<li><p>Fixed Value: <code class="docutils literal notranslate"><span class="pre">False</span></code></p></li>
<li><p>Linked node <strong>will never</strong> be deleted.</p></li>
</ul>
</td>
</tr>
<tr class="row-even"><td><a class="reference internal image-reference" href="../_images/delexp_caseWD1.png"><img alt="../_images/delexp_caseWD1.png" src="../_images/delexp_caseWD1.png" style="width: 228.6px; height: 90.6px;" /></a>
</td>
<td><p><code class="docutils literal notranslate"><span class="pre">return_forward</span></code></p></td>
<td><ul class="simple">
<li><p>Fixed Value: <code class="docutils literal notranslate"><span class="pre">True</span></code></p></li>
<li><p>Linked node <strong>will always</strong> be exported.</p></li>
</ul>
</td>
<td><ul class="simple">
<li><p>Fixed Value: <code class="docutils literal notranslate"><span class="pre">False</span></code> <a class="footnote-reference brackets" href="#f02" id="id3">2</a></p></li>
<li><p>Linked node <strong>will never</strong> be deleted.</p></li>
</ul>
</td>
</tr>
<tr class="row-odd"><td><a class="reference internal image-reference" href="../_images/delexp_caseWD2.png"><img alt="../_images/delexp_caseWD2.png" src="../_images/delexp_caseWD2.png" style="width: 231.0px; height: 90.0px;" /></a>
</td>
<td><p><code class="docutils literal notranslate"><span class="pre">return_backward</span></code></p></td>
<td><ul class="simple">
<li><p>Default Value: <code class="docutils literal notranslate"><span class="pre">False</span></code>.</p></li>
<li><p>Linked node <strong>won’t</strong> be exported <strong>by default</strong>.</p></li>
</ul>
</td>
<td><ul class="simple">
<li><p>Fixed Value: <code class="docutils literal notranslate"><span class="pre">True</span></code></p></li>
<li><p>Linked node <strong>will always</strong> be deleted.</p></li>
</ul>
</td>
</tr>
</tbody>
</table>
<dl class="footnote brackets">
<dt class="label" id="f02"><span class="brackets"><a class="fn-backref" href="#id3">2</a></span></dt>
<dd><p>The reason to prevent the deletion of returned data nodes is that, since the logical provenance can be cyclical, this might end up deleting inputs and thus propagating the deletion process to other unrelated parts of the database.
In most cases where you will want to delete a returned data node, you will be able to do so by setting <code class="docutils literal notranslate"><span class="pre">call_calc_forward=True</span></code> (see below) and <code class="docutils literal notranslate"><span class="pre">create_forward=True</span></code> (which is the default value).</p>
</dd>
</dl>
</div>
<div class="section" id="workflows-and-calculation-nodes">
<h3>Workflows and Calculation Nodes<a class="headerlink" href="#workflows-and-calculation-nodes" title="Permalink to this headline">¶</a></h3>
<p>Finally, we will consider the possible (call) links between processes.
The results of a parent workflow depend critically on the sub-workflows or calculations launched by it.
When exporting a workflow node, we therefore always traverse its <code class="docutils literal notranslate"><span class="pre">call</span></code> links (both <code class="docutils literal notranslate"><span class="pre">call_calc</span></code> and <code class="docutils literal notranslate"><span class="pre">call_work</span></code>) in the <code class="docutils literal notranslate"><span class="pre">forward</span></code> direction to include all children processes (i.e. processes directly called by it).
Since the traversal rules are applied recursively, this means that also the children processes of any workflow that was a child of the targeted one will be exported as well, and so on.
Analogously, when deleting a process the same applies but in the opposite direction (<code class="docutils literal notranslate"><span class="pre">backward</span></code>), including the parent workflow of the targeted node (if there is one), and the parent of that parent, etc.</p>
<p>Since <code class="docutils literal notranslate"><span class="pre">call</span></code> links are followed backward by default, targeting one process for either export or deletion results in selecting not only all of its child processes but also all children of any of its parent processes.
As a result of all <code class="docutils literal notranslate"><span class="pre">call</span></code> links being traversed in both directions, targeting any of the process nodes in a workflow will mean the inclusion of the other processes of that workflow as well.
Users can disable the traversal of <code class="docutils literal notranslate"><span class="pre">call</span></code> links in one of the directions (<code class="docutils literal notranslate"><span class="pre">forward</span></code> for deletion, <code class="docutils literal notranslate"><span class="pre">backward</span></code> for export) for fine-grained control (see examples below).</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 27%" />
<col style="width: 14%" />
<col style="width: 30%" />
<col style="width: 29%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Illustrative diagram (explicitly targeted
node is encircled)</p></th>
<th class="head"><p>Name of Rule</p></th>
<th class="head"><p>Behavior when exporting target node</p></th>
<th class="head"><p>Behavior when deleting target node</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><a class="reference internal image-reference" href="../_images/delexp_caseWC1.png"><img alt="../_images/delexp_caseWC1.png" src="../_images/delexp_caseWC1.png" style="width: 252.0px; height: 93.0px;" /></a>
</td>
<td><p><code class="docutils literal notranslate"><span class="pre">call_calc_forward</span></code></p></td>
<td><ul class="simple">
<li><p>Fixed Value: <code class="docutils literal notranslate"><span class="pre">True</span></code></p></li>
<li><p>Linked node <strong>will always</strong> be exported.</p></li>
</ul>
</td>
<td><ul class="simple">
<li><p>Default Value: <code class="docutils literal notranslate"><span class="pre">True</span></code></p></li>
<li><p>Linked node <strong>will</strong> be deleted <strong>by default</strong>.</p></li>
</ul>
</td>
</tr>
<tr class="row-odd"><td><a class="reference internal image-reference" href="../_images/delexp_caseWC2.png"><img alt="../_images/delexp_caseWC2.png" src="../_images/delexp_caseWC2.png" style="width: 244.2px; height: 92.39999999999999px;" /></a>
</td>
<td><p><code class="docutils literal notranslate"><span class="pre">call_calc_backward</span></code></p></td>
<td><ul class="simple">
<li><p>Default Value: <code class="docutils literal notranslate"><span class="pre">True</span></code></p></li>
<li><p>Linked node <strong>will</strong> be exported <strong>by default</strong>.</p></li>
</ul>
</td>
<td><ul class="simple">
<li><p>Fixed Value: <code class="docutils literal notranslate"><span class="pre">True</span></code></p></li>
<li><p>Linked node <strong>will always</strong> be deleted.</p></li>
</ul>
</td>
</tr>
<tr class="row-even"><td><a class="reference internal image-reference" href="../_images/delexp_caseWW1.png"><img alt="../_images/delexp_caseWW1.png" src="../_images/delexp_caseWW1.png" style="width: 252.0px; height: 92.39999999999999px;" /></a>
</td>
<td><p><code class="docutils literal notranslate"><span class="pre">call_work_forward</span></code></p></td>
<td><ul class="simple">
<li><p>Fixed Value: <code class="docutils literal notranslate"><span class="pre">True</span></code></p></li>
<li><p>Linked node <strong>will always</strong> be exported.</p></li>
</ul>
</td>
<td><ul class="simple">
<li><p>Default Value: <code class="docutils literal notranslate"><span class="pre">True</span></code></p></li>
<li><p>Linked node <strong>will</strong> be deleted <strong>by default</strong>.</p></li>
</ul>
</td>
</tr>
<tr class="row-odd"><td><a class="reference internal image-reference" href="../_images/delexp_caseWW2.png"><img alt="../_images/delexp_caseWW2.png" src="../_images/delexp_caseWW2.png" style="width: 252.0px; height: 92.39999999999999px;" /></a>
</td>
<td><p><code class="docutils literal notranslate"><span class="pre">call_work_backward</span></code></p></td>
<td><ul class="simple">
<li><p>Default Value: <code class="docutils literal notranslate"><span class="pre">True</span></code>.</p></li>
<li><p>Linked node <strong>will</strong> be exported <strong>by default</strong>.</p></li>
</ul>
</td>
<td><ul class="simple">
<li><p>Fixed Value: <code class="docutils literal notranslate"><span class="pre">True</span></code></p></li>
<li><p>Linked node <strong>will always</strong> be deleted.</p></li>
</ul>
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="cascading-rules-an-example">
<h2>Cascading rules: an example<a class="headerlink" href="#cascading-rules-an-example" title="Permalink to this headline">¶</a></h2>
<p>In the previous sections we have described the basic rules used by AiiDA to decide which nodes should also be included from an initial list of nodes to delete or export.
These rules are applied recursively: as new nodes are included in the deletion (or export)list, the rules are applied to them as well until no new nodes are included.
Therefore, the consequence of using these features on a given set of nodes may not always be straightforward, and the final set might include more nodes than naively expected.</p>
<p>Let us first focus on the data provenance only (i.e., only <code class="docutils literal notranslate"><span class="pre">input_calc</span></code> and <code class="docutils literal notranslate"><span class="pre">create</span></code> links). The following two rules apply when going in the <code class="docutils literal notranslate"><span class="pre">forward</span></code> direction:</p>
<ul class="simple">
<li><p>If you delete a data node, any calculation that uses it as input will <em>always</em> be deleted as well (<code class="docutils literal notranslate"><span class="pre">input_calc_forward=True</span></code>).</p></li>
<li><p>If you delete a calculation node, any output data node will be deleted <em>by default</em> (<code class="docutils literal notranslate"><span class="pre">create_forward=True</span></code>).</p></li>
</ul>
<p>The consequence of these two together is a “chain reaction” in which every node that can be traced back through the data provenance to any of the initial targeted nodes will end up being deleted as well.
The reciprocal is true for the export: the default behavior is that every ancestor will also be exported by default (because <code class="docutils literal notranslate"><span class="pre">create_backward</span></code> is <code class="docutils literal notranslate"><span class="pre">True</span></code> by default and <code class="docutils literal notranslate"><span class="pre">input_calc_backward</span></code> is always <code class="docutils literal notranslate"><span class="pre">True</span></code>).</p>
<p>In regards to the connection between data provenance and logical provenance, the most important thing to understand is how the default behavior of the program treats the highest-level workflows as the units to be handled.
The logic behind this is the assumption that the typical user of the program will be dealing with it mostly in an interactive way, running pre-defined workflows through the verdi command line without needing a detailed knowledge of their internal procedures.
The default behavior then was designed to reproduce the most intuitive outcomes for this type of usage.</p>
<p>This behavior is basically the result of the settings of <code class="docutils literal notranslate"><span class="pre">call_calc_forward=True</span></code> and <code class="docutils literal notranslate"><span class="pre">call_work_forward=True</span></code>, which makes that the inclusion of a process node will also imply the inclusion of any child or parent process node as well.
Following this rules in a recursive way leads to the command affecting all the processes within any given workflow: in this way, nodes that are sub-processes of a given highest-level workflow will end up grouped together, in the sense that (by default) they will all be affected in the same way when deleting or exporting.</p>
<p>More freedom to further customize the selection of sections to export or delete is available through the specific switchable flags for each functionality (although the final sections must always comply with the non-switchable rules, see above).
However, this usually requires a deeper understanding of the traversal rules and may imply a more thorough analysis of the particular graph.
To better illustrate this, we will now consider the application of the deletion procedure to the following graph:</p>
<a class="reference internal image-reference" href="../_images/delexp_example02.png" id="delexp-example02"><img alt="../_images/delexp_example02.png" id="delexp-example02" src="../_images/delexp_example02.png" style="width: 634.4000000000001px; height: 447.20000000000005px;" /></a>
<p>As you can see, W<sub>1</sub> and W<sub>2</sub> describe two similar but independent procedures that were launched by a single parent workflow W<sub>0</sub>.
A typical user would have obtained this by directly running this workflow W<sub>0</sub> to obtain the results D<sub>3</sub> and D<sub>4</sub> from the inputs D<sub>1</sub> and D<sub>2</sub>, and may even be unaware of the internal division of W<sub>0</sub> into two sub-Workflows W<sub>1</sub> and W<sub>2</sub>.
Hence, if the user considers the workflow (meaning, the whole set of nodes produced by it) no longer necessary, the intuitive thing to do in order to remove it from its database would be by targeting the workflow node W<sub>0</sub> for deletion.
Indeed, this would produce the desired result:</p>
<a class="reference internal image-reference" href="../_images/delexp_example02-a01.png" id="delexp-example02-a01"><img alt="../_images/delexp_example02-a01.png" id="delexp-example02-a01" src="../_images/delexp_example02-a01.png" style="width: 634.4000000000001px; height: 503.20000000000005px;" /></a>
<p>The nodes W<sub>1</sub> and W<sub>2</sub> would be included because W<sub>0</sub> is being targeted (<code class="docutils literal notranslate"><span class="pre">call_work_forward=True</span></code>), then the nodes C<sub>1</sub> and C<sub>2</sub> would also be included (<code class="docutils literal notranslate"><span class="pre">call_calc_forward=True</span></code>), and finally the nodes D<sub>3</sub> and D<sub>4</sub> would end up being included as well (<code class="docutils literal notranslate"><span class="pre">create_forward=True</span></code>).
In the end, only the inputs D<sub>1</sub> and D<sub>2</sub> remain (since <code class="docutils literal notranslate"><span class="pre">input_work_backward=False</span></code> always and <code class="docutils literal notranslate"><span class="pre">input_calc_backward=False</span></code> by default).</p>
<p>The same result would occur if the user were to target the output nodes instead (intending to delete everything associated with the obtention of those results).
It is important to notice that even if the user deletes only one of the outputs, the whole set of nodes generated by the workflow would be deleted, and not just the ones associated to the targeted data node.
As the results D<sub>3</sub> and D<sub>4</sub> where obtained from the same high-level process W<sub>0</sub>, then the default behavior has the underlying assumption that they are interconnected and not independent from one another (as if they were two different outputs of a single calculation).</p>
<a class="reference internal image-reference" href="../_images/delexp_example02-a03.png" id="delexp-example02-a03"><img alt="../_images/delexp_example02-a03.png" id="delexp-example02-a03" src="../_images/delexp_example02-a03.png" style="width: 634.4000000000001px; height: 500.0px;" /></a>
<p>In this case, the node C<sub>1</sub> would first be included because the data node D<sub>3</sub> is being targeted (<code class="docutils literal notranslate"><span class="pre">create_reverse=True</span></code>), and this in turn would include the node W<sub>1</sub> (<code class="docutils literal notranslate"><span class="pre">call_calc_reverse=True</span></code>) and then its parent workflow W<sub>0</sub> (<code class="docutils literal notranslate"><span class="pre">call_work_reverse=True</span></code>).
Then nodes W<sub>2</sub>, C<sub>2</sub> and D<sub>4</sub> will be included because W<sub>0</sub> was included, for the same reasons that were explained in the paragraphs above.</p>
<div class="section" id="customizing-the-graph-traversal-for-deletion-or-export">
<h3>Customizing the graph traversal (for deletion or export)<a class="headerlink" href="#customizing-the-graph-traversal-for-deletion-or-export" title="Permalink to this headline">¶</a></h3>
<p>This dependency between nodes becomes particularly relevant when, for example, a user with more knowledge of the internal procedures of the parent workflow W<sub>0</sub> wants to only delete the calculations and results associated to workflow W<sub>1</sub>.
The intuitive action of targeting W<sub>1</sub> does not produce the desired outcome:</p>
<a class="reference internal image-reference" href="../_images/delexp_example02-b01.png" id="delexp-example02-b01"><img alt="../_images/delexp_example02-b01.png" id="delexp-example02-b01" src="../_images/delexp_example02-b01.png" style="width: 634.4000000000001px; height: 501.6px;" /></a>
<p>Indeed C<sub>1</sub> and D<sub>4</sub> will be deleted (through <code class="docutils literal notranslate"><span class="pre">call_calc_forward</span></code> from W<sub>1</sub> to C<sub>1</sub> and <code class="docutils literal notranslate"><span class="pre">create_forward</span></code> from C<sub>1</sub> to D<sub>3</sub>), but so will W<sub>0</sub> (through <code class="docutils literal notranslate"><span class="pre">call_work_reverse</span></code> from W<sub>1</sub>), W<sub>2</sub> (<code class="docutils literal notranslate"><span class="pre">call_work_forward</span></code> from W<sub>0</sub>), C<sub>2</sub> (<code class="docutils literal notranslate"><span class="pre">call_calc_forward</span></code> from W<sub>2</sub>) and D<sub>4</sub> (<code class="docutils literal notranslate"><span class="pre">create_forward</span></code> from C<sub>2</sub>).
The way to achieve the desired outcome is not trivial, although in some situations like this, one could propose case-specific solutions such as targeting W<sub>1</sub> with the switchable flag <code class="docutils literal notranslate"><span class="pre">call_work_forward=False</span></code> (preventing the traversal from W<sub>0</sub> to W<sub>2</sub>):</p>
<a class="reference internal image-reference" href="../_images/delexp_example02-b02.png" id="delexp-example02-b02"><img alt="../_images/delexp_example02-b02.png" id="delexp-example02-b02" src="../_images/delexp_example02-b02.png" style="width: 634.4000000000001px; height: 501.6px;" /></a>
<p>However, this approach is not generally applicable, and wouldn’t work if W<sub>1</sub> had sub-workflows that needed to be deleted as well.
A more general approach is to first sever the connection to W<sub>2</sub> by deleting node W<sub>0</sub> with all switchable traversal rules turned off.
Then, once the independence of W<sub>1</sub> and W<sub>2</sub> is explicitly reflected in the graph, node W<sub>1</sub> can be deleted with the default settings.</p>
<a class="reference internal image-reference" href="../_images/delexp_example02-b03.png" id="delexp-example02-b03"><img alt="../_images/delexp_example02-b03.png" id="delexp-example02-b03" src="../_images/delexp_example02-b03.png" style="width: 634.4000000000001px; height: 501.6px;" /></a>
<p>It is worth noting that if the workflow W<sub>0</sub> was itself part of a higher-level workflow, all that higher-level logic would be deleted due to the non-switchable rule <code class="docutils literal notranslate"><span class="pre">call_work_reverse=True</span></code>.
This is an inevitable outcome of deleting part of a workflow, since due to the loss of that information it has become incomplete and it makes no sense to keep it.</p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, ECOLE POLYTECHNIQUE FEDERALE DE LAUSANNE (Theory and Simulation of Materials (THEOS) and National Centre for Computational Design and Discovery of Novel Materials (NCCR MARVEL)), Switzerland and ROBERT BOSCH LLC, USA. All rights reserved

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>