

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Testing AiiDA plugins &mdash; AiiDA 1.2.1 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/language_data.js"></script>
        <script src="../../_static/togglebutton.js"></script>
        <script src="../../_static/contentui.js"></script>
        <script >var togglebuttonSelector = '.toggle';</script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/togglebutton.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/contentui.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> AiiDA
          

          
          </a>

          
            
            
              <div class="version">
                1.2
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../intro/about.html">What is AiiDA</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../intro/get_started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../intro/installation.html">Advanced Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../intro/troubleshooting.html">Troubleshooting</a></li>
</ul>
<p class="caption"><span class="caption-text">Tutorial</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../tutorial/placeholder.html">Placeholder</a></li>
</ul>
<p class="caption"><span class="caption-text">How-To Guides</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../howto/placeholder.html">Placeholder</a></li>
</ul>
<p class="caption"><span class="caption-text">Topics</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../topics/placeholder.html">Placeholder</a></li>
</ul>
<p class="caption"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../reference/placeholder.html">Placeholder</a></li>
</ul>
<p class="caption"><span class="caption-text">Plugins</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../plugins/placeholder.html">Placeholder</a></li>
</ul>
<p class="caption"><span class="caption-text">Development</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../development/placeholder.html">Placeholder</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">AiiDA</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
      <li>Testing AiiDA plugins</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/developer_guide/plugins/plugin_tests.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="testing-aiida-plugins">
<span id="plugin-testing"></span><h1>Testing AiiDA plugins<a class="headerlink" href="#testing-aiida-plugins" title="Permalink to this headline">¶</a></h1>
<p>We highly recommend writing tests for your AiiDA plugins and running continous integration tests using free platforms like <a class="reference external" href="ghactions">GitHub Actions</a>.</p>
<p>We recommend the following folder structure for AiiDA plugin packages:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">aiida</span><span class="o">-</span><span class="n">mycode</span><span class="o">/</span>           <span class="o">-</span> <span class="n">distribution</span> <span class="n">folder</span>
   <span class="n">aiida_mycode</span><span class="o">/</span>        <span class="o">-</span> <span class="n">plugin</span> <span class="n">package</span>
   <span class="n">tests</span><span class="o">/</span>               <span class="o">-</span> <span class="n">tests</span> <span class="n">directory</span> <span class="p">(</span><span class="n">possibly</span> <span class="k">with</span> <span class="n">subdirectories</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Keeping the tests outside the plugin package keeps the distribution of your plugin package light.</p>
</div>
<div class="section" id="using-the-pytest-framework">
<h2>Using the pytest framework<a class="headerlink" href="#using-the-pytest-framework" title="Permalink to this headline">¶</a></h2>
<p>We recommend the <a class="reference external" href="https://pytest.org">pytest</a> framework for testing AiiDA plugins.</p>
<p>One concern when running tests for AiiDA plugins is to separate the test environment from your production environment.
Depending on the kind of test, each should even be run against a fresh AiiDA database.</p>
<p>AiiDA ships with tools that take care of this for you. They will:</p>
<blockquote>
<div><ul class="simple">
<li><p>start a temporary postgres server</p></li>
<li><p>create a new database</p></li>
<li><p>create a temporary <code class="docutils literal notranslate"><span class="pre">.aiida</span></code> folder</p></li>
<li><p>create a test profile</p></li>
<li><p>(optional) reset the AiiDA database before every individual test</p></li>
</ul>
</div></blockquote>
<p>thus letting you focus on testing the functionality of your plugin without having to worry about this separation.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The overhead for setting up the temporary environment is of the order of a few seconds and occurs only once per test session.
You can control the database backend for the temporary profile by setting the <code class="docutils literal notranslate"><span class="pre">AIIDA_TEST_BACKEND</span></code> environment variable, e.g. <code class="docutils literal notranslate"><span class="pre">export</span> <span class="pre">AIIDA_TEST_BACKEND=sqlalchemy</span></code>.</p>
</div>
<p>If you prefer to run tests on an existing profile, say <code class="docutils literal notranslate"><span class="pre">test_profile</span></code>, simply set the following environment variable before running your tests:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">export</span> <span class="n">AIIDA_TEST_PROFILE</span><span class="o">=</span><span class="n">test_profile</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In order to prevent accidental data loss, AiiDA only allows to run tests on profiles whose name starts with <code class="docutils literal notranslate"><span class="pre">test_</span></code>.</p>
</div>
<div class="section" id="aiida-s-fixtures">
<h3>AiiDA’s fixtures<a class="headerlink" href="#aiida-s-fixtures" title="Permalink to this headline">¶</a></h3>
<p>Many tests require input data to be set up before the test starts, e.g. some AiiDA data nodes.
pytest has the concept of a <a class="reference external" href="https://docs.pytest.org/en/latest/fixture.html">fixture</a>, which can be a predefined object that the test acts on or just some code you want to run before the test starts.</p>
<p>AiiDA ships with a number of fixtures in <a class="reference internal" href="../../apidoc/aiida.manage.tests.html#module-aiida.manage.tests.pytest_fixtures" title="aiida.manage.tests.pytest_fixtures"><code class="xref py py-mod docutils literal notranslate"><span class="pre">aiida.manage.tests.pytest_fixtures</span></code></a> for you to use.</p>
<p>For example:</p>
<blockquote>
<div><ul class="simple">
<li><p>The <a class="reference internal" href="../../apidoc/aiida.manage.tests.html#aiida.manage.tests.pytest_fixtures.aiida_profile" title="aiida.manage.tests.pytest_fixtures.aiida_profile"><code class="xref py py-func docutils literal notranslate"><span class="pre">aiida_profile()</span></code></a> fixture initializes the <a class="reference internal" href="../../apidoc/aiida.manage.tests.html#aiida.manage.tests.TestManager" title="aiida.manage.tests.TestManager"><code class="xref py py-class docutils literal notranslate"><span class="pre">TestManager</span></code></a> and yields it to the test function.
Its parameters <code class="docutils literal notranslate"><span class="pre">scope='session',</span> <span class="pre">autouse=True</span></code> cause this fixture to automatically run once per test session, even if you don’t explicitly require it.</p></li>
<li><p>The <a class="reference internal" href="../../apidoc/aiida.manage.tests.html#aiida.manage.tests.pytest_fixtures.clear_database" title="aiida.manage.tests.pytest_fixtures.clear_database"><code class="xref py py-func docutils literal notranslate"><span class="pre">clear_database()</span></code></a> fixture depends on the <a class="reference internal" href="../../apidoc/aiida.manage.tests.html#aiida.manage.tests.pytest_fixtures.aiida_profile" title="aiida.manage.tests.pytest_fixtures.aiida_profile"><code class="xref py py-func docutils literal notranslate"><span class="pre">aiida_profile()</span></code></a> fixture and tells the received <a class="reference internal" href="../../apidoc/aiida.manage.tests.html#aiida.manage.tests.TestManager" title="aiida.manage.tests.TestManager"><code class="xref py py-class docutils literal notranslate"><span class="pre">TestManager</span></code></a> instance to reset the database.
This fixture lets each test start in a fresh AiiDA environment.</p></li>
<li><p>The <a class="reference internal" href="../../apidoc/aiida.manage.tests.html#aiida.manage.tests.pytest_fixtures.temp_dir" title="aiida.manage.tests.pytest_fixtures.temp_dir"><code class="xref py py-func docutils literal notranslate"><span class="pre">temp_dir()</span></code></a> fixture returns a temporary directory for file operations and deletes it after the test is finished.</p></li>
<li><p>… you may want to add your own fixtures tailored for your plugins to set up specific <code class="docutils literal notranslate"><span class="pre">Data</span></code> nodes &amp; more.</p></li>
</ul>
</div></blockquote>
<p>In order to make these fixtures available to your tests, add them to your <code class="docutils literal notranslate"><span class="pre">conftest.py</span></code> file at the root level of your plugin package as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pytest</span>
<span class="n">pytest_plugins</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;aiida.manage.tests.pytest_fixtures&#39;</span><span class="p">]</span>

<span class="c1"># Example of how to define your own fixture</span>
<span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span><span class="p">(</span><span class="n">scope</span><span class="o">=</span><span class="s1">&#39;function&#39;</span><span class="p">,</span> <span class="n">autouse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">clear_database_auto</span><span class="p">(</span><span class="n">clear_database</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Automatically clear database in between tests.&quot;&quot;&quot;</span>
    <span class="k">pass</span>
</pre></div>
</div>
<p>Your custom fixtures would typically also go inside the <code class="docutils literal notranslate"><span class="pre">conftest.py</span></code>.
For more information on the <code class="docutils literal notranslate"><span class="pre">conftest.py</span></code>, see <a class="reference external" href="conftest">here</a>.</p>
<p>You can now start writing tests e.g. in a <code class="docutils literal notranslate"><span class="pre">test_calculations.py</span></code> file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># No need to import fixtures - added by pytest &quot;automagically&quot;</span>

<span class="k">def</span> <span class="nf">test_qe_calculation</span><span class="p">(</span><span class="n">aiida_local_code_factory</span><span class="p">,</span> <span class="n">clear_database</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">aiida.engine</span> <span class="kn">import</span> <span class="n">run</span>
    <span class="kn">from</span> <span class="nn">aiida.plugins</span> <span class="kn">import</span> <span class="n">CalculationFactory</span>

    <span class="n">code</span> <span class="o">=</span> <span class="n">aiida_local_code_factory</span><span class="p">(</span><span class="n">entry_point</span><span class="o">=</span><span class="s1">&#39;quantumespresso.pw&#39;</span><span class="p">,</span> <span class="n">executable</span><span class="o">=</span><span class="s1">&#39;pw.x&#39;</span><span class="p">)</span>
    <span class="c1"># ...</span>
    <span class="n">inputs</span> <span class="o">=</span> <span class="p">{</span> <span class="s1">&#39;code&#39;</span><span class="p">:</span> <span class="n">code</span><span class="p">,</span> <span class="o">...</span> <span class="p">}</span>

    <span class="c1"># submit a calculation using this code ...</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">run</span><span class="p">(</span><span class="n">CalculationFactory</span><span class="p">(</span><span class="s1">&#39;quantumespresso.pw&#39;</span><span class="p">),</span> <span class="o">**</span><span class="n">inputs</span><span class="p">)</span>

    <span class="c1"># check outputs of calculation</span>
    <span class="k">assert</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;...&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="o">...</span>
</pre></div>
</div>
<p>Feel free to check out the tests of the <a class="reference external" href="https://github.com/aiidateam/aiida-diff/">aiida-diff</a> demo plugin package.</p>
</div>
<div class="section" id="running-tests">
<h3>Running tests<a class="headerlink" href="#running-tests" title="Permalink to this headline">¶</a></h3>
<p>Simply type:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pytest</span>
</pre></div>
</div>
<p>in the folder where your <code class="docutils literal notranslate"><span class="pre">conftest.py</span></code> resides.</p>
<p>pytest will automatically discover files, classes and function names starting with the word <code class="docutils literal notranslate"><span class="pre">test</span></code>.</p>
</div>
</div>
<div class="section" id="using-the-unittest-framework">
<h2>Using the unittest framework<a class="headerlink" href="#using-the-unittest-framework" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">unittest</span></code> package is included in the python standard library and is widely used despite its limitations.</p>
<p>In analogy to the fixtures of <code class="docutils literal notranslate"><span class="pre">pytest</span></code>, for <code class="docutils literal notranslate"><span class="pre">unittest</span></code> we provide a <a class="reference internal" href="../../apidoc/aiida.manage.tests.html#aiida.manage.tests.unittest_classes.PluginTestCase" title="aiida.manage.tests.unittest_classes.PluginTestCase"><code class="xref py py-class docutils literal notranslate"><span class="pre">aiida.manage.tests.unittest_classes.PluginTestCase</span></code></a> class that your test cases can inherit from.</p>
<p>Due to limitations of <code class="docutils literal notranslate"><span class="pre">unittest</span></code>, tests written using the <a class="reference internal" href="../../apidoc/aiida.manage.tests.html#aiida.manage.tests.unittest_classes.PluginTestCase" title="aiida.manage.tests.unittest_classes.PluginTestCase"><code class="xref py py-class docutils literal notranslate"><span class="pre">PluginTestCase</span></code></a> need to be run through a special <a class="reference internal" href="../../apidoc/aiida.manage.tests.html#aiida.manage.tests.unittest_classes.TestRunner" title="aiida.manage.tests.unittest_classes.TestRunner"><code class="xref py py-class docutils literal notranslate"><span class="pre">TestRunner</span></code></a> (i.e. <code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">-m</span> <span class="pre">unittest</span> <span class="pre">discover</span></code> will <em>not</em> work).
To actually the tests, prepare a script <code class="docutils literal notranslate"><span class="pre">run_tests.py</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">unittest</span>
<span class="kn">from</span> <span class="nn">aiida.manage.tests.unittest_classes</span> <span class="kn">import</span> <span class="n">TestRunner</span>

<span class="n">tests</span> <span class="o">=</span> <span class="n">unittest</span><span class="o">.</span><span class="n">defaultTestLoader</span><span class="o">.</span><span class="n">discover</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
<span class="n">TestRunner</span><span class="p">()</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">tests</span><span class="p">)</span>
</pre></div>
</div>
<p>and then run the tests using:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="n">run_test</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
</div>
<div class="section" id="migrating-from-aiidatestcase-to-pytest">
<h2>Migrating from <code class="docutils literal notranslate"><span class="pre">AiidaTestCase</span></code> to pytest<a class="headerlink" href="#migrating-from-aiidatestcase-to-pytest" title="Permalink to this headline">¶</a></h2>
<p>The slightly outdated testing framework of <code class="docutils literal notranslate"><span class="pre">aiida-core</span></code> defined an <a class="reference internal" href="../../apidoc/aiida.backends.html#aiida.backends.testbase.AiidaTestCase" title="aiida.backends.testbase.AiidaTestCase"><code class="xref py py-class docutils literal notranslate"><span class="pre">AiidaTestCase</span></code></a> class plus some functionality around it.</p>
<p>Below, we give an example of how to convert tests written for the <a class="reference internal" href="../../apidoc/aiida.backends.html#aiida.backends.testbase.AiidaTestCase" title="aiida.backends.testbase.AiidaTestCase"><code class="xref py py-class docutils literal notranslate"><span class="pre">AiidaTestCase</span></code></a> to work with <code class="docutils literal notranslate"><span class="pre">pytest</span></code>.
In the process, we’ll take advantage of the fact that the <code class="docutils literal notranslate"><span class="pre">pytest</span></code> framework can also run test cases using the <code class="docutils literal notranslate"><span class="pre">unittest</span></code> classes, in order to maintain the class-style layout.</p>
<p>Below is a typical test class based on the <a class="reference internal" href="../../apidoc/aiida.backends.html#aiida.backends.testbase.AiidaTestCase" title="aiida.backends.testbase.AiidaTestCase"><code class="xref py py-class docutils literal notranslate"><span class="pre">AiidaTestCase</span></code></a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">aiida.plugins</span> <span class="kn">import</span> <span class="n">DataFactory</span>

<span class="c1"># Assuming our new date type has entry point myplugin.complex</span>
<span class="n">ComplexData</span> <span class="o">=</span> <span class="n">DataFactory</span><span class="p">(</span><span class="s2">&quot;myplugin.complex&quot;</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">TestComplexData</span><span class="p">(</span><span class="n">AiidaTestCase</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Clean up database for each test&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clean_db</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">store_complex</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">comp_num</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Store a complex number, returns pk&quot;&quot;&quot;</span>
        <span class="n">comdata</span> <span class="o">=</span> <span class="n">ComplexData</span><span class="p">()</span>
        <span class="n">comdata</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">comp_num</span>
        <span class="k">return</span> <span class="n">comdata</span><span class="o">.</span><span class="n">pk</span>

    <span class="k">def</span> <span class="nf">test_complex_store</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Test if the complex numbers can be stored&quot;&quot;&quot;</span>

        <span class="n">comdata</span> <span class="o">=</span> <span class="n">ComplexData</span><span class="p">()</span>
        <span class="n">comdata</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="mi">2</span><span class="n">j</span>
        <span class="n">comdata</span><span class="o">.</span><span class="n">store</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">test_complex_retrieve</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s2">&quot;&quot;&quot;Test if the complex</span>

<span class="s2">        comp_num = 1 + 2j</span>
<span class="s2">        pk = self.store_complex(cnum)</span>
<span class="s2">        comdata = load_node(pk)</span>
<span class="s2">        self.assertEqual(comdata.value == comp_num)</span>
</pre></div>
</div>
<p>If you enable the AiiDA fixtures in your <code class="docutils literal notranslate"><span class="pre">conftest.py</span></code> as explained above, they will also act on test functions defined in <code class="docutils literal notranslate"><span class="pre">unittest</span></code> test classes!
Thus, the conversion to <code class="docutils literal notranslate"><span class="pre">pytest</span></code> can look as follows:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">unittest</span>
<span class="kn">import</span> <span class="nn">pytest</span>
<span class="kn">from</span> <span class="nn">aiida.plugins</span> <span class="kn">import</span> <span class="n">DataFactory</span>

<span class="c1"># Assuming our new date type has entry point myplugin.complex</span>
<span class="n">ComplexData</span> <span class="o">=</span> <span class="n">DataFactory</span><span class="p">(</span><span class="s2">&quot;myplugin.complex&quot;</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">TestComplexData</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Test ComplexData. Compatible with pytest.&quot;&quot;&quot;</span>

    <span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span><span class="p">(</span><span class="n">autouse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">setup_db</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">clear_database</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Clear database for each test.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">store_complex</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">comp_num</span><span class="p">):</span>
        <span class="n">comdata</span> <span class="o">=</span> <span class="n">ComplexData</span><span class="p">()</span>
        <span class="n">comdata</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">comp_num</span>
        <span class="k">return</span> <span class="n">comdata</span><span class="o">.</span><span class="n">pk</span>

    <span class="k">def</span> <span class="nf">test_complex_store</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">clear_database</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Test if the complex numbers can be stored.&quot;&quot;&quot;</span>
        <span class="n">comdata</span> <span class="o">=</span> <span class="n">ComplexData</span><span class="p">()</span>
        <span class="n">comdata</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="mi">2</span><span class="n">j</span>
        <span class="n">comdata</span><span class="o">.</span><span class="n">store</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">test_complex_retrieve</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">clear_database</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Test if the complex number stored can be retrieved.&quot;&quot;&quot;</span>
        <span class="n">comp_num</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="mi">2</span><span class="n">j</span>
        <span class="n">pk</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">store_complex</span><span class="p">(</span><span class="n">cnum</span><span class="p">)</span>
        <span class="n">comdata</span> <span class="o">=</span> <span class="n">load_node</span><span class="p">(</span><span class="n">pk</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">comdata</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="n">comp_num</span><span class="p">)</span>
</pre></div>
</div>
<p>For more details on running <code class="docutils literal notranslate"><span class="pre">unittest</span></code> cases through pytest, see the <a class="reference external" href="https://docs.pytest.org/en/latest/unittest.html">pytest documentation</a>.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, ECOLE POLYTECHNIQUE FEDERALE DE LAUSANNE (Theory and Simulation of Materials (THEOS) and National Centre for Computational Design and Discovery of Novel Materials (NCCR MARVEL)), Switzerland and ROBERT BOSCH LLC, USA. All rights reserved

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>