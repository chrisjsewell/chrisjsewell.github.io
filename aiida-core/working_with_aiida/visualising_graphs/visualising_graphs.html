

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Visualizing Provenance Graphs &mdash; AiiDA 1.2.1 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/language_data.js"></script>
        <script src="../../_static/togglebutton.js"></script>
        <script src="../../_static/contentui.js"></script>
        <script >var togglebuttonSelector = '.toggle';</script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/togglebutton.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/contentui.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> AiiDA
          

          
          </a>

          
            
            
              <div class="version">
                1.2
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../intro/about.html">What is AiiDA</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../intro/get_started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../intro/installation.html">Advanced Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../intro/troubleshooting.html">Troubleshooting</a></li>
</ul>
<p class="caption"><span class="caption-text">Tutorial</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../tutorial/placeholder.html">Placeholder</a></li>
</ul>
<p class="caption"><span class="caption-text">How-To Guides</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../howto/placeholder.html">Placeholder</a></li>
</ul>
<p class="caption"><span class="caption-text">Topics</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../topics/placeholder.html">Placeholder</a></li>
</ul>
<p class="caption"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../reference/placeholder.html">Placeholder</a></li>
</ul>
<p class="caption"><span class="caption-text">Plugins</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../plugins/placeholder.html">Placeholder</a></li>
</ul>
<p class="caption"><span class="caption-text">Development</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../development/placeholder.html">Placeholder</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">AiiDA</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
      <li>Visualizing Provenance Graphs</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/working_with_aiida/visualising_graphs/visualising_graphs.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="visualizing-provenance-graphs">
<span id="visualizinggraphs"></span><h1>Visualizing Provenance Graphs<a class="headerlink" href="#visualizing-provenance-graphs" title="Permalink to this headline">¶</a></h1>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This tutorial can be downloaded and run as a Jupyter Notebook:
<a class="reference download internal" download="" href="../../_downloads/f3538c3ad0860dde3c8cc35f03baa7e0/visualising_graphs.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">visualising_graphs.ipynb</span></code></a></p>
</div>
<p>The provenance graph of a database can be visually inspected, <em>via</em>
<a class="reference external" href="https://www.graphviz.org/">graphviz</a>, using both the python API and
command-line interface.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><code class="docutils literal notranslate"><span class="pre">verdi</span> <span class="pre">graph</span> <span class="pre">generate</span> <span class="pre">-h</span></code></p>
</div>
<p>We first load the database and required modules:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">aiida</span> <span class="kn">import</span> <span class="n">load_profile</span>
<span class="n">profile</span> <span class="o">=</span> <span class="n">load_profile</span><span class="p">()</span>

<span class="kn">from</span> <span class="nn">aiida.common</span> <span class="kn">import</span> <span class="n">LinkType</span>
<span class="kn">from</span> <span class="nn">aiida.orm.utils.links</span> <span class="kn">import</span> <span class="n">LinkPair</span>
<span class="kn">from</span> <span class="nn">aiida.backends.tests.utils.archives</span> <span class="kn">import</span> <span class="n">get_archive_file</span>
<span class="kn">from</span> <span class="nn">aiida.tools.visualization</span> <span class="kn">import</span> <span class="n">Graph</span><span class="p">,</span> <span class="n">pstate_node_styles</span>
</pre></div>
</div>
<p>The example provenance graph, used in this tutorial, can then be
imported into the database:</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="n">archive_path</span> <span class="o">=</span> <span class="n">get_archive_file</span><span class="p">(</span><span class="s1">&#39;graph1.aiida&#39;</span><span class="p">,</span> <span class="s1">&#39;graphs&#39;</span><span class="p">)</span>
<span class="o">!</span>verdi import -n <span class="o">{</span>archive_path<span class="o">}</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">dict1_uuid</span> <span class="o">=</span> <span class="s1">&#39;0ea79a16-501f-408a-8c84-a2704a778e4b&#39;</span>
<span class="n">calc1_uuid</span> <span class="o">=</span> <span class="s1">&#39;b23e692e-4e01-48dd-b515-4c63877d73a4&#39;</span>
</pre></div>
</div>
<p>The <a class="reference internal" href="../../apidoc/aiida.tools.visualization.html#aiida.tools.visualization.graph.Graph" title="aiida.tools.visualization.graph.Graph"><code class="xref py py-class docutils literal notranslate"><span class="pre">Graph</span></code></a> class is used to
store visual representations of the nodes and edges, which can be added
separately or cumulatively by one of the graph traversal methods. The
<a class="reference internal" href="../../apidoc/aiida.tools.visualization.html#aiida.tools.visualization.graph.Graph.graphviz" title="aiida.tools.visualization.graph.Graph.graphviz"><code class="xref py py-attr docutils literal notranslate"><span class="pre">graphviz</span></code></a> attribute
returns a
<a class="reference external" href="https://graphviz.readthedocs.io/en/stable/">graphviz.Digraph</a>
instance, which will auto-magically render the graph in the notebook, or
can be used to save the graph to file.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">graph</span> <span class="o">=</span> <span class="n">Graph</span><span class="p">()</span>
<span class="n">graph</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">dict1_uuid</span><span class="p">)</span>
<span class="n">graph</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">calc1_uuid</span><span class="p">)</span>
<span class="n">graph</span><span class="o">.</span><span class="n">graphviz</span>
</pre></div>
</div>
<div class="figure align-center">
<img alt="output_9_0" src="../../_images/output_9_0.svg" /></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">graph</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span>
    <span class="n">dict1_uuid</span><span class="p">,</span> <span class="n">calc1_uuid</span><span class="p">,</span>
    <span class="n">link_pair</span><span class="o">=</span><span class="n">LinkPair</span><span class="p">(</span><span class="n">LinkType</span><span class="o">.</span><span class="n">INPUT_CALC</span><span class="p">,</span> <span class="s2">&quot;input1&quot;</span><span class="p">))</span>
<span class="n">graph</span><span class="o">.</span><span class="n">graphviz</span>
</pre></div>
</div>
<div class="figure align-center">
<img alt="output_10_0" src="../../_images/output_10_0.svg" /></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">graph</span><span class="o">.</span><span class="n">add_incoming</span><span class="p">(</span><span class="n">calc1_uuid</span><span class="p">)</span>
<span class="n">graph</span><span class="o">.</span><span class="n">add_outgoing</span><span class="p">(</span><span class="n">calc1_uuid</span><span class="p">)</span>
<span class="n">graph</span><span class="o">.</span><span class="n">graphviz</span>
</pre></div>
</div>
<div class="figure align-center">
<img alt="output_11_0" src="../../_images/output_11_0.svg" /></div>
<p>The <a class="reference internal" href="../../apidoc/aiida.tools.visualization.html#aiida.tools.visualization.graph.Graph" title="aiida.tools.visualization.graph.Graph"><code class="xref py py-class docutils literal notranslate"><span class="pre">Graph</span></code></a> can also be
initialized with global style attributes, as outlined in the <a class="reference external" href="https://www.graphviz.org/doc/info/attrs.html">graphviz
attributes table</a>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">graph</span> <span class="o">=</span> <span class="n">Graph</span><span class="p">(</span><span class="n">node_id_type</span><span class="o">=</span><span class="s2">&quot;uuid&quot;</span><span class="p">,</span>
              <span class="n">global_node_style</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;penwidth&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span>
              <span class="n">global_edge_style</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;color&quot;</span><span class="p">:</span> <span class="s2">&quot;blue&quot;</span><span class="p">},</span>
              <span class="n">graph_attr</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;size&quot;</span><span class="p">:</span> <span class="s2">&quot;6,6!&quot;</span><span class="p">,</span> <span class="s2">&quot;rankdir&quot;</span><span class="p">:</span> <span class="s2">&quot;LR&quot;</span><span class="p">})</span>
<span class="n">graph</span><span class="o">.</span><span class="n">add_incoming</span><span class="p">(</span><span class="n">calc1_uuid</span><span class="p">)</span>
<span class="n">graph</span><span class="o">.</span><span class="n">add_outgoing</span><span class="p">(</span><span class="n">calc1_uuid</span><span class="p">)</span>
<span class="n">graph</span><span class="o">.</span><span class="n">graphviz</span>
</pre></div>
</div>
<div class="figure align-center">
<img alt="output_13_0" src="../../_images/output_13_0.svg" /></div>
<p>Additionally functions can be parsed to the
<a class="reference internal" href="../../apidoc/aiida.tools.visualization.html#aiida.tools.visualization.graph.Graph" title="aiida.tools.visualization.graph.Graph"><code class="xref py py-class docutils literal notranslate"><span class="pre">Graph</span></code></a> initializer, to specify
exactly how each node will be represented. For example, the
<a class="reference internal" href="../../apidoc/aiida.tools.visualization.html#aiida.tools.visualization.graph.pstate_node_styles" title="aiida.tools.visualization.graph.pstate_node_styles"><code class="xref py py-func docutils literal notranslate"><span class="pre">pstate_node_styles()</span></code></a> function
colors process nodes by their process state.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">link_style</span><span class="p">(</span><span class="n">link_pair</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;color&quot;</span><span class="p">:</span> <span class="s2">&quot;blue&quot;</span><span class="p">}</span>

<span class="n">graph</span> <span class="o">=</span> <span class="n">Graph</span><span class="p">(</span><span class="n">node_style_fn</span><span class="o">=</span><span class="n">pstate_node_styles</span><span class="p">,</span>
              <span class="n">link_style_fn</span><span class="o">=</span><span class="n">link_style</span><span class="p">,</span>
              <span class="n">graph_attr</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;size&quot;</span><span class="p">:</span> <span class="s2">&quot;6,6!&quot;</span><span class="p">,</span> <span class="s2">&quot;rankdir&quot;</span><span class="p">:</span> <span class="s2">&quot;LR&quot;</span><span class="p">})</span>
<span class="n">graph</span><span class="o">.</span><span class="n">add_incoming</span><span class="p">(</span><span class="n">calc1_uuid</span><span class="p">)</span>
<span class="n">graph</span><span class="o">.</span><span class="n">add_outgoing</span><span class="p">(</span><span class="n">calc1_uuid</span><span class="p">)</span>
<span class="n">graph</span><span class="o">.</span><span class="n">graphviz</span>
</pre></div>
</div>
<div class="figure align-center">
<img alt="output_15_0" src="../../_images/output_15_0.svg" /></div>
<p>Edges can be annotated by one or both of their edge label and link type.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">graph</span> <span class="o">=</span> <span class="n">Graph</span><span class="p">(</span><span class="n">graph_attr</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;size&quot;</span><span class="p">:</span> <span class="s2">&quot;6,6!&quot;</span><span class="p">,</span> <span class="s2">&quot;rankdir&quot;</span><span class="p">:</span> <span class="s2">&quot;LR&quot;</span><span class="p">})</span>
<span class="n">graph</span><span class="o">.</span><span class="n">add_incoming</span><span class="p">(</span><span class="n">calc1_uuid</span><span class="p">,</span>
                   <span class="n">annotate_links</span><span class="o">=</span><span class="s2">&quot;both&quot;</span><span class="p">)</span>
<span class="n">graph</span><span class="o">.</span><span class="n">add_outgoing</span><span class="p">(</span><span class="n">calc1_uuid</span><span class="p">,</span>
                   <span class="n">annotate_links</span><span class="o">=</span><span class="s2">&quot;both&quot;</span><span class="p">)</span>
<span class="n">graph</span><span class="o">.</span><span class="n">graphviz</span>
</pre></div>
</div>
<div class="figure align-center">
<img alt="output_17_0" src="../../_images/output_17_0.svg" /></div>
<p>The <a class="reference internal" href="../../apidoc/aiida.tools.visualization.html#aiida.tools.visualization.graph.Graph.recurse_descendants" title="aiida.tools.visualization.graph.Graph.recurse_descendants"><code class="xref py py-meth docutils literal notranslate"><span class="pre">recurse_descendants()</span></code></a>
and <a class="reference internal" href="../../apidoc/aiida.tools.visualization.html#aiida.tools.visualization.graph.Graph.recurse_ancestors" title="aiida.tools.visualization.graph.Graph.recurse_ancestors"><code class="xref py py-meth docutils literal notranslate"><span class="pre">recurse_ancestors()</span></code></a>
methods can be used to construct a full provenance graph.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">graph</span> <span class="o">=</span> <span class="n">Graph</span><span class="p">(</span><span class="n">graph_attr</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;size&quot;</span><span class="p">:</span> <span class="s2">&quot;8,8!&quot;</span><span class="p">,</span> <span class="s2">&quot;rankdir&quot;</span><span class="p">:</span> <span class="s2">&quot;LR&quot;</span><span class="p">})</span>
<span class="n">graph</span><span class="o">.</span><span class="n">recurse_descendants</span><span class="p">(</span>
    <span class="n">dict1_uuid</span><span class="p">,</span>
    <span class="n">include_process_inputs</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">annotate_links</span><span class="o">=</span><span class="s2">&quot;both&quot;</span>
<span class="p">)</span>
<span class="n">graph</span><span class="o">.</span><span class="n">graphviz</span>
</pre></div>
</div>
<div class="figure align-center">
<img alt="output_19_0" src="../../_images/output_19_0.svg" /></div>
<p>The link types can also be filtered, to view only the ‘data’ or
‘logical’ provenance.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">graph</span> <span class="o">=</span> <span class="n">Graph</span><span class="p">(</span><span class="n">graph_attr</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;size&quot;</span><span class="p">:</span> <span class="s2">&quot;8,8!&quot;</span><span class="p">,</span> <span class="s2">&quot;rankdir&quot;</span><span class="p">:</span> <span class="s2">&quot;LR&quot;</span><span class="p">})</span>
<span class="n">graph</span><span class="o">.</span><span class="n">recurse_descendants</span><span class="p">(</span>
    <span class="n">dict1_uuid</span><span class="p">,</span>
    <span class="n">include_process_inputs</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">annotate_links</span><span class="o">=</span><span class="s2">&quot;both&quot;</span><span class="p">,</span>
    <span class="n">link_types</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;input_calc&quot;</span><span class="p">,</span> <span class="s2">&quot;create&quot;</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">graph</span><span class="o">.</span><span class="n">graphviz</span>
</pre></div>
</div>
<div class="figure align-center">
<img alt="output_21_0" src="../../_images/output_21_0.svg" /></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">graph</span> <span class="o">=</span> <span class="n">Graph</span><span class="p">(</span><span class="n">graph_attr</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;size&quot;</span><span class="p">:</span> <span class="s2">&quot;8,8!&quot;</span><span class="p">,</span> <span class="s2">&quot;rankdir&quot;</span><span class="p">:</span> <span class="s2">&quot;LR&quot;</span><span class="p">})</span>
<span class="n">graph</span><span class="o">.</span><span class="n">recurse_descendants</span><span class="p">(</span>
    <span class="n">dict1_uuid</span><span class="p">,</span>
    <span class="n">include_process_inputs</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">annotate_links</span><span class="o">=</span><span class="s2">&quot;both&quot;</span><span class="p">,</span>
    <span class="n">link_types</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;input_work&quot;</span><span class="p">,</span> <span class="s2">&quot;return&quot;</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">graph</span><span class="o">.</span><span class="n">graphviz</span>
</pre></div>
</div>
<div class="figure align-center">
<img alt="output_22_0" src="../../_images/output_22_0.svg" /></div>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, ECOLE POLYTECHNIQUE FEDERALE DE LAUSANNE (Theory and Simulation of Materials (THEOS) and National Centre for Computational Design and Discovery of Novel Materials (NCCR MARVEL)), Switzerland and ROBERT BOSCH LLC, USA. All rights reserved

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>