

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>plumpy.ports &mdash; AiiDA 1.2.1 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/language_data.js"></script>
        <script src="../../_static/togglebutton.js"></script>
        <script src="../../_static/contentui.js"></script>
        <script >var togglebuttonSelector = '.toggle';</script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/togglebutton.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/contentui.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> AiiDA
          

          
          </a>

          
            
            
              <div class="version">
                1.2
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../intro/about.html">What is AiiDA</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../intro/get_started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../intro/installation.html">Advanced Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../intro/troubleshooting.html">Troubleshooting</a></li>
</ul>
<p class="caption"><span class="caption-text">Tutorial</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../tutorial/placeholder.html">Placeholder</a></li>
</ul>
<p class="caption"><span class="caption-text">How-To Guides</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../howto/placeholder.html">Placeholder</a></li>
</ul>
<p class="caption"><span class="caption-text">Topics</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../topics/placeholder.html">Placeholder</a></li>
</ul>
<p class="caption"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../reference/placeholder.html">Placeholder</a></li>
</ul>
<p class="caption"><span class="caption-text">Plugins</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../plugins/placeholder.html">Placeholder</a></li>
</ul>
<p class="caption"><span class="caption-text">Development</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../development/placeholder.html">Placeholder</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">AiiDA</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">Module code</a> &raquo;</li>
        
      <li>plumpy.ports</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for plumpy.ports</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;Module for process ports&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">absolute_import</span>
<span class="kn">import</span> <span class="nn">abc</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">six</span>
<span class="kn">import</span> <span class="nn">warnings</span>

<span class="kn">from</span> <span class="nn">plumpy.utils</span> <span class="kn">import</span> <span class="n">is_mutable_property</span><span class="p">,</span> <span class="n">type_check</span>

<span class="k">if</span> <span class="n">six</span><span class="o">.</span><span class="n">PY2</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">collections</span>
    <span class="kn">from</span> <span class="nn">inspect</span> <span class="kn">import</span> <span class="n">getargspec</span> <span class="k">as</span> <span class="n">get_arg_spec</span>
<span class="k">else</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">collections.abc</span> <span class="k">as</span> <span class="nn">collections</span>
    <span class="kn">from</span> <span class="nn">inspect</span> <span class="kn">import</span> <span class="n">getfullargspec</span> <span class="k">as</span> <span class="n">get_arg_spec</span>

<span class="n">_LOGGER</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
<span class="n">UNSPECIFIED</span> <span class="o">=</span> <span class="p">()</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;UNSPECIFIED&#39;</span><span class="p">,</span> <span class="s1">&#39;PortValidationError&#39;</span><span class="p">,</span> <span class="s1">&#39;Port&#39;</span><span class="p">,</span> <span class="s1">&#39;InputPort&#39;</span><span class="p">,</span> <span class="s1">&#39;OutputPort&#39;</span><span class="p">]</span>


<span class="n">VALIDATOR_SIGNATURE_DEPRECATION_WARNING</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;the validator `</span><span class="si">{}</span><span class="s2">` has a signature that only takes a single argument.</span>
<span class="s2">    This has been deprecated and the new signature is `validator(value, port)` where the `port` argument will be the</span>
<span class="s2">    port instance to which the validator has been assigned.&quot;&quot;&quot;</span>


<span class="k">class</span> <span class="nc">PortValidationError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Error when validation fails on a port&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">port</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param message: validation error message</span>
<span class="sd">        :type message: str</span>
<span class="sd">        :param port: the port where the validation error occurred</span>
<span class="sd">        :type: str</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">PortValidationError</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="s2">&quot;Error occurred validating port &#39;</span><span class="si">{}</span><span class="s2">&#39;: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">port</span><span class="p">,</span> <span class="n">message</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_message</span> <span class="o">=</span> <span class="n">message</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_port</span> <span class="o">=</span> <span class="n">port</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">message</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the validation error message</span>

<span class="sd">        :return: the error message</span>
<span class="sd">        :rtype: str</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_message</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">port</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the port breadcrumbs</span>

<span class="sd">        :return: the port where the error occurred</span>
<span class="sd">        :rtype: str</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_port</span>


<span class="nd">@six</span><span class="o">.</span><span class="n">add_metaclass</span><span class="p">(</span><span class="n">abc</span><span class="o">.</span><span class="n">ABCMeta</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">Port</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Specifications relating to a general input/output value including</span>
<span class="sd">    properties like whether it is required, valid types, the help string, etc.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">valid_type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">validator</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>  <span class="c1"># pylint: disable=redefined-builtin</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_valid_type</span> <span class="o">=</span> <span class="n">valid_type</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_help</span> <span class="o">=</span> <span class="n">help</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_required</span> <span class="o">=</span> <span class="n">required</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_validator</span> <span class="o">=</span> <span class="n">validator</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get the string representing this port.</span>

<span class="sd">        :return: the string representation</span>
<span class="sd">        :rtype: str</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_description</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">get_description</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a description of the Port, which will be a dictionary of its attributes</span>

<span class="sd">        :returns: a dictionary of the stringified Port attributes</span>
<span class="sd">        :rtype: dict</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">description</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">),</span>
            <span class="s1">&#39;required&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">required</span><span class="p">),</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">valid_type</span><span class="p">:</span>
            <span class="n">description</span><span class="p">[</span><span class="s1">&#39;valid_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">valid_type</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">help</span><span class="p">:</span>
            <span class="n">description</span><span class="p">[</span><span class="s1">&#39;help&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">help</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>

        <span class="k">return</span> <span class="n">description</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">valid_type</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get the valid value type for this port if one is specified</span>

<span class="sd">        :return: the value value type</span>
<span class="sd">        :rtype: type</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_valid_type</span>

    <span class="nd">@valid_type</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">valid_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">valid_type</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set the valid value type for this port</span>

<span class="sd">        :param valid_type: the value valid type</span>
<span class="sd">        :type valid_type: type</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_valid_type</span> <span class="o">=</span> <span class="n">valid_type</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">help</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get the help string for this port</span>

<span class="sd">        :return: the help string</span>
<span class="sd">        :rtype: str</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_help</span>

    <span class="nd">@help</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">help</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">help</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set the help string for this port</span>

<span class="sd">        :param help: the help string</span>
<span class="sd">        :type help: str</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_help</span> <span class="o">=</span> <span class="n">help</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">required</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Is this port required?</span>

<span class="sd">        :return: True if required, False otherwise</span>
<span class="sd">        :rtype: bool</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_required</span>

    <span class="nd">@required</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">required</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">required</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set whether this port is required or not</span>

<span class="sd">        :return: True if required, False otherwise</span>
<span class="sd">        :type required: bool</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_required</span> <span class="o">=</span> <span class="n">required</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">validator</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get the validator for this port</span>

<span class="sd">        :return: the validator</span>
<span class="sd">        :rtype: typing.Callable[[typing.Any], typing.Tuple[bool, typing.Optional[str]]]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validator</span>

    <span class="nd">@validator</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">validator</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">validator</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set the validator for this port</span>

<span class="sd">        :param validator: a validator function</span>
<span class="sd">        :type validator: typing.Callable[[typing.Any], typing.Tuple[bool, typing.Optional[str]]]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_validator</span> <span class="o">=</span> <span class="n">validator</span>

    <span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">breadcrumbs</span><span class="o">=</span><span class="p">()):</span>
        <span class="sd">&quot;&quot;&quot;Validate a value to see if it is valid for this port</span>

<span class="sd">        :param value: the value to check</span>
<span class="sd">        :type value: typing.Any</span>
<span class="sd">        :param breadcrumbs: a tuple of the path to having reached this point in validation</span>
<span class="sd">        :type breadcrumbs: typing.Tuple[str]</span>
<span class="sd">        :return: None or tuple containing 0: error string 1: tuple of breadcrumb strings to where the validation failed</span>
<span class="sd">        :rtype: typing.Optional[ValidationError]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">validation_error</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="n">UNSPECIFIED</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_required</span><span class="p">:</span>
            <span class="n">validation_error</span> <span class="o">=</span> <span class="s2">&quot;required value was not provided for &#39;</span><span class="si">{}</span><span class="s2">&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">UNSPECIFIED</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_valid_type</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_valid_type</span><span class="p">):</span>
            <span class="n">validation_error</span> <span class="o">=</span> <span class="s2">&quot;value &#39;</span><span class="si">{}</span><span class="s2">&#39; is not of the right type. Got &#39;</span><span class="si">{}</span><span class="s2">&#39;, expected &#39;</span><span class="si">{}</span><span class="s2">&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_valid_type</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">validation_error</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validator</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">spec</span> <span class="o">=</span> <span class="n">get_arg_spec</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">validator</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">spec</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">VALIDATOR_SIGNATURE_DEPRECATION_WARNING</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">validator</span><span class="o">.</span><span class="vm">__name__</span><span class="p">))</span>
                <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">validator</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">validator</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="nb">str</span><span class="p">),</span> <span class="s2">&quot;Validator returned non string type&quot;</span>
                <span class="n">validation_error</span> <span class="o">=</span> <span class="n">result</span>

        <span class="k">if</span> <span class="n">validation_error</span><span class="p">:</span>
            <span class="n">breadcrumbs</span> <span class="o">+=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,)</span>
            <span class="k">return</span> <span class="n">PortValidationError</span><span class="p">(</span><span class="n">validation_error</span><span class="p">,</span> <span class="n">breadcrumbs_to_port</span><span class="p">(</span><span class="n">breadcrumbs</span><span class="p">))</span>


<span class="k">class</span> <span class="nc">InputPort</span><span class="p">(</span><span class="n">Port</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A simple input port for a value being received by a process</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">required_override</span><span class="p">(</span><span class="n">required</span><span class="p">,</span> <span class="n">default</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        If a default is specified an input should no longer be marked</span>
<span class="sd">        as required. Otherwise the input should always be marked explicitly</span>
<span class="sd">        to be not required even if a default is specified.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">default</span> <span class="ow">is</span> <span class="n">UNSPECIFIED</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">required</span>

        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">valid_type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">UNSPECIFIED</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">validator</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">InputPort</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">name</span><span class="p">,</span>
            <span class="n">valid_type</span><span class="o">=</span><span class="n">valid_type</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="n">help</span><span class="p">,</span>
            <span class="n">required</span><span class="o">=</span><span class="n">InputPort</span><span class="o">.</span><span class="n">required_override</span><span class="p">(</span><span class="n">required</span><span class="p">,</span> <span class="n">default</span><span class="p">),</span>
            <span class="n">validator</span><span class="o">=</span><span class="n">validator</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">required</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">InputPort</span><span class="o">.</span><span class="n">required_override</span><span class="p">(</span><span class="n">required</span><span class="p">,</span> <span class="n">default</span><span class="p">):</span>
            <span class="n">_LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;the required attribute for the input port &#39;</span><span class="si">{}</span><span class="s2">&#39; was overridden &quot;</span>
                         <span class="s2">&quot;because a default was specified&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">default</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">UNSPECIFIED</span><span class="p">:</span>

            <span class="c1"># Only validate the default value if it is not a callable. If it is a callable its return value will always</span>
            <span class="c1"># be validated when the port is validated upon process construction, if the default is was actually used.</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">callable</span><span class="p">(</span><span class="n">default</span><span class="p">):</span>
                <span class="n">validation_error</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">validate</span><span class="p">(</span><span class="n">default</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">validation_error</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid default value: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">validation_error</span><span class="o">.</span><span class="n">message</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_default</span> <span class="o">=</span> <span class="n">default</span>

    <span class="k">def</span> <span class="nf">has_default</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_default</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">UNSPECIFIED</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">default</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_default</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;No default&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_default</span>

    <span class="nd">@default</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">default</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">default</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_default</span> <span class="o">=</span> <span class="n">default</span>

    <span class="k">def</span> <span class="nf">get_description</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a description of the InputPort, which will be a dictionary of its attributes</span>

<span class="sd">        :returns: a dictionary of the stringified InputPort attributes</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">description</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">InputPort</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">get_description</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_default</span><span class="p">():</span>
            <span class="n">description</span><span class="p">[</span><span class="s1">&#39;default&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">default</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">description</span>


<div class="viewcode-block" id="OutputPort"><a class="viewcode-back" href="../../apidoc/aiida.engine.processes.html#aiida.engine.OutputPort">[docs]</a><span class="k">class</span> <span class="nc">OutputPort</span><span class="p">(</span><span class="n">Port</span><span class="p">):</span>
    <span class="k">pass</span></div>


<span class="k">class</span> <span class="nc">PortNamespace</span><span class="p">(</span><span class="n">collections</span><span class="o">.</span><span class="n">MutableMapping</span><span class="p">,</span> <span class="n">Port</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A container for Ports. Effectively it maintains a dictionary whose members are</span>
<span class="sd">    either a Port or yet another PortNamespace. This allows for the nesting of ports</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">NAMESPACE_SEPARATOR</span> <span class="o">=</span> <span class="s1">&#39;.&#39;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">help</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                 <span class="n">validator</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">valid_type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">default</span><span class="o">=</span><span class="n">UNSPECIFIED</span><span class="p">,</span>
                 <span class="n">dynamic</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                 <span class="n">populate_defaults</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Construct a port namespace.</span>

<span class="sd">        :param name: the name of the namespace</span>
<span class="sd">        :param help: the help string</span>
<span class="sd">        :param required: boolean, if `True` the validation will fail if no value is specified for this namespace</span>
<span class="sd">        :param validator: an optional validator for the namespace</span>
<span class="sd">        :param valid_type: optional tuple of valid types in the case of a dynamic namespace</span>
<span class="sd">        :param default: default value for the port</span>
<span class="sd">        :param dynamic: boolean, if `True`, the namespace will accept values even when no explicit port is defined</span>
<span class="sd">        :param populate_defaults: boolean, when set to `False`, the populating of defaults for this namespace is skipped</span>
<span class="sd">            entirely, including all nested namespaces, if no explicit value is passed for this port in the parent</span>
<span class="sd">            namespace. As soon as a value is specified in the parent namespace for this port, even if it is empty, this</span>
<span class="sd">            property is ignored and the population of defaults is always performed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">PortNamespace</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="n">help</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="n">required</span><span class="p">,</span> <span class="n">validator</span><span class="o">=</span><span class="n">validator</span><span class="p">,</span> <span class="n">valid_type</span><span class="o">=</span><span class="n">valid_type</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ports</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_default</span> <span class="o">=</span> <span class="n">default</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dynamic</span> <span class="o">=</span> <span class="n">dynamic</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_populate_defaults</span> <span class="o">=</span> <span class="n">populate_defaults</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_description</span><span class="p">(),</span> <span class="n">sort_keys</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ports</span><span class="o">.</span><span class="fm">__iter__</span><span class="p">()</span>

    <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ports</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__delitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ports</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>

    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ports</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>

    <span class="k">def</span> <span class="fm">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">port</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">port</span><span class="p">,</span> <span class="n">Port</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;port needs to be an instance of Port&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ports</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">port</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">ports</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ports</span>

    <span class="k">def</span> <span class="nf">has_default</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_default</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">UNSPECIFIED</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">default</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_default</span>

    <span class="nd">@default</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">default</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">default</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_default</span> <span class="o">=</span> <span class="n">default</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">dynamic</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dynamic</span>

    <span class="nd">@dynamic</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">dynamic</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dynamic</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dynamic</span> <span class="o">=</span> <span class="n">dynamic</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">valid_type</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">PortNamespace</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">valid_type</span>

    <span class="nd">@valid_type</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">valid_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">valid_type</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Will set the valid_type for the PortNamespace. If the valid_type is None, the dynamic property</span>
<span class="sd">        will be set to False, in all other cases dynamic will be set to True</span>

<span class="sd">        :param valid_type: a tuple or single valid type that the namespace accepts</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">valid_type</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dynamic</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dynamic</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="nb">super</span><span class="p">(</span><span class="n">PortNamespace</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">)</span><span class="o">.</span><span class="n">valid_type</span><span class="o">.</span><span class="n">fset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">valid_type</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">populate_defaults</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_populate_defaults</span>

    <span class="nd">@populate_defaults</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">populate_defaults</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">populate_defaults</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_populate_defaults</span> <span class="o">=</span> <span class="n">populate_defaults</span>

    <span class="k">def</span> <span class="nf">get_description</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a dictionary with a description of the ports this namespace contains</span>
<span class="sd">        Nested PortNamespaces will be properly recursed and Ports will print their properties in a list</span>

<span class="sd">        :returns: a dictionary of descriptions of the Ports contained within this PortNamespace</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">description</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;_attrs&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">default</span><span class="p">,</span>
                <span class="s1">&#39;dynamic&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">dynamic</span><span class="p">,</span>
                <span class="s1">&#39;valid_type&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">valid_type</span><span class="p">),</span>
                <span class="s1">&#39;required&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">required</span><span class="p">),</span>
                <span class="s1">&#39;help&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">help</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">port</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ports</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">description</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">port</span><span class="o">.</span><span class="n">get_description</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">description</span>

    <span class="k">def</span> <span class="nf">get_port</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieve a (namespaced) port from this PortNamespace. If any of the sub namespaces of the terminal</span>
<span class="sd">        port itself cannot be found, a ValueError will be raised</span>

<span class="sd">        :param name: name (potentially namespaced) of the port to retrieve</span>
<span class="sd">        :returns: Port</span>
<span class="sd">        :raises: ValueError if port or namespace does not exist</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">six</span><span class="o">.</span><span class="n">string_types</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;name has to be a string type, not </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">name</span><span class="p">)))</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">name</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;name cannot be an empty string&#39;</span><span class="p">)</span>

        <span class="n">namespace</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">NAMESPACE_SEPARATOR</span><span class="p">)</span>
        <span class="n">port_name</span> <span class="o">=</span> <span class="n">namespace</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">port_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;port &#39;</span><span class="si">{}</span><span class="s2">&#39; does not exist in port namespace &#39;</span><span class="si">{}</span><span class="s2">&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">port_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">namespace</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="n">port_name</span><span class="p">]</span><span class="o">.</span><span class="n">get_port</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">NAMESPACE_SEPARATOR</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">namespace</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="n">port_name</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">create_port_namespace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create and return a new PortNamespace in this PortNamespace. If the name is namespaced, the sub PortNamespaces</span>
<span class="sd">        will be created recursively, except if one of the namespaces is already occupied at any level by</span>
<span class="sd">        a Port in which case a ValueError will be thrown</span>

<span class="sd">        :param name: name (potentially namespaced) of the port to create and return</span>
<span class="sd">        :param kwargs: constructor arguments that will be used *only* for the construction of the terminal PortNamespace</span>
<span class="sd">        :returns: PortNamespace</span>
<span class="sd">        :raises: ValueError if any sub namespace is occupied by a non-PortNamespace port</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">six</span><span class="o">.</span><span class="n">string_types</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;name has to be a string type, not </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">name</span><span class="p">)))</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">name</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;name cannot be an empty string&#39;</span><span class="p">)</span>

        <span class="n">namespace</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">NAMESPACE_SEPARATOR</span><span class="p">)</span>
        <span class="n">port_name</span> <span class="o">=</span> <span class="n">namespace</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">port_name</span> <span class="ow">in</span> <span class="bp">self</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="n">port_name</span><span class="p">],</span> <span class="n">PortNamespace</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;the name &#39;</span><span class="si">{}</span><span class="s2">&#39; in &#39;</span><span class="si">{}</span><span class="s2">&#39; already contains a Port&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">port_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>

        <span class="c1"># If this is True, the (sub) port namespace does not yet exist, so we create it</span>
        <span class="k">if</span> <span class="n">port_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>

            <span class="c1"># If there still is a `namespace`, we create a sub namespace, *without* the constructor arguments</span>
            <span class="k">if</span> <span class="n">namespace</span><span class="p">:</span>
                <span class="bp">self</span><span class="p">[</span><span class="n">port_name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="n">port_name</span><span class="p">)</span>

            <span class="c1"># Otherwise it is the terminal port and we construct *with* the keyword arugments</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="p">[</span><span class="n">port_name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="n">port_name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">namespace</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="n">port_name</span><span class="p">]</span><span class="o">.</span><span class="n">create_port_namespace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">NAMESPACE_SEPARATOR</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">namespace</span><span class="p">),</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="n">port_name</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">absorb</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">port_namespace</span><span class="p">,</span> <span class="n">exclude</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">include</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">namespace_options</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Absorb another PortNamespace instance into oneself, including all its mutable properties and ports.</span>

<span class="sd">        Mutable properties of self will be overwritten with those of the port namespace that is to be absorbed.</span>
<span class="sd">        The same goes for the ports, meaning that any ports with a key that already exists in self will</span>
<span class="sd">        be overwritten. The namespace_options dictionary can be used to yet override the mutable properties of</span>
<span class="sd">        the port namespace that is to be absorbed. The exclude and include tuples can be used to exclude or</span>
<span class="sd">        include certain ports and both are mutually exclusive.</span>

<span class="sd">        :param port_namespace: instance of PortNamespace that is to be absorbed into self</span>
<span class="sd">        :param exclude: list or tuple of input keys to exclude from being exposed</span>
<span class="sd">        :param include: list or tuple of input keys to include as exposed inputs</span>
<span class="sd">        :param namespace_options: a dictionary with mutable PortNamespace property values to override</span>
<span class="sd">        :return: list of the names of the ports that were absorbed</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">port_namespace</span><span class="p">,</span> <span class="n">PortNamespace</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;port_namespace has to be an instance of PortNamespace&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">exclude</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">include</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;exclude and include are mutually exclusive&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">exclude</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">type_check</span><span class="p">(</span><span class="n">exclude</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">include</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">type_check</span><span class="p">(</span><span class="n">include</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">namespace_options</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">namespace_options</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># Overload mutable attributes of PortNamespace unless overridden by value in namespace_options</span>
        <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="n">port_namespace</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">is_mutable_property</span><span class="p">(</span><span class="n">PortNamespace</span><span class="p">,</span> <span class="n">attr</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">attr</span> <span class="ow">in</span> <span class="n">namespace_options</span><span class="p">:</span>
                    <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">namespace_options</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">attr</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">port_namespace</span><span class="p">,</span> <span class="n">attr</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">namespace_options</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;the namespace_options </span><span class="si">{}</span><span class="s1">, is not a supported PortNamespace property&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="nb">list</span><span class="p">(</span><span class="n">namespace_options</span><span class="o">.</span><span class="n">keys</span><span class="p">()))))</span>

        <span class="n">absorbed_ports</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">port_name</span><span class="p">,</span> <span class="n">port</span> <span class="ow">in</span> <span class="n">port_namespace</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>

            <span class="c1"># If the current port name occurs in the exclude list, simply skip it entirely, there is no need to consider</span>
            <span class="c1"># any of the nested ports it might have, even if it is a port namespace</span>
            <span class="k">if</span> <span class="n">exclude</span> <span class="ow">and</span> <span class="n">port_name</span> <span class="ow">in</span> <span class="n">exclude</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">port</span><span class="p">,</span> <span class="n">PortNamespace</span><span class="p">):</span>

                <span class="c1"># If the name does not appear at the start of any of the include rules we continue:</span>
                <span class="k">if</span> <span class="n">include</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">([</span><span class="n">rule</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">port_name</span><span class="p">)</span> <span class="k">for</span> <span class="n">rule</span> <span class="ow">in</span> <span class="n">include</span><span class="p">]):</span>
                    <span class="k">continue</span>

                <span class="c1"># Determine the sub exclude and include rules for this specific namespace</span>
                <span class="n">sub_exclude</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">strip_namespace</span><span class="p">(</span><span class="n">port_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">NAMESPACE_SEPARATOR</span><span class="p">,</span> <span class="n">exclude</span><span class="p">)</span>
                <span class="n">sub_include</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">strip_namespace</span><span class="p">(</span><span class="n">port_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">NAMESPACE_SEPARATOR</span><span class="p">,</span> <span class="n">include</span><span class="p">)</span>

                <span class="c1"># Create a new namespace at `port_name` and copy the original port namespace itself such that we keep</span>
                <span class="c1"># all its mutable properties, but reset its ports, since those will be taken care of by the recursive</span>
                <span class="c1"># absorb call that will properly consider the include and exclude rules</span>
                <span class="bp">self</span><span class="p">[</span><span class="n">port_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">port</span><span class="p">)</span>
                <span class="bp">self</span><span class="p">[</span><span class="n">port_name</span><span class="p">]</span><span class="o">.</span><span class="n">_ports</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="bp">self</span><span class="p">[</span><span class="n">port_name</span><span class="p">]</span><span class="o">.</span><span class="n">absorb</span><span class="p">(</span><span class="n">port</span><span class="p">,</span> <span class="n">sub_exclude</span><span class="p">,</span> <span class="n">sub_include</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># If include rules are specified but the port name does not appear, simply skip it</span>
                <span class="k">if</span> <span class="n">include</span> <span class="ow">and</span> <span class="n">port_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">include</span><span class="p">:</span>
                    <span class="k">continue</span>

                <span class="bp">self</span><span class="p">[</span><span class="n">port_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">port</span><span class="p">)</span>

            <span class="n">absorbed_ports</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">port_name</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">absorbed_ports</span>

    <span class="k">def</span> <span class="nf">project</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">port_values</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Project a (nested) dictionary of port values onto the port dictionary of this PortNamespace. That is</span>
<span class="sd">        to say, return those keys of the dictionary that are shared by this PortNamespace. If a matching key</span>
<span class="sd">        corresponds to another PortNamespace, this method will be called recursively, passing the sub dictionary</span>
<span class="sd">        belonging to that port name.</span>

<span class="sd">        :param port_values: a dictionary where keys are port names and values are actual input values</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">port_values</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ports</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">PortNamespace</span><span class="p">):</span>
                    <span class="n">result</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">project</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">result</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">port_values</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">breadcrumbs</span><span class="o">=</span><span class="p">()):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Validate the namespace port itself and subsequently all the port_values it contains</span>

<span class="sd">        :param port_values: an arbitrarily nested dictionary of parsed port values</span>
<span class="sd">        :type port_values: dict</span>
<span class="sd">        :param breadcrumbs: a tuple of the path to having reached this point in validation</span>
<span class="sd">        :type breadcrumbs: typing.Tuple[str]</span>
<span class="sd">        :return: None or tuple containing 0: error string 1: tuple of breadcrumb strings to where the validation failed</span>
<span class="sd">        :rtype: typing.Optional[ValidationError]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">breadcrumbs_local</span> <span class="o">=</span> <span class="n">breadcrumbs</span> <span class="o">+</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">port_values</span><span class="p">:</span>
            <span class="n">port_values</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">port_values</span><span class="p">,</span> <span class="n">collections</span><span class="o">.</span><span class="n">Mapping</span><span class="p">):</span>
            <span class="n">message</span> <span class="o">=</span> <span class="s1">&#39;specified value is of type </span><span class="si">{}</span><span class="s1"> which is not sub class of `Mapping`&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">port_values</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">PortValidationError</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">breadcrumbs_to_port</span><span class="p">(</span><span class="n">breadcrumbs_local</span><span class="p">))</span>

        <span class="c1"># Turn the port values into a normal dictionary and create a shallow copy. The `validate_ports` method to which</span>
        <span class="c1"># the `port_values` will be passed, will pop the values corresponding to explicit ports. This is necessary for</span>
        <span class="c1"># the `validate_dynamic_ports` to correctly detect any implicit ports. However, the `validator` will expect the</span>
        <span class="c1"># entire original input namespace to be there. Since the latter has to be called after the ports have been</span>
        <span class="c1"># validated, we need to create a clone of the port values here.</span>
        <span class="n">port_values</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">port_values</span><span class="p">)</span>
        <span class="n">port_values_clone</span> <span class="o">=</span> <span class="n">port_values</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="c1"># If the namespace is not required and there are no port_values specified, consider it valid</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">port_values</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">required</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="c1"># In all other cases, validate all input ports explicitly specified in this port namespace</span>
        <span class="n">validation_error</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">validate_ports</span><span class="p">(</span><span class="n">port_values</span><span class="p">,</span> <span class="n">breadcrumbs_local</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">validation_error</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">validation_error</span>

        <span class="c1"># If any port_values remain, validate against the dynamic properties of the namespace</span>
        <span class="n">validation_error</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">validate_dynamic_ports</span><span class="p">(</span><span class="n">port_values</span><span class="p">,</span> <span class="n">breadcrumbs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">validation_error</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">validation_error</span>

        <span class="c1"># Validate the validator after the ports themselves, as it most likely will rely on the port values</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">validator</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">spec</span> <span class="o">=</span> <span class="n">get_arg_spec</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">validator</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">spec</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">VALIDATOR_SIGNATURE_DEPRECATION_WARNING</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">validator</span><span class="o">.</span><span class="vm">__name__</span><span class="p">))</span>
                <span class="n">message</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">validator</span><span class="p">(</span><span class="n">port_values_clone</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">message</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">validator</span><span class="p">(</span><span class="n">port_values_clone</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">message</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="nb">str</span><span class="p">),</span> \
                    <span class="s2">&quot;Validator returned something other than None or str: &#39;</span><span class="si">{}</span><span class="s2">&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">message</span><span class="p">))</span>
                <span class="k">return</span> <span class="n">PortValidationError</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">breadcrumbs_to_port</span><span class="p">(</span><span class="n">breadcrumbs_local</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">pre_process</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">port_values</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Map port values onto the port namespace, filling in values for ports with a default.</span>

<span class="sd">        :param port_values: the dictionary with supplied port values</span>
<span class="sd">        :return: an AttributesFrozenDict with pre-processed port value mapping, complemented with port default values</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">utils</span>

        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">port</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>

            <span class="c1"># If the port was not specified in the inputs values and the port is a namespace with the property</span>
            <span class="c1"># `populate_defaults=False`, we skip the pre-processing and do not populate defaults.</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">port_values</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">port</span><span class="p">,</span> <span class="n">PortNamespace</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">port</span><span class="o">.</span><span class="n">populate_defaults</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">port_values</span><span class="p">:</span>

                <span class="k">if</span> <span class="n">port</span><span class="o">.</span><span class="n">has_default</span><span class="p">():</span>
                    <span class="n">default</span> <span class="o">=</span> <span class="n">port</span><span class="o">.</span><span class="n">default</span>
                    <span class="k">if</span> <span class="n">callable</span><span class="p">(</span><span class="n">default</span><span class="p">):</span>
                        <span class="n">port_value</span> <span class="o">=</span> <span class="n">default</span><span class="p">()</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">port_value</span> <span class="o">=</span> <span class="n">default</span>
                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">port</span><span class="p">,</span> <span class="n">PortNamespace</span><span class="p">):</span>
                    <span class="n">port_value</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">continue</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">port_value</span> <span class="o">=</span> <span class="n">port_values</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">port</span><span class="p">,</span> <span class="n">PortNamespace</span><span class="p">):</span>
                <span class="n">port_values</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">port</span><span class="o">.</span><span class="n">pre_process</span><span class="p">(</span><span class="n">port_value</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">port_values</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">port_value</span>

        <span class="k">return</span> <span class="n">utils</span><span class="o">.</span><span class="n">AttributesFrozendict</span><span class="p">(</span><span class="n">port_values</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">validate_ports</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">port_values</span><span class="p">,</span> <span class="n">breadcrumbs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Validate port values with respect to the explicitly defined ports of the port namespace.</span>
<span class="sd">        Ports values that are matched to an actual Port will be popped from the dictionary</span>

<span class="sd">        :param port_values: an arbitrarily nested dictionary of parsed port values</span>
<span class="sd">        :type port_values: dict</span>
<span class="sd">        :param breadcrumbs: a tuple of breadcrumbs showing the path to to the value being validated</span>
<span class="sd">        :type breadcrumbs: tuple</span>
<span class="sd">        :return: None or tuple containing 0: error string 1: tuple of breadcrumb strings to where the validation failed</span>
<span class="sd">        :rtype: typing.Optional[ValidationError]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">port</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ports</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">validation_error</span> <span class="o">=</span> <span class="n">port</span><span class="o">.</span><span class="n">validate</span><span class="p">(</span><span class="n">port_values</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">UNSPECIFIED</span><span class="p">),</span> <span class="n">breadcrumbs</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">validation_error</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">validation_error</span>

    <span class="k">def</span> <span class="nf">validate_dynamic_ports</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">port_values</span><span class="p">,</span> <span class="n">breadcrumbs</span><span class="o">=</span><span class="p">()):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Validate port values with respect to the dynamic properties of the port namespace. It will</span>
<span class="sd">        check if the namespace is actually dynamic and if all values adhere to the valid types of</span>
<span class="sd">        the namespace if those are specified</span>

<span class="sd">        :param port_values: an arbitrarily nested dictionary of parsed port values</span>
<span class="sd">        :type port_values: dict</span>
<span class="sd">        :param breadcrumbs: a tuple of the path to having reached this point in validation</span>
<span class="sd">        :type breadcrumbs: typing.Tuple[str]</span>
<span class="sd">        :return: if invalid returns a string with the reason for the validation failure, otherwise None</span>
<span class="sd">        :rtype: typing.Optional[str]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">breadcrumbs</span> <span class="o">+=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,)</span>

        <span class="k">if</span> <span class="n">port_values</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">dynamic</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;Unexpected ports </span><span class="si">{}</span><span class="s1">, for a non dynamic namespace&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">port_values</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">PortValidationError</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">breadcrumbs_to_port</span><span class="p">(</span><span class="n">breadcrumbs</span><span class="p">))</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">valid_type</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">valid_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">valid_type</span>
            <span class="k">for</span> <span class="n">port_name</span><span class="p">,</span> <span class="n">port_value</span> <span class="ow">in</span> <span class="n">port_values</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">port_value</span><span class="p">,</span> <span class="n">valid_type</span><span class="p">):</span>
                    <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;Invalid type </span><span class="si">{}</span><span class="s1"> for dynamic port value: expected </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">port_value</span><span class="p">),</span> <span class="n">valid_type</span><span class="p">)</span>
                    <span class="k">return</span> <span class="n">PortValidationError</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">breadcrumbs_to_port</span><span class="p">(</span><span class="n">breadcrumbs</span> <span class="o">+</span> <span class="p">(</span><span class="n">port_name</span><span class="p">,)))</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">strip_namespace</span><span class="p">(</span><span class="n">namespace</span><span class="p">,</span> <span class="n">separator</span><span class="p">,</span> <span class="n">rules</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Filter given exclude/include rules staring with namespace and strip the first level.</span>

<span class="sd">        For example if the namespace is `base` and the rules are::</span>

<span class="sd">            (&#39;base.a&#39;, &#39;base.sub.b&#39;,&#39;relax.base.c&#39;, &#39;d&#39;)</span>

<span class="sd">        the function will return::</span>

<span class="sd">            (&#39;a&#39;, &#39;sub.c&#39;)</span>

<span class="sd">        If the rules are `None`, that is what is returned as well.</span>

<span class="sd">        :param namespace: the string name of the namespace</span>
<span class="sd">        :param separator: the namespace separator string</span>
<span class="sd">        :param rules: the list or tuple of exclude or include rules to strip</span>
<span class="sd">        :return: `None` if `rules=None` or the list of stripped rules</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">rules</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">rules</span>

        <span class="n">stripped</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">prefix</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">namespace</span><span class="p">,</span> <span class="n">separator</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">rule</span> <span class="ow">in</span> <span class="n">rules</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">rule</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">prefix</span><span class="p">):</span>
                <span class="n">stripped</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rule</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">prefix</span><span class="p">):])</span>

        <span class="k">return</span> <span class="n">stripped</span>


<span class="k">def</span> <span class="nf">breadcrumbs_to_port</span><span class="p">(</span><span class="n">breadcrumbs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Convert breadcrumbs to a string representing the port</span>

<span class="sd">    :param breadcrumbs: a tuple of the path to the port</span>
<span class="sd">    :type breadcrumbs: typing.Tuple[str]</span>
<span class="sd">    :return: the port string</span>
<span class="sd">    :rtype: str</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">PortNamespace</span><span class="o">.</span><span class="n">NAMESPACE_SEPARATOR</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">breadcrumbs</span><span class="p">)</span>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, ECOLE POLYTECHNIQUE FEDERALE DE LAUSANNE (Theory and Simulation of Materials (THEOS) and National Centre for Computational Design and Discovery of Novel Materials (NCCR MARVEL)), Switzerland and ROBERT BOSCH LLC, USA. All rights reserved

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>