

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>aiida.manage.configuration.setup &mdash; AiiDA 1.2.1 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../../" src="../../../../_static/documentation_options.js"></script>
        <script src="../../../../_static/jquery.js"></script>
        <script src="../../../../_static/underscore.js"></script>
        <script src="../../../../_static/doctools.js"></script>
        <script src="../../../../_static/language_data.js"></script>
        <script src="../../../../_static/togglebutton.js"></script>
        <script src="../../../../_static/contentui.js"></script>
        <script >var togglebuttonSelector = '.toggle';</script>
    
    <script type="text/javascript" src="../../../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/togglebutton.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/contentui.css" type="text/css" />
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../../index.html" class="icon icon-home"> AiiDA
          

          
          </a>

          
            
            
              <div class="version">
                1.2
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../intro/about.html">What is AiiDA</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../intro/get_started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../intro/installation.html">Advanced Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../intro/troubleshooting.html">Troubleshooting</a></li>
</ul>
<p class="caption"><span class="caption-text">Tutorial</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../tutorial/placeholder.html">Placeholder</a></li>
</ul>
<p class="caption"><span class="caption-text">How-To Guides</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../howto/placeholder.html">Placeholder</a></li>
</ul>
<p class="caption"><span class="caption-text">Topics</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../topics/placeholder.html">Placeholder</a></li>
</ul>
<p class="caption"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../reference/placeholder.html">Placeholder</a></li>
</ul>
<p class="caption"><span class="caption-text">Plugins</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../plugins/placeholder.html">Placeholder</a></li>
</ul>
<p class="caption"><span class="caption-text">Development</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../development/placeholder.html">Placeholder</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">AiiDA</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../../index.html">Module code</a> &raquo;</li>
        
          <li><a href="../../../aiida.html">aiida</a> &raquo;</li>
        
          <li><a href="../configuration.html">aiida.manage.configuration</a> &raquo;</li>
        
      <li>aiida.manage.configuration.setup</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for aiida.manage.configuration.setup</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="c1">###########################################################################</span>
<span class="c1"># Copyright (c), The AiiDA team. All rights reserved.                     #</span>
<span class="c1"># This file is part of the AiiDA code.                                    #</span>
<span class="c1">#                                                                         #</span>
<span class="c1"># The code is hosted on GitHub at https://github.com/aiidateam/aiida-core #</span>
<span class="c1"># For further information on the license, see the LICENSE.txt file        #</span>
<span class="c1"># For further information please visit http://www.aiida.net               #</span>
<span class="c1">###########################################################################</span>
<span class="sd">&quot;&quot;&quot;Module that defines methods required to setup a new AiiDA instance.&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">urllib.parse</span>

<span class="kn">import</span> <span class="nn">click</span>

<span class="kn">from</span> <span class="nn">aiida.cmdline.utils</span> <span class="kn">import</span> <span class="n">echo</span>


<div class="viewcode-block" id="delete_repository"><a class="viewcode-back" href="../../../../apidoc/aiida.manage.configuration.html#aiida.manage.configuration.setup.delete_repository">[docs]</a><span class="k">def</span> <span class="nf">delete_repository</span><span class="p">(</span><span class="n">profile</span><span class="p">,</span> <span class="n">non_interactive</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Delete an AiiDA file repository associated with an AiiDA profile.</span>

<span class="sd">    :param profile: AiiDA Profile</span>
<span class="sd">    :type profile: :class:`aiida.manage.configuration.profile.Profile`</span>
<span class="sd">    :param non_interactive: do not prompt for configuration values, fail if not all values are given as kwargs.</span>
<span class="sd">    :type non_interactive: bool</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">repo_path</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">parse</span><span class="o">.</span><span class="n">urlparse</span><span class="p">(</span><span class="n">profile</span><span class="o">.</span><span class="n">repository_uri</span><span class="p">)</span><span class="o">.</span><span class="n">path</span>
    <span class="n">repo_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="n">repo_path</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isabs</span><span class="p">(</span><span class="n">repo_path</span><span class="p">):</span>
        <span class="n">echo</span><span class="o">.</span><span class="n">echo_info</span><span class="p">(</span><span class="s2">&quot;Associated file repository &#39;</span><span class="si">{}</span><span class="s2">&#39; does not exist.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">repo_path</span><span class="p">))</span>
        <span class="k">return</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">repo_path</span><span class="p">):</span>
        <span class="n">echo</span><span class="o">.</span><span class="n">echo_info</span><span class="p">(</span><span class="s2">&quot;Associated file repository &#39;</span><span class="si">{}</span><span class="s2">&#39; is not a directory.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">repo_path</span><span class="p">))</span>
        <span class="k">return</span>

    <span class="k">if</span> <span class="n">non_interactive</span> <span class="ow">or</span> <span class="n">click</span><span class="o">.</span><span class="n">confirm</span><span class="p">(</span>
        <span class="s2">&quot;Delete associated file repository &#39;</span><span class="si">{}</span><span class="s2">&#39;?</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="s1">&#39;WARNING: All data will be lost.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">repo_path</span><span class="p">)</span>
    <span class="p">):</span>
        <span class="n">echo</span><span class="o">.</span><span class="n">echo_info</span><span class="p">(</span><span class="s2">&quot;Deleting directory &#39;</span><span class="si">{}</span><span class="s2">&#39;.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">repo_path</span><span class="p">))</span>
        <span class="kn">import</span> <span class="nn">shutil</span>
        <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">repo_path</span><span class="p">)</span></div>


<div class="viewcode-block" id="delete_db"><a class="viewcode-back" href="../../../../apidoc/aiida.manage.configuration.html#aiida.manage.configuration.setup.delete_db">[docs]</a><span class="k">def</span> <span class="nf">delete_db</span><span class="p">(</span><span class="n">profile</span><span class="p">,</span> <span class="n">non_interactive</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Delete an AiiDA database associated with an AiiDA profile.</span>

<span class="sd">    :param profile: AiiDA Profile</span>
<span class="sd">    :type profile: :class:`aiida.manage.configuration.profile.Profile`</span>
<span class="sd">    :param non_interactive: do not prompt for configuration values, fail if not all values are given as kwargs.</span>
<span class="sd">    :type non_interactive: bool</span>
<span class="sd">    :param verbose: if True, print parameters of DB connection</span>
<span class="sd">    :type verbose: bool</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">aiida.manage.configuration</span> <span class="kn">import</span> <span class="n">get_config</span>
    <span class="kn">from</span> <span class="nn">aiida.manage.external.postgres</span> <span class="kn">import</span> <span class="n">Postgres</span>
    <span class="kn">from</span> <span class="nn">aiida.common</span> <span class="kn">import</span> <span class="n">json</span>

    <span class="n">postgres</span> <span class="o">=</span> <span class="n">Postgres</span><span class="o">.</span><span class="n">from_profile</span><span class="p">(</span><span class="n">profile</span><span class="p">,</span> <span class="n">interactive</span><span class="o">=</span><span class="ow">not</span> <span class="n">non_interactive</span><span class="p">,</span> <span class="n">quiet</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="n">echo</span><span class="o">.</span><span class="n">echo_info</span><span class="p">(</span><span class="s1">&#39;Parameters used to connect to postgres:&#39;</span><span class="p">)</span>
        <span class="n">echo</span><span class="o">.</span><span class="n">echo</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">postgres</span><span class="o">.</span><span class="n">dbinfo</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">))</span>

    <span class="n">database_name</span> <span class="o">=</span> <span class="n">profile</span><span class="o">.</span><span class="n">database_name</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">postgres</span><span class="o">.</span><span class="n">db_exists</span><span class="p">(</span><span class="n">database_name</span><span class="p">):</span>
        <span class="n">echo</span><span class="o">.</span><span class="n">echo_info</span><span class="p">(</span><span class="s2">&quot;Associated database &#39;</span><span class="si">{}</span><span class="s2">&#39; does not exist.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">database_name</span><span class="p">))</span>
    <span class="k">elif</span> <span class="n">non_interactive</span> <span class="ow">or</span> <span class="n">click</span><span class="o">.</span><span class="n">confirm</span><span class="p">(</span>
        <span class="s2">&quot;Delete associated database &#39;</span><span class="si">{}</span><span class="s2">&#39;?</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="s1">&#39;WARNING: All data will be lost.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">database_name</span><span class="p">)</span>
    <span class="p">):</span>
        <span class="n">echo</span><span class="o">.</span><span class="n">echo_info</span><span class="p">(</span><span class="s2">&quot;Deleting database &#39;</span><span class="si">{}</span><span class="s2">&#39;.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">database_name</span><span class="p">))</span>
        <span class="n">postgres</span><span class="o">.</span><span class="n">drop_db</span><span class="p">(</span><span class="n">database_name</span><span class="p">)</span>

    <span class="n">user</span> <span class="o">=</span> <span class="n">profile</span><span class="o">.</span><span class="n">database_username</span>
    <span class="n">config</span> <span class="o">=</span> <span class="n">get_config</span><span class="p">()</span>
    <span class="n">users</span> <span class="o">=</span> <span class="p">[</span><span class="n">available_profile</span><span class="o">.</span><span class="n">database_username</span> <span class="k">for</span> <span class="n">available_profile</span> <span class="ow">in</span> <span class="n">config</span><span class="o">.</span><span class="n">profiles</span><span class="p">]</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">postgres</span><span class="o">.</span><span class="n">dbuser_exists</span><span class="p">(</span><span class="n">user</span><span class="p">):</span>
        <span class="n">echo</span><span class="o">.</span><span class="n">echo_info</span><span class="p">(</span><span class="s2">&quot;Associated database user &#39;</span><span class="si">{}</span><span class="s2">&#39; does not exist.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">user</span><span class="p">))</span>
    <span class="k">elif</span> <span class="n">users</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">user</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">echo</span><span class="o">.</span><span class="n">echo_info</span><span class="p">(</span>
            <span class="s2">&quot;Associated database user &#39;</span><span class="si">{}</span><span class="s2">&#39; is used by other profiles &quot;</span>
            <span class="s1">&#39;and will not be deleted.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>
        <span class="p">)</span>
    <span class="k">elif</span> <span class="n">non_interactive</span> <span class="ow">or</span> <span class="n">click</span><span class="o">.</span><span class="n">confirm</span><span class="p">(</span><span class="s2">&quot;Delete database user &#39;</span><span class="si">{}</span><span class="s2">&#39;?&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">user</span><span class="p">)):</span>
        <span class="n">echo</span><span class="o">.</span><span class="n">echo_info</span><span class="p">(</span><span class="s2">&quot;Deleting user &#39;</span><span class="si">{}</span><span class="s2">&#39;.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">user</span><span class="p">))</span>
        <span class="n">postgres</span><span class="o">.</span><span class="n">drop_dbuser</span><span class="p">(</span><span class="n">user</span><span class="p">)</span></div>


<div class="viewcode-block" id="delete_from_config"><a class="viewcode-back" href="../../../../apidoc/aiida.manage.configuration.html#aiida.manage.configuration.setup.delete_from_config">[docs]</a><span class="k">def</span> <span class="nf">delete_from_config</span><span class="p">(</span><span class="n">profile</span><span class="p">,</span> <span class="n">non_interactive</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Delete an AiiDA profile from the config file.</span>

<span class="sd">    :param profile: AiiDA Profile</span>
<span class="sd">    :type profile: :class:`aiida.manage.configuration.profile.Profile`</span>
<span class="sd">    :param non_interactive: do not prompt for configuration values, fail if not all values are given as kwargs.</span>
<span class="sd">    :type non_interactive: bool</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">aiida.manage.configuration</span> <span class="kn">import</span> <span class="n">get_config</span>

    <span class="k">if</span> <span class="n">non_interactive</span> <span class="ow">or</span> <span class="n">click</span><span class="o">.</span><span class="n">confirm</span><span class="p">(</span>
        <span class="s2">&quot;Delete configuration for profile &#39;</span><span class="si">{}</span><span class="s2">&#39;?</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="s1">&#39;WARNING: Permanently removes profile from the list of AiiDA profiles.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">profile</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
    <span class="p">):</span>
        <span class="n">echo</span><span class="o">.</span><span class="n">echo_info</span><span class="p">(</span><span class="s2">&quot;Deleting configuration for profile &#39;</span><span class="si">{}</span><span class="s2">&#39;.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">profile</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">get_config</span><span class="p">()</span>
        <span class="n">config</span><span class="o">.</span><span class="n">remove_profile</span><span class="p">(</span><span class="n">profile</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">config</span><span class="o">.</span><span class="n">store</span><span class="p">()</span></div>


<div class="viewcode-block" id="delete_profile"><a class="viewcode-back" href="../../../../apidoc/aiida.manage.configuration.html#aiida.manage.configuration.setup.delete_profile">[docs]</a><span class="k">def</span> <span class="nf">delete_profile</span><span class="p">(</span><span class="n">profile</span><span class="p">,</span> <span class="n">non_interactive</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">include_db</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">include_repository</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">include_config</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Delete an AiiDA profile and AiiDA user.</span>

<span class="sd">    :param profile: AiiDA profile</span>
<span class="sd">    :type profile: :class:`aiida.manage.configuration.profile.Profile`</span>
<span class="sd">    :param non_interactive: do not prompt for configuration values, fail if not all values are given as kwargs.</span>
<span class="sd">    :param include_db: Include deletion of associated database</span>
<span class="sd">    :type include_db: bool</span>
<span class="sd">    :param include_repository: Include deletion of associated file repository</span>
<span class="sd">    :type include_repository: bool</span>
<span class="sd">    :param include_config: Include deletion of entry from AiiDA configuration file</span>
<span class="sd">    :type include_config: bool</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">include_db</span><span class="p">:</span>
        <span class="n">delete_db</span><span class="p">(</span><span class="n">profile</span><span class="p">,</span> <span class="n">non_interactive</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">include_repository</span><span class="p">:</span>
        <span class="n">delete_repository</span><span class="p">(</span><span class="n">profile</span><span class="p">,</span> <span class="n">non_interactive</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">include_config</span><span class="p">:</span>
        <span class="n">delete_from_config</span><span class="p">(</span><span class="n">profile</span><span class="p">,</span> <span class="n">non_interactive</span><span class="p">)</span></div>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, ECOLE POLYTECHNIQUE FEDERALE DE LAUSANNE (Theory and Simulation of Materials (THEOS) and National Centre for Computational Design and Discovery of Novel Materials (NCCR MARVEL)), Switzerland and ROBERT BOSCH LLC, USA. All rights reserved

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>