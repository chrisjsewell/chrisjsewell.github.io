

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>aiida.orm.nodes.process.calculation.calcjob &mdash; AiiDA 1.2.1 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../../../../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../../../../" src="../../../../../../_static/documentation_options.js"></script>
        <script src="../../../../../../_static/jquery.js"></script>
        <script src="../../../../../../_static/underscore.js"></script>
        <script src="../../../../../../_static/doctools.js"></script>
        <script src="../../../../../../_static/language_data.js"></script>
        <script src="../../../../../../_static/togglebutton.js"></script>
        <script src="../../../../../../_static/contentui.js"></script>
        <script >var togglebuttonSelector = '.toggle';</script>
    
    <script type="text/javascript" src="../../../../../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../../../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../../../../_static/togglebutton.css" type="text/css" />
  <link rel="stylesheet" href="../../../../../../_static/contentui.css" type="text/css" />
    <link rel="index" title="Index" href="../../../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../../../../index.html" class="icon icon-home"> AiiDA
          

          
          </a>

          
            
            
              <div class="version">
                1.2
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../intro/about.html">What is AiiDA</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../intro/get_started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../intro/installation.html">Advanced Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../intro/troubleshooting.html">Troubleshooting</a></li>
</ul>
<p class="caption"><span class="caption-text">Tutorial</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../tutorial/placeholder.html">Placeholder</a></li>
</ul>
<p class="caption"><span class="caption-text">How-To Guides</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../howto/placeholder.html">Placeholder</a></li>
</ul>
<p class="caption"><span class="caption-text">Topics</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../topics/placeholder.html">Placeholder</a></li>
</ul>
<p class="caption"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../reference/placeholder.html">Placeholder</a></li>
</ul>
<p class="caption"><span class="caption-text">Plugins</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../plugins/placeholder.html">Placeholder</a></li>
</ul>
<p class="caption"><span class="caption-text">Development</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../development/placeholder.html">Placeholder</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../../../index.html">AiiDA</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../../../../index.html">Module code</a> &raquo;</li>
        
          <li><a href="../../../../../aiida.html">aiida</a> &raquo;</li>
        
      <li>aiida.orm.nodes.process.calculation.calcjob</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for aiida.orm.nodes.process.calculation.calcjob</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="c1">###########################################################################</span>
<span class="c1"># Copyright (c), The AiiDA team. All rights reserved.                     #</span>
<span class="c1"># This file is part of the AiiDA code.                                    #</span>
<span class="c1">#                                                                         #</span>
<span class="c1"># The code is hosted on GitHub at https://github.com/aiidateam/aiida-core #</span>
<span class="c1"># For further information on the license, see the LICENSE.txt file        #</span>
<span class="c1"># For further information please visit http://www.aiida.net               #</span>
<span class="c1">###########################################################################</span>
<span class="sd">&quot;&quot;&quot;Module with `Node` sub class for calculation job processes.&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">warnings</span>

<span class="kn">from</span> <span class="nn">aiida.common</span> <span class="kn">import</span> <span class="n">exceptions</span>
<span class="kn">from</span> <span class="nn">aiida.common.datastructures</span> <span class="kn">import</span> <span class="n">CalcJobState</span>
<span class="kn">from</span> <span class="nn">aiida.common.lang</span> <span class="kn">import</span> <span class="n">classproperty</span>
<span class="kn">from</span> <span class="nn">aiida.common.links</span> <span class="kn">import</span> <span class="n">LinkType</span>
<span class="kn">from</span> <span class="nn">aiida.common.warnings</span> <span class="kn">import</span> <span class="n">AiidaDeprecationWarning</span>

<span class="kn">from</span> <span class="nn">.calculation</span> <span class="kn">import</span> <span class="n">CalculationNode</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;CalcJobNode&#39;</span><span class="p">,)</span>


<div class="viewcode-block" id="CalcJobNode"><a class="viewcode-back" href="../../../../../../apidoc/aiida.orm.nodes.process.calculation.html#aiida.engine.CalcJobNode">[docs]</a><span class="k">class</span> <span class="nc">CalcJobNode</span><span class="p">(</span><span class="n">CalculationNode</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;ORM class for all nodes representing the execution of a CalcJob.&quot;&quot;&quot;</span>

    <span class="c1"># pylint: disable=too-many-public-methods</span>

    <span class="n">CALC_JOB_STATE_KEY</span> <span class="o">=</span> <span class="s1">&#39;state&#39;</span>
    <span class="n">REMOTE_WORKDIR_KEY</span> <span class="o">=</span> <span class="s1">&#39;remote_workdir&#39;</span>
    <span class="n">RETRIEVE_LIST_KEY</span> <span class="o">=</span> <span class="s1">&#39;retrieve_list&#39;</span>
    <span class="n">RETRIEVE_TEMPORARY_LIST_KEY</span> <span class="o">=</span> <span class="s1">&#39;retrieve_temporary_list&#39;</span>
    <span class="n">RETRIEVE_SINGLE_FILE_LIST_KEY</span> <span class="o">=</span> <span class="s1">&#39;retrieve_singlefile_list&#39;</span>
    <span class="n">SCHEDULER_JOB_ID_KEY</span> <span class="o">=</span> <span class="s1">&#39;job_id&#39;</span>
    <span class="n">SCHEDULER_STATE_KEY</span> <span class="o">=</span> <span class="s1">&#39;scheduler_state&#39;</span>
    <span class="n">SCHEDULER_LAST_CHECK_TIME_KEY</span> <span class="o">=</span> <span class="s1">&#39;scheduler_lastchecktime&#39;</span>
    <span class="n">SCHEDULER_LAST_JOB_INFO_KEY</span> <span class="o">=</span> <span class="s1">&#39;last_job_info&#39;</span>
    <span class="n">SCHEDULER_DETAILED_JOB_INFO_KEY</span> <span class="o">=</span> <span class="s1">&#39;detailed_job_info&#39;</span>

    <span class="c1"># Base path within the repository where to put objects by default</span>
    <span class="n">_repository_base_path</span> <span class="o">=</span> <span class="s1">&#39;raw_input&#39;</span>

    <span class="c1"># An optional entry point for a CalculationTools instance</span>
    <span class="n">_tools</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">tools</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the calculation tools that are registered for the process type associated with this calculation.</span>

<span class="sd">        If the entry point name stored in the `process_type` of the CalcJobNode has an accompanying entry point in the</span>
<span class="sd">        `aiida.tools.calculations` entry point category, it will attempt to load the entry point and instantiate it</span>
<span class="sd">        passing the node to the constructor. If the entry point does not exist, cannot be resolved or loaded, a warning</span>
<span class="sd">        will be logged and the base CalculationTools class will be instantiated and returned.</span>

<span class="sd">        :return: CalculationTools instance</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">aiida.plugins.entry_point</span> <span class="kn">import</span> <span class="n">is_valid_entry_point_string</span><span class="p">,</span> <span class="n">get_entry_point_from_string</span><span class="p">,</span> <span class="n">load_entry_point</span>
        <span class="kn">from</span> <span class="nn">aiida.tools.calculations</span> <span class="kn">import</span> <span class="n">CalculationTools</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tools</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">entry_point_string</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">process_type</span>

            <span class="k">if</span> <span class="n">is_valid_entry_point_string</span><span class="p">(</span><span class="n">entry_point_string</span><span class="p">):</span>
                <span class="n">entry_point</span> <span class="o">=</span> <span class="n">get_entry_point_from_string</span><span class="p">(</span><span class="n">entry_point_string</span><span class="p">)</span>

                <span class="k">try</span><span class="p">:</span>
                    <span class="n">tools_class</span> <span class="o">=</span> <span class="n">load_entry_point</span><span class="p">(</span><span class="s1">&#39;aiida.tools.calculations&#39;</span><span class="p">,</span> <span class="n">entry_point</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_tools</span> <span class="o">=</span> <span class="n">tools_class</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
                <span class="k">except</span> <span class="n">exceptions</span><span class="o">.</span><span class="n">EntryPointError</span> <span class="k">as</span> <span class="n">exception</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_tools</span> <span class="o">=</span> <span class="n">CalculationTools</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                        <span class="s1">&#39;could not load the calculation tools entry point </span><span class="si">{}</span><span class="s1">: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">entry_point</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">exception</span><span class="p">)</span>
                    <span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tools</span>

    <span class="nd">@classproperty</span>
    <span class="k">def</span> <span class="nf">_updatable_attributes</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>  <span class="c1"># pylint: disable=no-self-argument</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_updatable_attributes</span> <span class="o">+</span> <span class="p">(</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">CALC_JOB_STATE_KEY</span><span class="p">,</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">REMOTE_WORKDIR_KEY</span><span class="p">,</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">RETRIEVE_LIST_KEY</span><span class="p">,</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">RETRIEVE_TEMPORARY_LIST_KEY</span><span class="p">,</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">RETRIEVE_SINGLE_FILE_LIST_KEY</span><span class="p">,</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">SCHEDULER_JOB_ID_KEY</span><span class="p">,</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">SCHEDULER_STATE_KEY</span><span class="p">,</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">SCHEDULER_LAST_CHECK_TIME_KEY</span><span class="p">,</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">SCHEDULER_LAST_JOB_INFO_KEY</span><span class="p">,</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">SCHEDULER_DETAILED_JOB_INFO_KEY</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="nd">@classproperty</span>
    <span class="k">def</span> <span class="nf">_hash_ignored_attributes</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>  <span class="c1"># pylint: disable=no-self-argument</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_hash_ignored_attributes</span> <span class="o">+</span> <span class="p">(</span>
            <span class="s1">&#39;queue_name&#39;</span><span class="p">,</span>
            <span class="s1">&#39;account&#39;</span><span class="p">,</span>
            <span class="s1">&#39;qos&#39;</span><span class="p">,</span>
            <span class="s1">&#39;priority&#39;</span><span class="p">,</span>
            <span class="s1">&#39;max_wallclock_seconds&#39;</span><span class="p">,</span>
            <span class="s1">&#39;max_memory_kb&#39;</span><span class="p">,</span>
        <span class="p">)</span>

<div class="viewcode-block" id="CalcJobNode._get_objects_to_hash"><a class="viewcode-back" href="../../../../../../apidoc/aiida.orm.nodes.process.calculation.html#aiida.engine.CalcJobNode._get_objects_to_hash">[docs]</a>    <span class="k">def</span> <span class="nf">_get_objects_to_hash</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a list of objects which should be included in the hash.</span>

<span class="sd">        This method is purposefully overridden from the base `Node` class, because we do not want to include the</span>
<span class="sd">        repository folder in the hash. The reason is that the hash of this node is computed in the `store` method, at</span>
<span class="sd">        which point the input files that will be stored in the repository have not yet been generated. Including these</span>
<span class="sd">        anyway in the computation of the hash would mean that the hash of the node would change as soon as the process</span>
<span class="sd">        has started and the input files have been written to the repository.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">importlib</span> <span class="kn">import</span> <span class="n">import_module</span>
        <span class="n">objects</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">import_module</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__module__</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">__version__</span><span class="p">,</span>
            <span class="p">{</span>
                <span class="n">key</span><span class="p">:</span> <span class="n">val</span>
                <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">attributes_items</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hash_ignored_attributes</span> <span class="ow">and</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_updatable_attributes</span>  <span class="c1"># pylint: disable=unsupported-membership-test</span>
            <span class="p">},</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">computer</span><span class="o">.</span><span class="n">uuid</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">computer</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>  <span class="c1"># pylint: disable=no-member</span>
            <span class="p">{</span>
                <span class="n">entry</span><span class="o">.</span><span class="n">link_label</span><span class="p">:</span> <span class="n">entry</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">get_hash</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_incoming</span><span class="p">(</span><span class="n">link_type</span><span class="o">=</span><span class="p">(</span><span class="n">LinkType</span><span class="o">.</span><span class="n">INPUT_CALC</span><span class="p">,</span> <span class="n">LinkType</span><span class="o">.</span><span class="n">INPUT_WORK</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">entry</span><span class="o">.</span><span class="n">link_label</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hash_ignored_inputs</span>
            <span class="p">}</span>
        <span class="p">]</span>
        <span class="k">return</span> <span class="n">objects</span></div>

<div class="viewcode-block" id="CalcJobNode.get_builder_restart"><a class="viewcode-back" href="../../../../../../apidoc/aiida.orm.nodes.process.calculation.html#aiida.engine.CalcJobNode.get_builder_restart">[docs]</a>    <span class="k">def</span> <span class="nf">get_builder_restart</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a `ProcessBuilder` that is ready to relaunch the same `CalcJob` that created this node.</span>

<span class="sd">        The process class will be set based on the `process_type` of this node and the inputs of the builder will be</span>
<span class="sd">        prepopulated with the inputs registered for this node. This functionality is very useful if a process has</span>
<span class="sd">        completed and you want to relaunch it with slightly different inputs.</span>

<span class="sd">        In addition to prepopulating the input nodes, which is implemented by the base `ProcessNode` class, here we</span>
<span class="sd">        also add the `options` that were passed in the `metadata` input of the `CalcJob` process.</span>

<span class="sd">        :return: `~aiida.engine.processes.builder.ProcessBuilder` instance</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">builder</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">get_builder_restart</span><span class="p">()</span>
        <span class="n">builder</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">options</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_options</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">builder</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_raw_input_folder</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the input folder object.</span>

<span class="sd">        :return: the input folder object.</span>
<span class="sd">        :raise: NotExistent: if the raw folder hasn&#39;t been created yet</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">aiida.common.exceptions</span> <span class="kn">import</span> <span class="n">NotExistent</span>

        <span class="n">return_folder</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_repository</span><span class="o">.</span><span class="n">_get_base_folder</span><span class="p">()</span>  <span class="c1"># pylint: disable=protected-access</span>
        <span class="k">if</span> <span class="n">return_folder</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="k">return</span> <span class="n">return_folder</span>

        <span class="k">raise</span> <span class="n">NotExistent</span><span class="p">(</span><span class="s1">&#39;the `_raw_input_folder` has not yet been created&#39;</span><span class="p">)</span>

<div class="viewcode-block" id="CalcJobNode.get_option"><a class="viewcode-back" href="../../../../../../apidoc/aiida.orm.nodes.process.calculation.html#aiida.engine.CalcJobNode.get_option">[docs]</a>    <span class="k">def</span> <span class="nf">get_option</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retun the value of an option that was set for this CalcJobNode</span>

<span class="sd">        :param name: the option name</span>
<span class="sd">        :return: the option value or None</span>
<span class="sd">        :raises: ValueError for unknown option</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span></div>

<div class="viewcode-block" id="CalcJobNode.set_option"><a class="viewcode-back" href="../../../../../../apidoc/aiida.orm.nodes.process.calculation.html#aiida.engine.CalcJobNode.set_option">[docs]</a>    <span class="k">def</span> <span class="nf">set_option</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set an option to the given value</span>

<span class="sd">        :param name: the option name</span>
<span class="sd">        :param value: the value to set</span>
<span class="sd">        :raises: ValueError for unknown option</span>
<span class="sd">        :raises: TypeError for values with invalid type</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_attribute</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span></div>

<div class="viewcode-block" id="CalcJobNode.get_options"><a class="viewcode-back" href="../../../../../../apidoc/aiida.orm.nodes.process.calculation.html#aiida.engine.CalcJobNode.get_options">[docs]</a>    <span class="k">def</span> <span class="nf">get_options</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the dictionary of options set for this CalcJobNode</span>

<span class="sd">        :return: dictionary of the options and their values</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">options</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">process_class</span><span class="o">.</span><span class="n">spec_options</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_option</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">options</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

        <span class="k">return</span> <span class="n">options</span></div>

<div class="viewcode-block" id="CalcJobNode.set_options"><a class="viewcode-back" href="../../../../../../apidoc/aiida.orm.nodes.process.calculation.html#aiida.engine.CalcJobNode.set_options">[docs]</a>    <span class="k">def</span> <span class="nf">set_options</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">options</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the options for this CalcJobNode</span>

<span class="sd">        :param options: dictionary of option and their values to set</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">options</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span></div>

<div class="viewcode-block" id="CalcJobNode.get_state"><a class="viewcode-back" href="../../../../../../apidoc/aiida.orm.nodes.process.calculation.html#aiida.engine.CalcJobNode.get_state">[docs]</a>    <span class="k">def</span> <span class="nf">get_state</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the calculation job active sub state.</span>

<span class="sd">        The calculation job state serves to give more granular state information to `CalcJobs`, in addition to the</span>
<span class="sd">        generic process state, while the calculation job is active. The state can take values from the enumeration</span>
<span class="sd">        defined in `aiida.common.datastructures.CalcJobState` and can be used to query for calculation jobs in specific</span>
<span class="sd">        active states.</span>

<span class="sd">        :return: instance of `aiida.common.datastructures.CalcJobState` or `None` if invalid value, or not set</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">CALC_JOB_STATE_KEY</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">state</span> <span class="o">=</span> <span class="n">CalcJobState</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="n">state</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">return</span> <span class="n">state</span></div>

<div class="viewcode-block" id="CalcJobNode.set_state"><a class="viewcode-back" href="../../../../../../apidoc/aiida.orm.nodes.process.calculation.html#aiida.engine.CalcJobNode.set_state">[docs]</a>    <span class="k">def</span> <span class="nf">set_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set the calculation active job state.</span>

<span class="sd">        :param state: a string with the state from ``aiida.common.datastructures.CalcJobState``.</span>
<span class="sd">        :raise: ValueError if state is invalid</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">CalcJobState</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> is not a valid CalcJobState&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">state</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">set_attribute</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">CALC_JOB_STATE_KEY</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">value</span><span class="p">)</span></div>

<div class="viewcode-block" id="CalcJobNode.delete_state"><a class="viewcode-back" href="../../../../../../apidoc/aiida.orm.nodes.process.calculation.html#aiida.engine.CalcJobNode.delete_state">[docs]</a>    <span class="k">def</span> <span class="nf">delete_state</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Delete the calculation job state attribute if it exists.&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">delete_attribute</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">CALC_JOB_STATE_KEY</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">pass</span></div>

<div class="viewcode-block" id="CalcJobNode.set_remote_workdir"><a class="viewcode-back" href="../../../../../../apidoc/aiida.orm.nodes.process.calculation.html#aiida.engine.CalcJobNode.set_remote_workdir">[docs]</a>    <span class="k">def</span> <span class="nf">set_remote_workdir</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">remote_workdir</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set the absolute path to the working directory on the remote computer where the calculation is run.</span>

<span class="sd">        :param remote_workdir: absolute filepath to the remote working directory</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_attribute</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">REMOTE_WORKDIR_KEY</span><span class="p">,</span> <span class="n">remote_workdir</span><span class="p">)</span></div>

<div class="viewcode-block" id="CalcJobNode.get_remote_workdir"><a class="viewcode-back" href="../../../../../../apidoc/aiida.orm.nodes.process.calculation.html#aiida.engine.CalcJobNode.get_remote_workdir">[docs]</a>    <span class="k">def</span> <span class="nf">get_remote_workdir</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the path to the remote (on cluster) scratch folder of the calculation.</span>

<span class="sd">        :return: a string with the remote path</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">REMOTE_WORKDIR_KEY</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span></div>

<div class="viewcode-block" id="CalcJobNode._validate_retrieval_directive"><a class="viewcode-back" href="../../../../../../apidoc/aiida.orm.nodes.process.calculation.html#aiida.engine.CalcJobNode._validate_retrieval_directive">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_validate_retrieval_directive</span><span class="p">(</span><span class="n">directives</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Validate a list or tuple of file retrieval directives.</span>

<span class="sd">        :param directives: a list or tuple of file retrieveal directives</span>
<span class="sd">        :raise ValueError: if the format of the directives is invalid</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">directives</span><span class="p">,</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="nb">list</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;file retrieval directives has to be a list or tuple&#39;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">directive</span> <span class="ow">in</span> <span class="n">directives</span><span class="p">:</span>

            <span class="c1"># A string as a directive is valid, so we continue</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">directive</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="k">continue</span>

            <span class="c1"># Otherwise, it has to be a tuple of length three with specific requirements</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">directive</span><span class="p">,</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="nb">list</span><span class="p">))</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">directive</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;invalid directive, not a list or tuple of length three: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">directive</span><span class="p">))</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">directive</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">str</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;invalid directive, first element has to be a string representing remote path&#39;</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">directive</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nb">str</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;invalid directive, second element has to be a string representing local path&#39;</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">directive</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="nb">int</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;invalid directive, three element has to be an integer representing the depth&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="CalcJobNode.set_retrieve_list"><a class="viewcode-back" href="../../../../../../apidoc/aiida.orm.nodes.process.calculation.html#aiida.engine.CalcJobNode.set_retrieve_list">[docs]</a>    <span class="k">def</span> <span class="nf">set_retrieve_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">retrieve_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set the retrieve list.</span>

<span class="sd">        This list of directives will instruct the daemon what files to retrieve after the calculation has completed.</span>
<span class="sd">        list or tuple of files or paths that should be retrieved by the daemon.</span>

<span class="sd">        :param retrieve_list: list or tuple of with filepath directives</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_validate_retrieval_directive</span><span class="p">(</span><span class="n">retrieve_list</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_attribute</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RETRIEVE_LIST_KEY</span><span class="p">,</span> <span class="n">retrieve_list</span><span class="p">)</span></div>

<div class="viewcode-block" id="CalcJobNode.get_retrieve_list"><a class="viewcode-back" href="../../../../../../apidoc/aiida.orm.nodes.process.calculation.html#aiida.engine.CalcJobNode.get_retrieve_list">[docs]</a>    <span class="k">def</span> <span class="nf">get_retrieve_list</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the list of files/directories to be retrieved on the cluster after the calculation has completed.</span>

<span class="sd">        :return: a list of file directives</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RETRIEVE_LIST_KEY</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span></div>

<div class="viewcode-block" id="CalcJobNode.set_retrieve_temporary_list"><a class="viewcode-back" href="../../../../../../apidoc/aiida.orm.nodes.process.calculation.html#aiida.engine.CalcJobNode.set_retrieve_temporary_list">[docs]</a>    <span class="k">def</span> <span class="nf">set_retrieve_temporary_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">retrieve_temporary_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set the retrieve temporary list.</span>

<span class="sd">        The retrieve temporary list stores files that are retrieved after completion and made available during parsing</span>
<span class="sd">        and are deleted as soon as the parsing has been completed.</span>

<span class="sd">        :param retrieve_temporary_list: list or tuple of with filepath directives</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_validate_retrieval_directive</span><span class="p">(</span><span class="n">retrieve_temporary_list</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_attribute</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RETRIEVE_TEMPORARY_LIST_KEY</span><span class="p">,</span> <span class="n">retrieve_temporary_list</span><span class="p">)</span></div>

<div class="viewcode-block" id="CalcJobNode.get_retrieve_temporary_list"><a class="viewcode-back" href="../../../../../../apidoc/aiida.orm.nodes.process.calculation.html#aiida.engine.CalcJobNode.get_retrieve_temporary_list">[docs]</a>    <span class="k">def</span> <span class="nf">get_retrieve_temporary_list</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return list of files to be retrieved from the cluster which will be available during parsing.</span>

<span class="sd">        :return: a list of file directives</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RETRIEVE_TEMPORARY_LIST_KEY</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span></div>

<div class="viewcode-block" id="CalcJobNode.set_retrieve_singlefile_list"><a class="viewcode-back" href="../../../../../../apidoc/aiida.orm.nodes.process.calculation.html#aiida.engine.CalcJobNode.set_retrieve_singlefile_list">[docs]</a>    <span class="k">def</span> <span class="nf">set_retrieve_singlefile_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">retrieve_singlefile_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set the retrieve singlefile list.</span>

<span class="sd">        The files will be stored as `SinglefileData` instances and added as output nodes to this calculation node.</span>
<span class="sd">        The format of a single file directive is a tuple or list of length 3 with the following entries:</span>

<span class="sd">            1. the link label under which the file should be added</span>
<span class="sd">            2. the `SinglefileData` class or sub class to use to store</span>
<span class="sd">            3. the filepath relative to the remote working directory of the calculation</span>

<span class="sd">        :param retrieve_singlefile_list: list or tuple of single file directives</span>

<span class="sd">        .. deprecated:: 1.0.0</span>

<span class="sd">            Will be removed in `v2.0.0`.</span>
<span class="sd">            Use :meth:`~aiida.orm.nodes.process.calculation.calcjob.CalcJobNode.set_retrieve_temporary_list` instead.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;method is deprecated, use `set_retrieve_temporary_list` instead&#39;</span><span class="p">,</span> <span class="n">AiidaDeprecationWarning</span><span class="p">)</span>  <span class="c1"># pylint: disable=no-member</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">retrieve_singlefile_list</span><span class="p">,</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="nb">list</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;retrieve_singlefile_list has to be a list or tuple&#39;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">retrieve_singlefile_list</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="nb">list</span><span class="p">))</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">j</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;You have to pass a list (or tuple) of lists of strings as retrieve_singlefile_list&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">set_attribute</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RETRIEVE_SINGLE_FILE_LIST_KEY</span><span class="p">,</span> <span class="n">retrieve_singlefile_list</span><span class="p">)</span></div>

<div class="viewcode-block" id="CalcJobNode.get_retrieve_singlefile_list"><a class="viewcode-back" href="../../../../../../apidoc/aiida.orm.nodes.process.calculation.html#aiida.engine.CalcJobNode.get_retrieve_singlefile_list">[docs]</a>    <span class="k">def</span> <span class="nf">get_retrieve_singlefile_list</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the list of files to be retrieved on the cluster after the calculation has completed.</span>

<span class="sd">        :return: list of single file retrieval directives</span>

<span class="sd">        .. deprecated:: 1.0.0</span>
<span class="sd">            Will be removed in `v2.0.0`, use</span>
<span class="sd">            :meth:`aiida.orm.nodes.process.calculation.calcjob.CalcJobNode.get_retrieve_temporary_list` instead.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RETRIEVE_SINGLE_FILE_LIST_KEY</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span></div>

<div class="viewcode-block" id="CalcJobNode.set_job_id"><a class="viewcode-back" href="../../../../../../apidoc/aiida.orm.nodes.process.calculation.html#aiida.engine.CalcJobNode.set_job_id">[docs]</a>    <span class="k">def</span> <span class="nf">set_job_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">job_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set the job id that was assigned to the calculation by the scheduler.</span>

<span class="sd">        .. note:: the id will always be stored as a string</span>

<span class="sd">        :param job_id: the id assigned by the scheduler after submission</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_attribute</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SCHEDULER_JOB_ID_KEY</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">job_id</span><span class="p">))</span></div>

<div class="viewcode-block" id="CalcJobNode.get_job_id"><a class="viewcode-back" href="../../../../../../apidoc/aiida.orm.nodes.process.calculation.html#aiida.engine.CalcJobNode.get_job_id">[docs]</a>    <span class="k">def</span> <span class="nf">get_job_id</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return job id that was assigned to the calculation by the scheduler.</span>

<span class="sd">        :return: the string representation of the scheduler job id</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SCHEDULER_JOB_ID_KEY</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span></div>

<div class="viewcode-block" id="CalcJobNode.set_scheduler_state"><a class="viewcode-back" href="../../../../../../apidoc/aiida.orm.nodes.process.calculation.html#aiida.engine.CalcJobNode.set_scheduler_state">[docs]</a>    <span class="k">def</span> <span class="nf">set_scheduler_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set the scheduler state.</span>

<span class="sd">        :param state: an instance of `JobState`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">aiida.common</span> <span class="kn">import</span> <span class="n">timezone</span>
        <span class="kn">from</span> <span class="nn">aiida.schedulers.datastructures</span> <span class="kn">import</span> <span class="n">JobState</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">JobState</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;scheduler state should be an instance of JobState, got: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">state</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">set_attribute</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SCHEDULER_STATE_KEY</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_attribute</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SCHEDULER_LAST_CHECK_TIME_KEY</span><span class="p">,</span> <span class="n">timezone</span><span class="o">.</span><span class="n">datetime_to_isoformat</span><span class="p">(</span><span class="n">timezone</span><span class="o">.</span><span class="n">now</span><span class="p">()))</span></div>

<div class="viewcode-block" id="CalcJobNode.get_scheduler_state"><a class="viewcode-back" href="../../../../../../apidoc/aiida.orm.nodes.process.calculation.html#aiida.engine.CalcJobNode.get_scheduler_state">[docs]</a>    <span class="k">def</span> <span class="nf">get_scheduler_state</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the status of the calculation according to the cluster scheduler.</span>

<span class="sd">        :return: a JobState enum instance.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">aiida.schedulers.datastructures</span> <span class="kn">import</span> <span class="n">JobState</span>

        <span class="n">state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SCHEDULER_STATE_KEY</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">state</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">state</span>

        <span class="k">return</span> <span class="n">JobState</span><span class="p">(</span><span class="n">state</span><span class="p">)</span></div>

<div class="viewcode-block" id="CalcJobNode.get_scheduler_lastchecktime"><a class="viewcode-back" href="../../../../../../apidoc/aiida.orm.nodes.process.calculation.html#aiida.engine.CalcJobNode.get_scheduler_lastchecktime">[docs]</a>    <span class="k">def</span> <span class="nf">get_scheduler_lastchecktime</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the time of the last update of the scheduler state by the daemon or None if it was never set.</span>

<span class="sd">        :return: a datetime object or None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">aiida.common</span> <span class="kn">import</span> <span class="n">timezone</span>
        <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SCHEDULER_LAST_CHECK_TIME_KEY</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">timezone</span><span class="o">.</span><span class="n">isoformat_to_datetime</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">value</span></div>

<div class="viewcode-block" id="CalcJobNode.set_detailed_job_info"><a class="viewcode-back" href="../../../../../../apidoc/aiida.orm.nodes.process.calculation.html#aiida.engine.CalcJobNode.set_detailed_job_info">[docs]</a>    <span class="k">def</span> <span class="nf">set_detailed_job_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">detailed_job_info</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set the detailed job info dictionary.</span>

<span class="sd">        :param detailed_job_info: a dictionary with metadata with the accounting of a completed job</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_attribute</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SCHEDULER_DETAILED_JOB_INFO_KEY</span><span class="p">,</span> <span class="n">detailed_job_info</span><span class="p">)</span></div>

<div class="viewcode-block" id="CalcJobNode.get_detailed_job_info"><a class="viewcode-back" href="../../../../../../apidoc/aiida.orm.nodes.process.calculation.html#aiida.engine.CalcJobNode.get_detailed_job_info">[docs]</a>    <span class="k">def</span> <span class="nf">get_detailed_job_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the detailed job info dictionary.</span>

<span class="sd">        :return: the dictionary with detailed job info if defined or None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SCHEDULER_DETAILED_JOB_INFO_KEY</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span></div>

<div class="viewcode-block" id="CalcJobNode.set_last_job_info"><a class="viewcode-back" href="../../../../../../apidoc/aiida.orm.nodes.process.calculation.html#aiida.engine.CalcJobNode.set_last_job_info">[docs]</a>    <span class="k">def</span> <span class="nf">set_last_job_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">last_job_info</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set the last job info.</span>

<span class="sd">        :param last_job_info: a `JobInfo` object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_attribute</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SCHEDULER_LAST_JOB_INFO_KEY</span><span class="p">,</span> <span class="n">last_job_info</span><span class="o">.</span><span class="n">get_dict</span><span class="p">())</span></div>

<div class="viewcode-block" id="CalcJobNode.get_last_job_info"><a class="viewcode-back" href="../../../../../../apidoc/aiida.orm.nodes.process.calculation.html#aiida.engine.CalcJobNode.get_last_job_info">[docs]</a>    <span class="k">def</span> <span class="nf">get_last_job_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the last information asked to the scheduler about the status of the job.</span>

<span class="sd">        :return: a `JobInfo` object (that closely resembles a dictionary) or None.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">aiida.schedulers.datastructures</span> <span class="kn">import</span> <span class="n">JobInfo</span>

        <span class="n">last_job_info_dictserialized</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SCHEDULER_LAST_JOB_INFO_KEY</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">last_job_info_dictserialized</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">job_info</span> <span class="o">=</span> <span class="n">JobInfo</span><span class="o">.</span><span class="n">load_from_dict</span><span class="p">(</span><span class="n">last_job_info_dictserialized</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">job_info</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">return</span> <span class="n">job_info</span></div>

<div class="viewcode-block" id="CalcJobNode.get_authinfo"><a class="viewcode-back" href="../../../../../../apidoc/aiida.orm.nodes.process.calculation.html#aiida.engine.CalcJobNode.get_authinfo">[docs]</a>    <span class="k">def</span> <span class="nf">get_authinfo</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the `AuthInfo` that is configured for the `Computer` set for this node.</span>

<span class="sd">        :return: `AuthInfo`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">aiida.orm.authinfos</span> <span class="kn">import</span> <span class="n">AuthInfo</span>

        <span class="n">computer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">computer</span>

        <span class="k">if</span> <span class="n">computer</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">exceptions</span><span class="o">.</span><span class="n">NotExistent</span><span class="p">(</span><span class="s1">&#39;No computer has been set for this calculation&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">AuthInfo</span><span class="o">.</span><span class="n">from_backend_entity</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">backend</span><span class="o">.</span><span class="n">authinfos</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">computer</span><span class="o">=</span><span class="n">computer</span><span class="p">,</span> <span class="n">user</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">user</span><span class="p">))</span></div>

<div class="viewcode-block" id="CalcJobNode.get_transport"><a class="viewcode-back" href="../../../../../../apidoc/aiida.orm.nodes.process.calculation.html#aiida.engine.CalcJobNode.get_transport">[docs]</a>    <span class="k">def</span> <span class="nf">get_transport</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the transport for this calculation.</span>

<span class="sd">        :return: `Transport` configured with the `AuthInfo` associated to the computer of this node</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_authinfo</span><span class="p">()</span><span class="o">.</span><span class="n">get_transport</span><span class="p">()</span></div>

<div class="viewcode-block" id="CalcJobNode.get_parser_class"><a class="viewcode-back" href="../../../../../../apidoc/aiida.orm.nodes.process.calculation.html#aiida.engine.CalcJobNode.get_parser_class">[docs]</a>    <span class="k">def</span> <span class="nf">get_parser_class</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the output parser object for this calculation or None if no parser is set.</span>

<span class="sd">        :return: a `Parser` class.</span>
<span class="sd">        :raises `aiida.common.exceptions.EntryPointError`: if the parser entry point can not be resolved.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">aiida.plugins</span> <span class="kn">import</span> <span class="n">ParserFactory</span>

        <span class="n">parser_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_option</span><span class="p">(</span><span class="s1">&#39;parser_name&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">parser_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ParserFactory</span><span class="p">(</span><span class="n">parser_name</span><span class="p">)</span>

        <span class="k">return</span> <span class="kc">None</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">link_label_retrieved</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the link label used for the retrieved FolderData node.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s1">&#39;retrieved&#39;</span>

<div class="viewcode-block" id="CalcJobNode.get_retrieved_node"><a class="viewcode-back" href="../../../../../../apidoc/aiida.orm.nodes.process.calculation.html#aiida.engine.CalcJobNode.get_retrieved_node">[docs]</a>    <span class="k">def</span> <span class="nf">get_retrieved_node</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the retrieved data folder.</span>

<span class="sd">        :return: the retrieved FolderData node or None if not found</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">aiida.orm</span> <span class="kn">import</span> <span class="n">FolderData</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_outgoing</span><span class="p">(</span><span class="n">node_class</span><span class="o">=</span><span class="n">FolderData</span><span class="p">,</span> <span class="n">link_label_filter</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">link_label_retrieved</span><span class="p">)</span><span class="o">.</span><span class="n">one</span><span class="p">()</span><span class="o">.</span><span class="n">node</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">res</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        To be used to get direct access to the parsed parameters.</span>

<span class="sd">        :return: an instance of the CalcJobResultManager.</span>

<span class="sd">        :note: a practical example on how it is meant to be used: let&#39;s say that there is a key &#39;energy&#39;</span>
<span class="sd">            in the dictionary of the parsed results which contains a list of floats.</span>
<span class="sd">            The command `calc.res.energy` will return such a list.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">aiida.orm.utils.calcjob</span> <span class="kn">import</span> <span class="n">CalcJobResultManager</span>
        <span class="k">return</span> <span class="n">CalcJobResultManager</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

<div class="viewcode-block" id="CalcJobNode.get_scheduler_stdout"><a class="viewcode-back" href="../../../../../../apidoc/aiida.orm.nodes.process.calculation.html#aiida.engine.CalcJobNode.get_scheduler_stdout">[docs]</a>    <span class="k">def</span> <span class="nf">get_scheduler_stdout</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the scheduler stderr output if the calculation has finished and been retrieved, None otherwise.</span>

<span class="sd">        :return: scheduler stderr output or None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_option</span><span class="p">(</span><span class="s1">&#39;scheduler_stdout&#39;</span><span class="p">)</span>
        <span class="n">retrieved_node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_retrieved_node</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">retrieved_node</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">stdout</span> <span class="o">=</span> <span class="n">retrieved_node</span><span class="o">.</span><span class="n">get_object_content</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span>
            <span class="n">stdout</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">return</span> <span class="n">stdout</span></div>

<div class="viewcode-block" id="CalcJobNode.get_scheduler_stderr"><a class="viewcode-back" href="../../../../../../apidoc/aiida.orm.nodes.process.calculation.html#aiida.engine.CalcJobNode.get_scheduler_stderr">[docs]</a>    <span class="k">def</span> <span class="nf">get_scheduler_stderr</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the scheduler stdout output if the calculation has finished and been retrieved, None otherwise.</span>

<span class="sd">        :return: scheduler stdout output or None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_option</span><span class="p">(</span><span class="s1">&#39;scheduler_stderr&#39;</span><span class="p">)</span>
        <span class="n">retrieved_node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_retrieved_node</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">retrieved_node</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">stderr</span> <span class="o">=</span> <span class="n">retrieved_node</span><span class="o">.</span><span class="n">get_object_content</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span>
            <span class="n">stderr</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">return</span> <span class="n">stderr</span></div>

<div class="viewcode-block" id="CalcJobNode.get_description"><a class="viewcode-back" href="../../../../../../apidoc/aiida.orm.nodes.process.calculation.html#aiida.engine.CalcJobNode.get_description">[docs]</a>    <span class="k">def</span> <span class="nf">get_description</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a string with a description of the node based on its properties.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_state</span><span class="p">()</span></div></div>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, ECOLE POLYTECHNIQUE FEDERALE DE LAUSANNE (Theory and Simulation of Materials (THEOS) and National Centre for Computational Design and Discovery of Novel Materials (NCCR MARVEL)), Switzerland and ROBERT BOSCH LLC, USA. All rights reserved

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>