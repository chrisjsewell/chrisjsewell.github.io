

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>aiida.orm.implementation.querybuilder &mdash; AiiDA 1.2.1 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../../" src="../../../../_static/documentation_options.js"></script>
        <script src="../../../../_static/jquery.js"></script>
        <script src="../../../../_static/underscore.js"></script>
        <script src="../../../../_static/doctools.js"></script>
        <script src="../../../../_static/language_data.js"></script>
        <script src="../../../../_static/togglebutton.js"></script>
        <script src="../../../../_static/contentui.js"></script>
        <script >var togglebuttonSelector = '.toggle';</script>
    
    <script type="text/javascript" src="../../../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/togglebutton.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/contentui.css" type="text/css" />
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../../index.html" class="icon icon-home"> AiiDA
          

          
          </a>

          
            
            
              <div class="version">
                1.2
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../intro/about.html">What is AiiDA</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../intro/get_started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../intro/installation.html">Advanced Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../intro/troubleshooting.html">Troubleshooting</a></li>
</ul>
<p class="caption"><span class="caption-text">Tutorial</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../tutorial/placeholder.html">Placeholder</a></li>
</ul>
<p class="caption"><span class="caption-text">How-To Guides</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../howto/placeholder.html">Placeholder</a></li>
</ul>
<p class="caption"><span class="caption-text">Topics</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../topics/placeholder.html">Placeholder</a></li>
</ul>
<p class="caption"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../reference/placeholder.html">Placeholder</a></li>
</ul>
<p class="caption"><span class="caption-text">Plugins</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../plugins/placeholder.html">Placeholder</a></li>
</ul>
<p class="caption"><span class="caption-text">Development</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../development/placeholder.html">Placeholder</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">AiiDA</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../../index.html">Module code</a> &raquo;</li>
        
          <li><a href="../../../aiida.html">aiida</a> &raquo;</li>
        
      <li>aiida.orm.implementation.querybuilder</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for aiida.orm.implementation.querybuilder</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="c1">###########################################################################</span>
<span class="c1"># Copyright (c), The AiiDA team. All rights reserved.                     #</span>
<span class="c1"># This file is part of the AiiDA code.                                    #</span>
<span class="c1">#                                                                         #</span>
<span class="c1"># The code is hosted on GitHub at https://github.com/aiidateam/aiida-core #</span>
<span class="c1"># For further information on the license, see the LICENSE.txt file        #</span>
<span class="c1"># For further information please visit http://www.aiida.net               #</span>
<span class="c1">###########################################################################</span>
<span class="sd">&quot;&quot;&quot;Abstract `QueryBuilder` definition.</span>

<span class="sd">Note that this abstract class actually contains parts of the implementation, which are tightly coupled to SqlAlchemy.</span>
<span class="sd">This is done because currently, both database backend implementations, both Django and SqlAlchemy, directly use the</span>
<span class="sd">SqlAlchemy library to implement the query builder. If there ever is another database backend to be implemented that does</span>
<span class="sd">not go through SqlAlchemy, this class will have to be refactored. The SqlAlchemy specific implementations should most</span>
<span class="sd">likely be moved to a `SqlAlchemyBasedQueryBuilder` class and restore this abstract class to being a pure agnostic one.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">abc</span>
<span class="kn">import</span> <span class="nn">uuid</span>

<span class="c1"># pylint: disable=no-name-in-module, import-error</span>
<span class="kn">from</span> <span class="nn">sqlalchemy_utils.types.choice</span> <span class="kn">import</span> <span class="n">Choice</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.types</span> <span class="kn">import</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">Float</span><span class="p">,</span> <span class="n">Boolean</span><span class="p">,</span> <span class="n">DateTime</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.dialects.postgresql</span> <span class="kn">import</span> <span class="n">JSONB</span>

<span class="kn">from</span> <span class="nn">aiida.common</span> <span class="kn">import</span> <span class="n">exceptions</span>
<span class="kn">from</span> <span class="nn">aiida.common.lang</span> <span class="kn">import</span> <span class="n">type_check</span>
<span class="kn">from</span> <span class="nn">aiida.common.exceptions</span> <span class="kn">import</span> <span class="n">InputValidationError</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;BackendQueryBuilder&#39;</span><span class="p">,)</span>


<div class="viewcode-block" id="BackendQueryBuilder"><a class="viewcode-back" href="../../../../apidoc/aiida.orm.implementation.html#aiida.orm.implementation.BackendQueryBuilder">[docs]</a><span class="k">class</span> <span class="nc">BackendQueryBuilder</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Backend query builder interface&quot;&quot;&quot;</span>

    <span class="c1"># pylint: disable=invalid-name,too-many-public-methods</span>

    <span class="n">outer_to_inner_schema</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">inner_to_outer_schema</span> <span class="o">=</span> <span class="kc">None</span>

<div class="viewcode-block" id="BackendQueryBuilder.__init__"><a class="viewcode-back" href="../../../../apidoc/aiida.orm.implementation.html#aiida.orm.implementation.BackendQueryBuilder.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">backend</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param backend: the backend</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">backends</span>
        <span class="n">type_check</span><span class="p">(</span><span class="n">backend</span><span class="p">,</span> <span class="n">backends</span><span class="o">.</span><span class="n">Backend</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_backend</span> <span class="o">=</span> <span class="n">backend</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">inner_to_outer_schema</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">outer_to_inner_schema</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span></div>

    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractproperty</span>
    <span class="k">def</span> <span class="nf">Node</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Decorated as a property, returns the implementation for DbNode.</span>
<span class="sd">        It needs to return a subclass of sqlalchemy.Base, which means that for different ORM&#39;s</span>
<span class="sd">        a corresponding dummy-model  must be written.</span>
<span class="sd">        &quot;&quot;&quot;</span>

    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractproperty</span>
    <span class="k">def</span> <span class="nf">Link</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A property, decorated with @property. Returns the implementation for the DbLink</span>
<span class="sd">        &quot;&quot;&quot;</span>

    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractproperty</span>
    <span class="k">def</span> <span class="nf">Computer</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A property, decorated with @property. Returns the implementation for the Computer</span>
<span class="sd">        &quot;&quot;&quot;</span>

    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractproperty</span>
    <span class="k">def</span> <span class="nf">User</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A property, decorated with @property. Returns the implementation for the User</span>
<span class="sd">        &quot;&quot;&quot;</span>

    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractproperty</span>
    <span class="k">def</span> <span class="nf">Group</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A property, decorated with @property. Returns the implementation for the Group</span>
<span class="sd">        &quot;&quot;&quot;</span>

    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractproperty</span>
    <span class="k">def</span> <span class="nf">AuthInfo</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A property, decorated with @property. Returns the implementation for the AuthInfo</span>
<span class="sd">        &quot;&quot;&quot;</span>

    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractproperty</span>
    <span class="k">def</span> <span class="nf">Comment</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A property, decorated with @property. Returns the implementation for the Comment</span>
<span class="sd">        &quot;&quot;&quot;</span>

    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractproperty</span>
    <span class="k">def</span> <span class="nf">Log</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A property, decorated with @property. Returns the implementation for the Log</span>
<span class="sd">        &quot;&quot;&quot;</span>

    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractproperty</span>
    <span class="k">def</span> <span class="nf">table_groups_nodes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A property, decorated with @property. Returns the implementation for the many-to-many</span>
<span class="sd">        relationship between group and nodes.</span>
<span class="sd">        &quot;&quot;&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">AiidaNode</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A property, decorated with @property. Returns the implementation for the AiiDA-class for Node</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">aiida.orm</span> <span class="kn">import</span> <span class="n">Node</span>
        <span class="k">return</span> <span class="n">Node</span>

<div class="viewcode-block" id="BackendQueryBuilder.get_session"><a class="viewcode-back" href="../../../../apidoc/aiida.orm.implementation.html#aiida.orm.implementation.BackendQueryBuilder.get_session">[docs]</a>    <span class="k">def</span> <span class="nf">get_session</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :returns: a valid session, an instance of :class:`sqlalchemy.orm.session.Session`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_backend</span><span class="o">.</span><span class="n">get_session</span><span class="p">()</span></div>

<div class="viewcode-block" id="BackendQueryBuilder.modify_expansions"><a class="viewcode-back" href="../../../../apidoc/aiida.orm.implementation.html#aiida.orm.implementation.BackendQueryBuilder.modify_expansions">[docs]</a>    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
    <span class="k">def</span> <span class="nf">modify_expansions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">alias</span><span class="p">,</span> <span class="n">expansions</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Modify names of projections if ** was specified.</span>
<span class="sd">        This is important for the schema having attributes in a different table.</span>
<span class="sd">        &quot;&quot;&quot;</span></div>

<div class="viewcode-block" id="BackendQueryBuilder.get_filter_expr_from_attributes"><a class="viewcode-back" href="../../../../apidoc/aiida.orm.implementation.html#aiida.orm.implementation.BackendQueryBuilder.get_filter_expr_from_attributes">[docs]</a>    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractclassmethod</span>
    <span class="k">def</span> <span class="nf">get_filter_expr_from_attributes</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">operator</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">attr_key</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">column_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">alias</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>  <span class="c1"># pylint: disable=too-many-arguments</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns an valid SQLAlchemy expression.</span>

<span class="sd">        :param operator: The operator provided by the user (&#39;==&#39;,  &#39;&gt;&#39;, ...)</span>
<span class="sd">        :param value: The value to compare with, e.g. (5.0, &#39;foo&#39;, [&#39;a&#39;,&#39;b&#39;])</span>
<span class="sd">        :param str attr_key:</span>
<span class="sd">            The path to that attribute as a tuple of values.</span>
<span class="sd">            I.e. if that attribute I want to filter by is the 2nd element in a list stored under the</span>
<span class="sd">            key &#39;mylist&#39;, this is (&#39;mylist&#39;, &#39;2&#39;).</span>
<span class="sd">        :param column: Optional, an instance of sqlalchemy.orm.attributes.InstrumentedAttribute or</span>
<span class="sd">        :param str column_name: The name of the column, and the backend should get the InstrumentedAttribute.</span>
<span class="sd">        :param alias: The aliased class.</span>

<span class="sd">        :returns: An instance of sqlalchemy.sql.elements.BinaryExpression</span>
<span class="sd">        &quot;&quot;&quot;</span></div>

<div class="viewcode-block" id="BackendQueryBuilder.get_corresponding_properties"><a class="viewcode-back" href="../../../../apidoc/aiida.orm.implementation.html#aiida.orm.implementation.BackendQueryBuilder.get_corresponding_properties">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">get_corresponding_properties</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">entity_table</span><span class="p">,</span> <span class="n">given_properties</span><span class="p">,</span> <span class="n">mapper</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method returns a list of updated properties for a given list of properties.</span>
<span class="sd">        If there is no update for the property, the given property is returned in the list.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">entity_table</span> <span class="ow">in</span> <span class="n">mapper</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">res</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">given_property</span> <span class="ow">in</span> <span class="n">given_properties</span><span class="p">:</span>
                <span class="n">res</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">get_corresponding_property</span><span class="p">(</span><span class="n">entity_table</span><span class="p">,</span> <span class="n">given_property</span><span class="p">,</span> <span class="n">mapper</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">res</span>

        <span class="k">return</span> <span class="n">given_properties</span></div>

<div class="viewcode-block" id="BackendQueryBuilder.get_corresponding_property"><a class="viewcode-back" href="../../../../apidoc/aiida.orm.implementation.html#aiida.orm.implementation.BackendQueryBuilder.get_corresponding_property">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">get_corresponding_property</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">entity_table</span><span class="p">,</span> <span class="n">given_property</span><span class="p">,</span> <span class="n">mapper</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method returns an updated property for a given a property.</span>
<span class="sd">        If there is no update for the property, the given property is returned.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Get the mapping for the specific entity_table</span>
            <span class="n">property_mapping</span> <span class="o">=</span> <span class="n">mapper</span><span class="p">[</span><span class="n">entity_table</span><span class="p">]</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c1"># Get the mapping for the specific property</span>
                <span class="k">return</span> <span class="n">property_mapping</span><span class="p">[</span><span class="n">given_property</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="c1"># If there is no mapping, the property remains unchanged</span>
                <span class="k">return</span> <span class="n">given_property</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="c1"># If it doesn&#39;t exist, it means that the given_property remains v</span>
            <span class="k">return</span> <span class="n">given_property</span></div>

<div class="viewcode-block" id="BackendQueryBuilder.get_filter_expr_from_column"><a class="viewcode-back" href="../../../../apidoc/aiida.orm.implementation.html#aiida.orm.implementation.BackendQueryBuilder.get_filter_expr_from_column">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">get_filter_expr_from_column</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">operator</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">column</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A method that returns an valid SQLAlchemy expression.</span>

<span class="sd">        :param operator: The operator provided by the user (&#39;==&#39;,  &#39;&gt;&#39;, ...)</span>
<span class="sd">        :param value: The value to compare with, e.g. (5.0, &#39;foo&#39;, [&#39;a&#39;,&#39;b&#39;])</span>
<span class="sd">        :param column: an instance of sqlalchemy.orm.attributes.InstrumentedAttribute or</span>

<span class="sd">        :returns: An instance of sqlalchemy.sql.elements.BinaryExpression</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Label is used because it is what is returned for the</span>
        <span class="c1"># &#39;state&#39; column by the hybrid_column construct</span>

        <span class="c1"># Remove when https://github.com/PyCQA/pylint/issues/1931 is fixed</span>
        <span class="c1"># pylint: disable=no-name-in-module,import-error</span>
        <span class="kn">from</span> <span class="nn">sqlalchemy.sql.elements</span> <span class="kn">import</span> <span class="n">Cast</span><span class="p">,</span> <span class="n">Label</span>
        <span class="kn">from</span> <span class="nn">sqlalchemy.orm.attributes</span> <span class="kn">import</span> <span class="n">InstrumentedAttribute</span><span class="p">,</span> <span class="n">QueryableAttribute</span>
        <span class="kn">from</span> <span class="nn">sqlalchemy.sql.expression</span> <span class="kn">import</span> <span class="n">ColumnClause</span>
        <span class="kn">from</span> <span class="nn">sqlalchemy.types</span> <span class="kn">import</span> <span class="n">String</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">column</span><span class="p">,</span> <span class="p">(</span><span class="n">Cast</span><span class="p">,</span> <span class="n">InstrumentedAttribute</span><span class="p">,</span> <span class="n">QueryableAttribute</span><span class="p">,</span> <span class="n">Label</span><span class="p">,</span> <span class="n">ColumnClause</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;column (</span><span class="si">{}</span><span class="s1">) </span><span class="si">{}</span><span class="s1"> is not a valid column&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">column</span><span class="p">),</span> <span class="n">column</span><span class="p">))</span>
        <span class="n">database_entity</span> <span class="o">=</span> <span class="n">column</span>
        <span class="k">if</span> <span class="n">operator</span> <span class="o">==</span> <span class="s1">&#39;==&#39;</span><span class="p">:</span>
            <span class="n">expr</span> <span class="o">=</span> <span class="n">database_entity</span> <span class="o">==</span> <span class="n">value</span>
        <span class="k">elif</span> <span class="n">operator</span> <span class="o">==</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">:</span>
            <span class="n">expr</span> <span class="o">=</span> <span class="n">database_entity</span> <span class="o">&gt;</span> <span class="n">value</span>
        <span class="k">elif</span> <span class="n">operator</span> <span class="o">==</span> <span class="s1">&#39;&lt;&#39;</span><span class="p">:</span>
            <span class="n">expr</span> <span class="o">=</span> <span class="n">database_entity</span> <span class="o">&lt;</span> <span class="n">value</span>
        <span class="k">elif</span> <span class="n">operator</span> <span class="o">==</span> <span class="s1">&#39;&gt;=&#39;</span><span class="p">:</span>
            <span class="n">expr</span> <span class="o">=</span> <span class="n">database_entity</span> <span class="o">&gt;=</span> <span class="n">value</span>
        <span class="k">elif</span> <span class="n">operator</span> <span class="o">==</span> <span class="s1">&#39;&lt;=&#39;</span><span class="p">:</span>
            <span class="n">expr</span> <span class="o">=</span> <span class="n">database_entity</span> <span class="o">&lt;=</span> <span class="n">value</span>
        <span class="k">elif</span> <span class="n">operator</span> <span class="o">==</span> <span class="s1">&#39;like&#39;</span><span class="p">:</span>
            <span class="c1"># the like operator expects a string, so we cast to avoid problems</span>
            <span class="c1"># with fields like UUID, which don&#39;t support the like operator</span>
            <span class="n">expr</span> <span class="o">=</span> <span class="n">database_entity</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">String</span><span class="p">)</span><span class="o">.</span><span class="n">like</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">operator</span> <span class="o">==</span> <span class="s1">&#39;ilike&#39;</span><span class="p">:</span>
            <span class="n">expr</span> <span class="o">=</span> <span class="n">database_entity</span><span class="o">.</span><span class="n">ilike</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">operator</span> <span class="o">==</span> <span class="s1">&#39;in&#39;</span><span class="p">:</span>
            <span class="n">expr</span> <span class="o">=</span> <span class="n">database_entity</span><span class="o">.</span><span class="n">in_</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">InputValidationError</span><span class="p">(</span><span class="s1">&#39;Unknown operator </span><span class="si">{}</span><span class="s1"> for filters on columns&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">operator</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">expr</span></div>

<div class="viewcode-block" id="BackendQueryBuilder.get_projectable_attribute"><a class="viewcode-back" href="../../../../apidoc/aiida.orm.implementation.html#aiida.orm.implementation.BackendQueryBuilder.get_projectable_attribute">[docs]</a>    <span class="k">def</span> <span class="nf">get_projectable_attribute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">alias</span><span class="p">,</span> <span class="n">column_name</span><span class="p">,</span> <span class="n">attrpath</span><span class="p">,</span> <span class="n">cast</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :returns: An attribute store in a JSON field of the give column</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># pylint: disable=unused-argument</span>
        <span class="n">entity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_column</span><span class="p">(</span><span class="n">column_name</span><span class="p">,</span> <span class="n">alias</span><span class="p">)[</span><span class="n">attrpath</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">cast</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">elif</span> <span class="n">cast</span> <span class="o">==</span> <span class="s1">&#39;f&#39;</span><span class="p">:</span>
            <span class="n">entity</span> <span class="o">=</span> <span class="n">entity</span><span class="o">.</span><span class="n">astext</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">Float</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">cast</span> <span class="o">==</span> <span class="s1">&#39;i&#39;</span><span class="p">:</span>
            <span class="n">entity</span> <span class="o">=</span> <span class="n">entity</span><span class="o">.</span><span class="n">astext</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">Integer</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">cast</span> <span class="o">==</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span>
            <span class="n">entity</span> <span class="o">=</span> <span class="n">entity</span><span class="o">.</span><span class="n">astext</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">Boolean</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">cast</span> <span class="o">==</span> <span class="s1">&#39;t&#39;</span><span class="p">:</span>
            <span class="n">entity</span> <span class="o">=</span> <span class="n">entity</span><span class="o">.</span><span class="n">astext</span>
        <span class="k">elif</span> <span class="n">cast</span> <span class="o">==</span> <span class="s1">&#39;j&#39;</span><span class="p">:</span>
            <span class="n">entity</span> <span class="o">=</span> <span class="n">entity</span><span class="o">.</span><span class="n">astext</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">JSONB</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">cast</span> <span class="o">==</span> <span class="s1">&#39;d&#39;</span><span class="p">:</span>
            <span class="n">entity</span> <span class="o">=</span> <span class="n">entity</span><span class="o">.</span><span class="n">astext</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">DateTime</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">InputValidationError</span><span class="p">(</span><span class="s1">&#39;Unkown casting key </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cast</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">entity</span></div>

<div class="viewcode-block" id="BackendQueryBuilder.get_aiida_res"><a class="viewcode-back" href="../../../../apidoc/aiida.orm.implementation.html#aiida.orm.implementation.BackendQueryBuilder.get_aiida_res">[docs]</a>    <span class="k">def</span> <span class="nf">get_aiida_res</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">res</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Some instance returned by ORM (django or SA) need to be converted</span>
<span class="sd">        to AiiDA instances (eg nodes). Choice (sqlalchemy_utils)</span>
<span class="sd">        will return their value</span>

<span class="sd">        :param res: the result returned by the query</span>

<span class="sd">        :returns: an aiida-compatible instance</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">Choice</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">res</span><span class="o">.</span><span class="n">value</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">uuid</span><span class="o">.</span><span class="n">UUID</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_backend</span><span class="o">.</span><span class="n">get_backend_entity</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">res</span></div>

<div class="viewcode-block" id="BackendQueryBuilder.yield_per"><a class="viewcode-back" href="../../../../apidoc/aiida.orm.implementation.html#aiida.orm.implementation.BackendQueryBuilder.yield_per">[docs]</a>    <span class="k">def</span> <span class="nf">yield_per</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param int batch_size: Number of rows to yield per step</span>

<span class="sd">        Yields *count* rows at a time</span>

<span class="sd">        :returns: a generator</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">query</span><span class="o">.</span><span class="n">yield_per</span><span class="p">(</span><span class="n">batch_size</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_session</span><span class="p">()</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">raise</span></div>

<div class="viewcode-block" id="BackendQueryBuilder.count"><a class="viewcode-back" href="../../../../apidoc/aiida.orm.implementation.html#aiida.orm.implementation.BackendQueryBuilder.count">[docs]</a>    <span class="k">def</span> <span class="nf">count</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :returns: the number of results</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">query</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_session</span><span class="p">()</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">raise</span></div>

<div class="viewcode-block" id="BackendQueryBuilder.first"><a class="viewcode-back" href="../../../../apidoc/aiida.orm.implementation.html#aiida.orm.implementation.BackendQueryBuilder.first">[docs]</a>    <span class="k">def</span> <span class="nf">first</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Executes query in the backend asking for one instance.</span>

<span class="sd">        :returns: One row of aiida results</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">query</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_session</span><span class="p">()</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">raise</span></div>

<div class="viewcode-block" id="BackendQueryBuilder.iterall"><a class="viewcode-back" href="../../../../apidoc/aiida.orm.implementation.html#aiida.orm.implementation.BackendQueryBuilder.iterall">[docs]</a>    <span class="k">def</span> <span class="nf">iterall</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">,</span> <span class="n">tag_to_index_dict</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :return: An iterator over all the results of a list of lists.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">tag_to_index_dict</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Got an empty dictionary: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tag_to_index_dict</span><span class="p">))</span>

            <span class="n">results</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="n">yield_per</span><span class="p">(</span><span class="n">batch_size</span><span class="p">)</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tag_to_index_dict</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="c1"># Sqlalchemy, for some strange reason, does not return a list of lsits</span>
                <span class="c1"># if you have provided an ormclass</span>

                <span class="k">if</span> <span class="nb">list</span><span class="p">(</span><span class="n">tag_to_index_dict</span><span class="o">.</span><span class="n">values</span><span class="p">())</span> <span class="o">==</span> <span class="p">[</span><span class="s1">&#39;*&#39;</span><span class="p">]:</span>
                    <span class="k">for</span> <span class="n">rowitem</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
                        <span class="k">yield</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">get_aiida_res</span><span class="p">(</span><span class="n">rowitem</span><span class="p">)]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">rowitem</span><span class="p">,</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
                        <span class="k">yield</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">get_aiida_res</span><span class="p">(</span><span class="n">rowitem</span><span class="p">)]</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">tag_to_index_dict</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">resultrow</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
                    <span class="k">yield</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">get_aiida_res</span><span class="p">(</span><span class="n">rowitem</span><span class="p">)</span> <span class="k">for</span> <span class="n">colindex</span><span class="p">,</span> <span class="n">rowitem</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">resultrow</span><span class="p">)]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Got an empty dictionary&#39;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_session</span><span class="p">()</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">raise</span></div>

<div class="viewcode-block" id="BackendQueryBuilder.iterdict"><a class="viewcode-back" href="../../../../apidoc/aiida.orm.implementation.html#aiida.orm.implementation.BackendQueryBuilder.iterdict">[docs]</a>    <span class="k">def</span> <span class="nf">iterdict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">,</span> <span class="n">tag_to_projected_properties_dict</span><span class="p">,</span> <span class="n">tag_to_alias_map</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :returns: An iterator over all the results of a list of dictionaries.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">nr_items</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">tag_to_projected_properties_dict</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">nr_items</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Got an empty dictionary&#39;</span><span class="p">)</span>

            <span class="n">results</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="n">yield_per</span><span class="p">(</span><span class="n">batch_size</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">nr_items</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">this_result</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
                    <span class="k">yield</span> <span class="p">{</span>
                        <span class="n">tag</span><span class="p">:</span> <span class="p">{</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">get_corresponding_property</span><span class="p">(</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">get_table_name</span><span class="p">(</span><span class="n">tag_to_alias_map</span><span class="p">[</span><span class="n">tag</span><span class="p">]),</span> <span class="n">attrkey</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">inner_to_outer_schema</span>
                            <span class="p">):</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_aiida_res</span><span class="p">(</span><span class="n">this_result</span><span class="p">[</span><span class="n">index_in_sql_result</span><span class="p">])</span>
                            <span class="k">for</span> <span class="n">attrkey</span><span class="p">,</span> <span class="n">index_in_sql_result</span> <span class="ow">in</span> <span class="n">projected_entities_dict</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                        <span class="p">}</span> <span class="k">for</span> <span class="n">tag</span><span class="p">,</span> <span class="n">projected_entities_dict</span> <span class="ow">in</span> <span class="n">tag_to_projected_properties_dict</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                    <span class="p">}</span>
            <span class="k">elif</span> <span class="n">nr_items</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="c1"># I this case, sql returns a  list, where each listitem is the result</span>
                <span class="c1"># for one row. Here I am converting it to a list of lists (of length 1)</span>
                <span class="k">if</span> <span class="p">[</span><span class="n">v</span> <span class="k">for</span> <span class="n">entityd</span> <span class="ow">in</span> <span class="n">tag_to_projected_properties_dict</span><span class="o">.</span><span class="n">values</span><span class="p">()</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">entityd</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span> <span class="o">==</span> <span class="p">[</span><span class="s1">&#39;*&#39;</span><span class="p">]:</span>
                    <span class="k">for</span> <span class="n">this_result</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
                        <span class="k">yield</span> <span class="p">{</span>
                            <span class="n">tag</span><span class="p">:</span> <span class="p">{</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">get_corresponding_property</span><span class="p">(</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">get_table_name</span><span class="p">(</span><span class="n">tag_to_alias_map</span><span class="p">[</span><span class="n">tag</span><span class="p">]),</span> <span class="n">attrkey</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">inner_to_outer_schema</span>
                                <span class="p">):</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_aiida_res</span><span class="p">(</span><span class="n">this_result</span><span class="p">)</span>
                                <span class="k">for</span> <span class="n">attrkey</span><span class="p">,</span> <span class="n">position</span> <span class="ow">in</span> <span class="n">projected_entities_dict</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                            <span class="p">}</span> <span class="k">for</span> <span class="n">tag</span><span class="p">,</span> <span class="n">projected_entities_dict</span> <span class="ow">in</span> <span class="n">tag_to_projected_properties_dict</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                        <span class="p">}</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">this_result</span><span class="p">,</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
                        <span class="k">yield</span> <span class="p">{</span>
                            <span class="n">tag</span><span class="p">:</span> <span class="p">{</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">get_corresponding_property</span><span class="p">(</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">get_table_name</span><span class="p">(</span><span class="n">tag_to_alias_map</span><span class="p">[</span><span class="n">tag</span><span class="p">]),</span> <span class="n">attrkey</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">inner_to_outer_schema</span>
                                <span class="p">):</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_aiida_res</span><span class="p">(</span><span class="n">this_result</span><span class="p">)</span>
                                <span class="k">for</span> <span class="n">attrkey</span><span class="p">,</span> <span class="n">position</span> <span class="ow">in</span> <span class="n">projected_entities_dict</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                            <span class="p">}</span> <span class="k">for</span> <span class="n">tag</span><span class="p">,</span> <span class="n">projected_entities_dict</span> <span class="ow">in</span> <span class="n">tag_to_projected_properties_dict</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                        <span class="p">}</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Got an empty dictionary&#39;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_session</span><span class="p">()</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">raise</span></div>

<div class="viewcode-block" id="BackendQueryBuilder.get_table_name"><a class="viewcode-back" href="../../../../apidoc/aiida.orm.implementation.html#aiida.orm.implementation.BackendQueryBuilder.get_table_name">[docs]</a>    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractstaticmethod</span>
    <span class="k">def</span> <span class="nf">get_table_name</span><span class="p">(</span><span class="n">aliased_class</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the table name given an Aliased class.&quot;&quot;&quot;</span></div>

<div class="viewcode-block" id="BackendQueryBuilder.get_column_names"><a class="viewcode-back" href="../../../../apidoc/aiida.orm.implementation.html#aiida.orm.implementation.BackendQueryBuilder.get_column_names">[docs]</a>    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
    <span class="k">def</span> <span class="nf">get_column_names</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">alias</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the column names of the given table (alias).</span>
<span class="sd">        &quot;&quot;&quot;</span></div>

<div class="viewcode-block" id="BackendQueryBuilder.get_column"><a class="viewcode-back" href="../../../../apidoc/aiida.orm.implementation.html#aiida.orm.implementation.BackendQueryBuilder.get_column">[docs]</a>    <span class="k">def</span> <span class="nf">get_column</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">colname</span><span class="p">,</span> <span class="n">alias</span><span class="p">):</span>  <span class="c1"># pylint: disable=no-self-use</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the column for a given projection.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">alias</span><span class="p">,</span> <span class="n">colname</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">exceptions</span><span class="o">.</span><span class="n">InputValidationError</span><span class="p">(</span>
                <span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> is not a column of </span><span class="si">{}</span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="s1">&#39;Valid columns are:</span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">colname</span><span class="p">,</span>
                    <span class="n">alias</span><span class="p">,</span>
                    <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">alias</span><span class="o">.</span><span class="n">_sa_class_manager</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>  <span class="c1"># pylint: disable=protected-access</span>
                <span class="p">)</span>
            <span class="p">)</span></div></div>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, ECOLE POLYTECHNIQUE FEDERALE DE LAUSANNE (Theory and Simulation of Materials (THEOS) and National Centre for Computational Design and Discovery of Novel Materials (NCCR MARVEL)), Switzerland and ROBERT BOSCH LLC, USA. All rights reserved

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>