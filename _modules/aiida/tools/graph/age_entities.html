

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>aiida.tools.graph.age_entities &mdash; AiiDA 1.2.1 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../../" src="../../../../_static/documentation_options.js"></script>
        <script src="../../../../_static/jquery.js"></script>
        <script src="../../../../_static/underscore.js"></script>
        <script src="../../../../_static/doctools.js"></script>
        <script src="../../../../_static/language_data.js"></script>
        <script src="../../../../_static/togglebutton.js"></script>
        <script src="../../../../_static/contentui.js"></script>
        <script >var togglebuttonSelector = '.toggle';</script>
    
    <script type="text/javascript" src="../../../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/togglebutton.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/contentui.css" type="text/css" />
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../../index.html" class="icon icon-home"> AiiDA
          

          
          </a>

          
            
            
              <div class="version">
                1.2
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../intro/about.html">What is AiiDA</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../intro/get_started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../intro/installation.html">Advanced Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../intro/troubleshooting.html">Troubleshooting</a></li>
</ul>
<p class="caption"><span class="caption-text">Tutorial</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../tutorial/placeholder.html">Placeholder</a></li>
</ul>
<p class="caption"><span class="caption-text">How-To Guides</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../howto/placeholder.html">Placeholder</a></li>
</ul>
<p class="caption"><span class="caption-text">Topics</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../topics/placeholder.html">Placeholder</a></li>
</ul>
<p class="caption"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../reference/placeholder.html">Placeholder</a></li>
</ul>
<p class="caption"><span class="caption-text">Plugins</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../plugins/placeholder.html">Placeholder</a></li>
</ul>
<p class="caption"><span class="caption-text">Development</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../development/placeholder.html">Placeholder</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">AiiDA</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../../index.html">Module code</a> &raquo;</li>
        
          <li><a href="../../../aiida.html">aiida</a> &raquo;</li>
        
      <li>aiida.tools.graph.age_entities</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for aiida.tools.graph.age_entities</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="c1">###########################################################################</span>
<span class="c1"># Copyright (c), The AiiDA team. All rights reserved.                     #</span>
<span class="c1"># This file is part of the AiiDA code.                                    #</span>
<span class="c1">#                                                                         #</span>
<span class="c1"># The code is hosted on GitHub at https://github.com/aiidateam/aiida-core #</span>
<span class="c1"># For further information on the license, see the LICENSE.txt file        #</span>
<span class="c1"># For further information please visit http://www.aiida.net               #</span>
<span class="c1">###########################################################################</span>
<span class="sd">&quot;&quot;&quot;Entities for the AiiDA Graph Explorer utility&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">abc</span> <span class="kn">import</span> <span class="n">ABCMeta</span><span class="p">,</span> <span class="n">abstractmethod</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">namedtuple</span>

<span class="kn">from</span> <span class="nn">aiida</span> <span class="kn">import</span> <span class="n">orm</span>
<span class="kn">from</span> <span class="nn">aiida.orm.utils.links</span> <span class="kn">import</span> <span class="n">LinkQuadruple</span>

<span class="n">VALID_ENTITY_CLASSES</span> <span class="o">=</span> <span class="p">(</span><span class="n">orm</span><span class="o">.</span><span class="n">Node</span><span class="p">,</span> <span class="n">orm</span><span class="o">.</span><span class="n">Group</span><span class="p">)</span>

<span class="n">GroupNodeEdge</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s1">&#39;GroupNodeEdge&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;node_id&#39;</span><span class="p">,</span> <span class="s1">&#39;group_id&#39;</span><span class="p">])</span>


<div class="viewcode-block" id="AbstractSetContainer"><a class="viewcode-back" href="../../../../apidoc/aiida.tools.graph.html#aiida.tools.graph.age_entities.AbstractSetContainer">[docs]</a><span class="k">class</span> <span class="nc">AbstractSetContainer</span><span class="p">(</span><span class="n">metaclass</span><span class="o">=</span><span class="n">ABCMeta</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Abstract Class</span>

<span class="sd">    This class defines a set that can be speciaized to contain either</span>
<span class="sd">    nodes (either AiiDA nodes or Aiida groups) or edges (AiiDA links,</span>
<span class="sd">    or records of the connections between groups and nodes).</span>
<span class="sd">    Instances of this class reference a subset of entities in a database</span>
<span class="sd">    via a unique identifier.</span>
<span class="sd">    There are also a few operators defined, for simplicity, to do</span>
<span class="sd">    set-additions (unions) and deletions.</span>
<span class="sd">    The underlying Python-class is **set**, which means that adding</span>
<span class="sd">    an instance to an AiidaEntitySet that is already contained by it</span>
<span class="sd">    will not create a duplicate.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="AbstractSetContainer.__init__"><a class="viewcode-back" href="../../../../apidoc/aiida.tools.graph.html#aiida.tools.graph.age_entities.AbstractSetContainer.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialization method&quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_keyset</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_additional_identifiers</span> <span class="o">=</span> <span class="p">()</span></div>

<div class="viewcode-block" id="AbstractSetContainer._check_self_and_other"><a class="viewcode-back" href="../../../../apidoc/aiida.tools.graph.html#aiida.tools.graph.age_entities.AbstractSetContainer._check_self_and_other">[docs]</a>    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">_check_self_and_other</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Utility function</span>

<span class="sd">        When called, will check whether self and other instance are compatible.</span>
<span class="sd">        (i.e. if they contain the same AiiDA class, same identifiers, length of</span>
<span class="sd">        tuples, etc)</span>

<span class="sd">        :type other: :py:class:`aiida.tools.graph.age_entities.AbstractSetContainer`</span>
<span class="sd">        :param other: the other entity to check for compatibility.</span>
<span class="sd">        &quot;&quot;&quot;</span></div>

<div class="viewcode-block" id="AbstractSetContainer._check_input_for_set"><a class="viewcode-back" href="../../../../apidoc/aiida.tools.graph.html#aiida.tools.graph.age_entities.AbstractSetContainer._check_input_for_set">[docs]</a>    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">_check_input_for_set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_for_set</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Utility function</span>

<span class="sd">        When provinding input keys for the internal set, this utility function will</span>
<span class="sd">        check and process the input accordingly.</span>

<span class="sd">        :param input_for_set: input argument for the keyset (must be either an</span>
<span class="sd">            AiiDA instance of node or group, or an identifier of the type used</span>
<span class="sd">            by the container).</span>
<span class="sd">        &quot;&quot;&quot;</span></div>

<div class="viewcode-block" id="AbstractSetContainer.get_template"><a class="viewcode-back" href="../../../../apidoc/aiida.tools.graph.html#aiida.tools.graph.age_entities.AbstractSetContainer.get_template">[docs]</a>    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">get_template</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create new instance with the same defining attributes.&quot;&quot;&quot;</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">keyset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set containing the keys of the entities&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_keyset</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">additional_identifiers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Additional identifiers for the entities&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_additional_identifiers</span>

    <span class="nd">@keyset</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">keyset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inpset</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Setter for the keyset</span>

<span class="sd">        Use with care! There is no way to check if the keys are consistent ids here.</span>
<span class="sd">        Checks should be performed upstream in the code, previous to calling this setter.</span>

<span class="sd">        :type inpset: set or None</span>
<span class="sd">        :param inpset: input set of identifiers that will become the new set contained</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">valid_type</span> <span class="o">=</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">inpset</span><span class="p">,</span> <span class="nb">set</span><span class="p">)</span> <span class="ow">or</span> <span class="n">inpset</span> <span class="ow">is</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">valid_type</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;keyset must be assigned a set or None&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_keyset</span> <span class="o">=</span> <span class="n">inpset</span>

<div class="viewcode-block" id="AbstractSetContainer.__add__"><a class="viewcode-back" href="../../../../apidoc/aiida.tools.graph.html#aiida.tools.graph.age_entities.AbstractSetContainer.__add__">[docs]</a>    <span class="k">def</span> <span class="fm">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Addition (return = self + other): defined as the set union&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_self_and_other</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
        <span class="n">new</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_template</span><span class="p">()</span>
        <span class="n">new</span><span class="o">.</span><span class="n">keyset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">keyset</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">keyset</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">new</span></div>

<div class="viewcode-block" id="AbstractSetContainer.__iadd__"><a class="viewcode-back" href="../../../../apidoc/aiida.tools.graph.html#aiida.tools.graph.age_entities.AbstractSetContainer.__iadd__">[docs]</a>    <span class="k">def</span> <span class="fm">__iadd__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Addition inplace (self += other)&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_self_and_other</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">keyset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">keyset</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">keyset</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="AbstractSetContainer.__sub__"><a class="viewcode-back" href="../../../../apidoc/aiida.tools.graph.html#aiida.tools.graph.age_entities.AbstractSetContainer.__sub__">[docs]</a>    <span class="k">def</span> <span class="fm">__sub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Subtraction (return = self - other): defined as the set-difference&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_self_and_other</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
        <span class="n">new</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_template</span><span class="p">()</span>
        <span class="n">new</span><span class="o">.</span><span class="n">keyset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">keyset</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">keyset</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">new</span></div>

<div class="viewcode-block" id="AbstractSetContainer.__isub__"><a class="viewcode-back" href="../../../../apidoc/aiida.tools.graph.html#aiida.tools.graph.age_entities.AbstractSetContainer.__isub__">[docs]</a>    <span class="k">def</span> <span class="fm">__isub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Subtraction inplace (self -= other)&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_self_and_other</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">keyset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">keyset</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">keyset</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="AbstractSetContainer.__len__"><a class="viewcode-back" href="../../../../apidoc/aiida.tools.graph.html#aiida.tools.graph.age_entities.AbstractSetContainer.__len__">[docs]</a>    <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">keyset</span><span class="p">)</span></div>

<div class="viewcode-block" id="AbstractSetContainer.__repr__"><a class="viewcode-back" href="../../../../apidoc/aiida.tools.graph.html#aiida.tools.graph.age_entities.AbstractSetContainer.__repr__">[docs]</a>    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;{{</span><span class="si">{}</span><span class="s1">}}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">keyset</span><span class="p">)))</span></div>

<div class="viewcode-block" id="AbstractSetContainer.__eq__"><a class="viewcode-back" href="../../../../apidoc/aiida.tools.graph.html#aiida.tools.graph.age_entities.AbstractSetContainer.__eq__">[docs]</a>    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">keyset</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">keyset</span></div>

<div class="viewcode-block" id="AbstractSetContainer.__ne__"><a class="viewcode-back" href="../../../../apidoc/aiida.tools.graph.html#aiida.tools.graph.age_entities.AbstractSetContainer.__ne__">[docs]</a>    <span class="k">def</span> <span class="fm">__ne__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="bp">self</span> <span class="o">==</span> <span class="n">other</span></div>

<div class="viewcode-block" id="AbstractSetContainer.set_entities"><a class="viewcode-back" href="../../../../apidoc/aiida.tools.graph.html#aiida.tools.graph.age_entities.AbstractSetContainer.set_entities">[docs]</a>    <span class="k">def</span> <span class="nf">set_entities</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_entitites</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Replaces contained set with the new entities.</span>

<span class="sd">        :param new_entities: entities which will replace the ones contained</span>
<span class="sd">            by the EntitySet. Must be an AiiDA instance (Node or Group) or</span>
<span class="sd">            an appropriate identifier (ID).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">keyset</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_check_input_for_set</span><span class="p">,</span> <span class="n">new_entitites</span><span class="p">))</span></div>

<div class="viewcode-block" id="AbstractSetContainer.add_entities"><a class="viewcode-back" href="../../../../apidoc/aiida.tools.graph.html#aiida.tools.graph.age_entities.AbstractSetContainer.add_entities">[docs]</a>    <span class="k">def</span> <span class="nf">add_entities</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_entitites</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add new entitities to the existing set of self.</span>

<span class="sd">        :param new_entities: an iterable of new entities to add.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">keyset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">keyset</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_check_input_for_set</span><span class="p">,</span> <span class="n">new_entitites</span><span class="p">)))</span></div>

<div class="viewcode-block" id="AbstractSetContainer.copy"><a class="viewcode-back" href="../../../../apidoc/aiida.tools.graph.html#aiida.tools.graph.age_entities.AbstractSetContainer.copy">[docs]</a>    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create new instance with the same defining attributes and the same keyset.&quot;&quot;&quot;</span>
        <span class="n">new</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_template</span><span class="p">()</span>
        <span class="n">new</span><span class="o">.</span><span class="n">keyset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">keyset</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">new</span></div>

<div class="viewcode-block" id="AbstractSetContainer.empty"><a class="viewcode-back" href="../../../../apidoc/aiida.tools.graph.html#aiida.tools.graph.age_entities.AbstractSetContainer.empty">[docs]</a>    <span class="k">def</span> <span class="nf">empty</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Resets the contained set to be an empty set&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">keyset</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span></div></div>


<div class="viewcode-block" id="AiidaEntitySet"><a class="viewcode-back" href="../../../../apidoc/aiida.tools.graph.html#aiida.tools.graph.age_entities.AiidaEntitySet">[docs]</a><span class="k">class</span> <span class="nc">AiidaEntitySet</span><span class="p">(</span><span class="n">AbstractSetContainer</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Extension of AbstractSetContainer</span>

<span class="sd">    This class is used to store `graph nodes` (aidda nodes or aiida groups).</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="AiidaEntitySet.__init__"><a class="viewcode-back" href="../../../../apidoc/aiida.tools.graph.html#aiida.tools.graph.age_entities.AiidaEntitySet.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">aiida_cls</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialization method</span>

<span class="sd">        :param aiida_cls: a valid AiiDA ORM class (Node or Group supported).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">aiida_cls</span> <span class="ow">in</span> <span class="n">VALID_ENTITY_CLASSES</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;aiida_cls has to be among:</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">VALID_ENTITY_CLASSES</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_aiida_cls</span> <span class="o">=</span> <span class="n">aiida_cls</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">keyset</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_identifier</span> <span class="o">=</span> <span class="s1">&#39;id&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_identifier_type</span> <span class="o">=</span> <span class="nb">int</span></div>

<div class="viewcode-block" id="AiidaEntitySet._check_self_and_other"><a class="viewcode-back" href="../../../../apidoc/aiida.tools.graph.html#aiida.tools.graph.age_entities.AiidaEntitySet._check_self_and_other">[docs]</a>    <span class="k">def</span> <span class="nf">_check_self_and_other</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">AiidaEntitySet</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;Other class is not an instance of AiidaEntitySet&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">aiida_cls</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">aiida_cls</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;The two instances do not have the same aiida type!&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">identifier</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">identifier</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;The two instances do not have the same identifier!&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_identifier_type</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">identifier_type</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;The two instances do not have the same identifier type!&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="AiidaEntitySet._check_input_for_set"><a class="viewcode-back" href="../../../../apidoc/aiida.tools.graph.html#aiida.tools.graph.age_entities.AiidaEntitySet._check_input_for_set">[docs]</a>    <span class="k">def</span> <span class="nf">_check_input_for_set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_for_set</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">input_for_set</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_aiida_cls</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">input_for_set</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_identifier</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">input_for_set</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_identifier_type</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">input_for_set</span>

        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> is not a valid input</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="s1">&#39;You can either pass an AiiDA instance or a key to an instance that&#39;</span>
            <span class="s1">&#39;matches the identifier you defined (</span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">input_for_set</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_identifier_type</span><span class="p">)</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="AiidaEntitySet.get_template"><a class="viewcode-back" href="../../../../apidoc/aiida.tools.graph.html#aiida.tools.graph.age_entities.AiidaEntitySet.get_template">[docs]</a>    <span class="k">def</span> <span class="nf">get_template</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">AiidaEntitySet</span><span class="p">(</span><span class="n">aiida_cls</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">aiida_cls</span><span class="p">)</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">identifier</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Identifier used for the nodes or groups (currently always id)&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_identifier</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">identifier_type</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Type of identifier for the node or group (for id is int)&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_identifier_type</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">aiida_cls</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Class of nodes contained in the entity set (node or group)&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_aiida_cls</span>

<div class="viewcode-block" id="AiidaEntitySet.get_entities"><a class="viewcode-back" href="../../../../apidoc/aiida.tools.graph.html#aiida.tools.graph.age_entities.AiidaEntitySet.get_entities">[docs]</a>    <span class="k">def</span> <span class="nf">get_entities</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Iterator that returns the AiiDA entities&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">entity</span><span class="p">,</span> <span class="ow">in</span> <span class="n">orm</span><span class="o">.</span><span class="n">QueryBuilder</span><span class="p">()</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_aiida_cls</span><span class="p">,</span> <span class="n">project</span><span class="o">=</span><span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="n">filters</span><span class="o">=</span><span class="p">{</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_identifier</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s1">&#39;in&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">keyset</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">)</span><span class="o">.</span><span class="n">iterall</span><span class="p">():</span>
            <span class="k">yield</span> <span class="n">entity</span></div></div>


<div class="viewcode-block" id="DirectedEdgeSet"><a class="viewcode-back" href="../../../../apidoc/aiida.tools.graph.html#aiida.tools.graph.age_entities.DirectedEdgeSet">[docs]</a><span class="k">class</span> <span class="nc">DirectedEdgeSet</span><span class="p">(</span><span class="n">AbstractSetContainer</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Extension of AbstractSetContainer</span>

<span class="sd">    This class is used to store `graph edges` (aidda nodes or aiida groups).</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="DirectedEdgeSet.__init__"><a class="viewcode-back" href="../../../../apidoc/aiida.tools.graph.html#aiida.tools.graph.age_entities.DirectedEdgeSet.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">aiida_cls_to</span><span class="p">,</span> <span class="n">aiida_cls_from</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialization method</span>

<span class="sd">        The classes that the link connects must be provided.</span>

<span class="sd">        :param aiida_cls_to: a valid AiiDA ORM class (Node or Group supported).</span>
<span class="sd">        :param aiida_cls_from: a valid AiiDA ORM class (Node supported).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">aiida_cls</span> <span class="ow">in</span> <span class="p">(</span><span class="n">aiida_cls_to</span><span class="p">,</span> <span class="n">aiida_cls_from</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">aiida_cls</span> <span class="ow">in</span> <span class="n">VALID_ENTITY_CLASSES</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;aiida_cls has to be among:</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">VALID_ENTITY_CLASSES</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_aiida_cls_to</span> <span class="o">=</span> <span class="n">aiida_cls_to</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_aiida_cls_from</span> <span class="o">=</span> <span class="n">aiida_cls_from</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">keyset</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

        <span class="c1"># I need to get the identifiers for the edge. For now, these should be hardcoded</span>
        <span class="k">if</span> <span class="n">aiida_cls_from</span> <span class="ow">is</span> <span class="n">orm</span><span class="o">.</span><span class="n">Node</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">aiida_cls_to</span> <span class="ow">is</span> <span class="n">orm</span><span class="o">.</span><span class="n">Node</span><span class="p">:</span>
                <span class="c1"># This is a Node-Node connection, therefore I will get information on the links</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_edge_identifiers</span> <span class="o">=</span> <span class="p">((</span><span class="s1">&#39;edge&#39;</span><span class="p">,</span> <span class="s1">&#39;input_id&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;edge&#39;</span><span class="p">,</span> <span class="s1">&#39;output_id&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;edge&#39;</span><span class="p">,</span> <span class="s1">&#39;type&#39;</span><span class="p">),</span>
                                          <span class="p">(</span><span class="s1">&#39;edge&#39;</span><span class="p">,</span> <span class="s1">&#39;label&#39;</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_edge_namedtuple</span> <span class="o">=</span> <span class="n">LinkQuadruple</span>
            <span class="k">elif</span> <span class="n">aiida_cls_to</span> <span class="ow">is</span> <span class="n">orm</span><span class="o">.</span><span class="n">Group</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_edge_identifiers</span> <span class="o">=</span> <span class="p">((</span><span class="s1">&#39;nodes&#39;</span><span class="p">,</span> <span class="s1">&#39;id&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;groups&#39;</span><span class="p">,</span> <span class="s1">&#39;id&#39;</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_edge_namedtuple</span> <span class="o">=</span> <span class="n">GroupNodeEdge</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                    <span class="s1">&#39;Unexpted types aiida_cls_from=</span><span class="si">{}</span><span class="s1"> and aiida_cls_to=</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">aiida_cls_from</span><span class="p">,</span> <span class="n">aiida_cls_to</span><span class="p">)</span>
                <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;Unexpted types aiida_cls_from=</span><span class="si">{}</span><span class="s1"> and aiida_cls_to=</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">aiida_cls_from</span><span class="p">,</span> <span class="n">aiida_cls_to</span><span class="p">))</span></div>

<div class="viewcode-block" id="DirectedEdgeSet._check_self_and_other"><a class="viewcode-back" href="../../../../apidoc/aiida.tools.graph.html#aiida.tools.graph.age_entities.DirectedEdgeSet._check_self_and_other">[docs]</a>    <span class="k">def</span> <span class="nf">_check_self_and_other</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">DirectedEdgeSet</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;Other class is not an instance of AiidaEntitySet&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">aiida_cls_to</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">aiida_cls_to</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;The two instances do not have the same aiida type!&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">aiida_cls_from</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">aiida_cls_from</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;The two instances do not have the same aiida type!&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">edge_namedtuple</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">edge_namedtuple</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;The two instances do not have the same identifiers!&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="DirectedEdgeSet._check_input_for_set"><a class="viewcode-back" href="../../../../apidoc/aiida.tools.graph.html#aiida.tools.graph.age_entities.DirectedEdgeSet._check_input_for_set">[docs]</a>    <span class="k">def</span> <span class="nf">_check_input_for_set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_for_set</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">input_for_set</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;value for `input_for_set` </span><span class="si">{}</span><span class="s1"> is not a tuple&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">input_for_set</span><span class="p">))</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">input_for_set</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_edge_identifiers</span><span class="p">):</span>
            <span class="n">inputs_len</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">input_for_set</span><span class="p">)</span>
            <span class="n">inside_len</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_edge_identifiers</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;tuple passed has len = </span><span class="si">{}</span><span class="s1">, but there are </span><span class="si">{}</span><span class="s1"> identifiers&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">inputs_len</span><span class="p">,</span> <span class="n">inside_len</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">input_for_set</span></div>

<div class="viewcode-block" id="DirectedEdgeSet.get_template"><a class="viewcode-back" href="../../../../apidoc/aiida.tools.graph.html#aiida.tools.graph.age_entities.DirectedEdgeSet.get_template">[docs]</a>    <span class="k">def</span> <span class="nf">get_template</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">DirectedEdgeSet</span><span class="p">(</span><span class="n">aiida_cls_to</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">aiida_cls_to</span><span class="p">,</span> <span class="n">aiida_cls_from</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">aiida_cls_from</span><span class="p">)</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">aiida_cls_to</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The class of nodes which the edge points to&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_aiida_cls_to</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">aiida_cls_from</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The class of nodes which the edge points from&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_aiida_cls_from</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">edge_namedtuple</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The namedtuple type used for the edges` identifiers&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_edge_namedtuple</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">edge_identifiers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The identifiers for the edges&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_edge_identifiers</span></div>


<div class="viewcode-block" id="Basket"><a class="viewcode-back" href="../../../../apidoc/aiida.tools.graph.html#aiida.tools.graph.age_entities.Basket">[docs]</a><span class="k">class</span> <span class="nc">Basket</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Container for several instances of</span>
<span class="sd">    :py:class:`aiida.tools.graph.age_entities.AiidaEntitySet` .</span>

<span class="sd">    In the current implementation, it contains one EntitySet for Nodes and one for Groups,</span>
<span class="sd">    and one EdgeSet for Node-Node edges (links) and one for Group-Node connections.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="Basket.__init__"><a class="viewcode-back" href="../../../../apidoc/aiida.tools.graph.html#aiida.tools.graph.age_entities.Basket.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nodes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">groups</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">nodes_nodes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">groups_nodes</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialization method</span>

<span class="sd">        During initialization of the basket, both the sets of nodes and the set of</span>
<span class="sd">        groups can be provided as one of the following: an AiidaEntitySet with the</span>
<span class="sd">        respective type (node or group) or a list/set/tuple with the ids of the</span>
<span class="sd">        respective node or group.</span>

<span class="sd">        :param nodes: AiiDA nodes provided in an acceptable way.</span>
<span class="sd">        :param groups: AiiDA groups provided in an acceptable way.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">get_check_set_entity_set</span><span class="p">(</span><span class="n">input_object</span><span class="p">,</span> <span class="n">keyword</span><span class="p">,</span> <span class="n">aiida_class</span><span class="p">):</span>

            <span class="k">if</span> <span class="n">input_object</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">output_set</span> <span class="o">=</span> <span class="n">AiidaEntitySet</span><span class="p">(</span><span class="n">aiida_class</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">output_set</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">input_object</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">,</span> <span class="nb">set</span><span class="p">)):</span>
                <span class="n">output_set</span> <span class="o">=</span> <span class="n">AiidaEntitySet</span><span class="p">(</span><span class="n">aiida_class</span><span class="p">)</span>
                <span class="n">output_set</span><span class="o">.</span><span class="n">set_entities</span><span class="p">(</span><span class="n">input_object</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">output_set</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">input_object</span><span class="p">,</span> <span class="n">AiidaEntitySet</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">input_object</span><span class="o">.</span><span class="n">aiida_cls</span> <span class="ow">is</span> <span class="n">aiida_class</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">input_object</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">  has to  have </span><span class="si">{}</span><span class="s1"> as aiida_cls&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">keyword</span><span class="p">,</span> <span class="n">aiida_class</span><span class="p">))</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s1">&#39;Input object is of type </span><span class="si">{}</span><span class="s1">.</span><span class="se">\n</span><span class="s1">&#39;</span>
                    <span class="s1">&#39;Instead, it should be either None or one of:</span><span class="se">\n</span><span class="s1">&#39;</span>
                    <span class="s1">&#39; - </span><span class="si">{}</span><span class="se">\n</span><span class="s1"> - </span><span class="si">{}</span><span class="se">\n</span><span class="s1"> - </span><span class="si">{}</span><span class="se">\n</span><span class="s1"> - </span><span class="si">{}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">input_object</span><span class="p">,</span> <span class="n">AiidaEntitySet</span><span class="p">,</span> <span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">,</span> <span class="nb">set</span><span class="p">)</span>
                <span class="p">)</span>

        <span class="k">def</span> <span class="nf">get_check_set_directed_edge_set</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">keyword</span><span class="p">,</span> <span class="n">cls_from</span><span class="p">,</span> <span class="n">cls_to</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">var</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">DirectedEdgeSet</span><span class="p">(</span><span class="n">aiida_cls_to</span><span class="o">=</span><span class="n">cls_to</span><span class="p">,</span> <span class="n">aiida_cls_from</span><span class="o">=</span><span class="n">cls_from</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">DirectedEdgeSet</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">var</span><span class="o">.</span><span class="n">aiida_cls_from</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">cls_from</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> has to  have </span><span class="si">{}</span><span class="s1"> as aiida_cls_from&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">keyword</span><span class="p">,</span> <span class="n">cls_from</span><span class="p">))</span>
                <span class="k">elif</span> <span class="n">var</span><span class="o">.</span><span class="n">aiida_cls_to</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">cls_to</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> has to  have </span><span class="si">{}</span><span class="s1"> as aiida_cls_to&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">keyword</span><span class="p">,</span> <span class="n">cls_to</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">var</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> has to be an instance of DirectedEdgeSet&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">keyword</span><span class="p">))</span>

        <span class="n">nodes</span> <span class="o">=</span> <span class="n">get_check_set_entity_set</span><span class="p">(</span><span class="n">nodes</span><span class="p">,</span> <span class="s1">&#39;nodes&#39;</span><span class="p">,</span> <span class="n">orm</span><span class="o">.</span><span class="n">Node</span><span class="p">)</span>
        <span class="n">groups</span> <span class="o">=</span> <span class="n">get_check_set_entity_set</span><span class="p">(</span><span class="n">groups</span><span class="p">,</span> <span class="s1">&#39;groups&#39;</span><span class="p">,</span> <span class="n">orm</span><span class="o">.</span><span class="n">Group</span><span class="p">)</span>
        <span class="n">nodes_nodes</span> <span class="o">=</span> <span class="n">get_check_set_directed_edge_set</span><span class="p">(</span><span class="n">nodes_nodes</span><span class="p">,</span> <span class="s1">&#39;nodes-nodes&#39;</span><span class="p">,</span> <span class="n">orm</span><span class="o">.</span><span class="n">Node</span><span class="p">,</span> <span class="n">orm</span><span class="o">.</span><span class="n">Node</span><span class="p">)</span>
        <span class="n">groups_nodes</span> <span class="o">=</span> <span class="n">get_check_set_directed_edge_set</span><span class="p">(</span><span class="n">groups_nodes</span><span class="p">,</span> <span class="s1">&#39;groups-nodes&#39;</span><span class="p">,</span> <span class="n">orm</span><span class="o">.</span><span class="n">Node</span><span class="p">,</span> <span class="n">orm</span><span class="o">.</span><span class="n">Group</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">nodes</span><span class="o">=</span><span class="n">nodes</span><span class="p">,</span> <span class="n">groups</span><span class="o">=</span><span class="n">groups</span><span class="p">,</span> <span class="n">nodes_nodes</span><span class="o">=</span><span class="n">nodes_nodes</span><span class="p">,</span> <span class="n">groups_nodes</span><span class="o">=</span><span class="n">groups_nodes</span><span class="p">)</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">sets</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        All sets in the basket returned as an ordered list.</span>
<span class="sd">        The order is: &#39;groups&#39;, &#39;groups_nodes&#39;, &#39;nodes&#39;, &#39;nodes_nodes&#39;.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="o">.</span><span class="n">items</span><span class="p">())))[</span><span class="mi">1</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        All sets in the basket returned as a dictionary.</span>
<span class="sd">        This includes the keys &#39;nodes&#39;, &#39;groups&#39;, &#39;nodes_nodes&#39; and &#39;nodes_groups&#39;.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dict</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">nodes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set of nodes stored in the basket&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dict</span><span class="p">[</span><span class="s1">&#39;nodes&#39;</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">groups</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set of groups stored in the basket&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dict</span><span class="p">[</span><span class="s1">&#39;groups&#39;</span><span class="p">]</span>

<div class="viewcode-block" id="Basket.__getitem__"><a class="viewcode-back" href="../../../../apidoc/aiida.tools.graph.html#aiida.tools.graph.age_entities.Basket.__getitem__">[docs]</a>    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span></div>

<div class="viewcode-block" id="Basket.__setitem__"><a class="viewcode-back" href="../../../../apidoc/aiida.tools.graph.html#aiida.tools.graph.age_entities.Basket.__setitem__">[docs]</a>    <span class="k">def</span> <span class="fm">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span></div>

<div class="viewcode-block" id="Basket.__add__"><a class="viewcode-back" href="../../../../apidoc/aiida.tools.graph.html#aiida.tools.graph.age_entities.Basket.__add__">[docs]</a>    <span class="k">def</span> <span class="fm">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="n">new_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dict</span><span class="p">:</span>
            <span class="n">new_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">+</span> <span class="n">other</span><span class="o">.</span><span class="n">dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">Basket</span><span class="p">(</span><span class="o">**</span><span class="n">new_dict</span><span class="p">)</span></div>

<div class="viewcode-block" id="Basket.__iadd__"><a class="viewcode-back" href="../../../../apidoc/aiida.tools.graph.html#aiida.tools.graph.age_entities.Basket.__iadd__">[docs]</a>    <span class="k">def</span> <span class="fm">__iadd__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dict</span><span class="p">:</span>
            <span class="bp">self</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">+=</span> <span class="n">other</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="Basket.__sub__"><a class="viewcode-back" href="../../../../apidoc/aiida.tools.graph.html#aiida.tools.graph.age_entities.Basket.__sub__">[docs]</a>    <span class="k">def</span> <span class="fm">__sub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="n">new_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dict</span><span class="p">:</span>
            <span class="n">new_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">-</span> <span class="n">other</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">Basket</span><span class="p">(</span><span class="o">**</span><span class="n">new_dict</span><span class="p">)</span></div>

<div class="viewcode-block" id="Basket.__isub__"><a class="viewcode-back" href="../../../../apidoc/aiida.tools.graph.html#aiida.tools.graph.age_entities.Basket.__isub__">[docs]</a>    <span class="k">def</span> <span class="fm">__isub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">other</span><span class="o">.</span><span class="n">dict</span><span class="p">:</span>
            <span class="bp">self</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">-=</span> <span class="n">other</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="Basket.__len__"><a class="viewcode-back" href="../../../../apidoc/aiida.tools.graph.html#aiida.tools.graph.age_entities.Basket.__len__">[docs]</a>    <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">sum</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sets</span><span class="p">])</span></div>

<div class="viewcode-block" id="Basket.__eq__"><a class="viewcode-back" href="../../../../apidoc/aiida.tools.graph.html#aiida.tools.graph.age_entities.Basket.__eq__">[docs]</a>    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dict</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">!=</span> <span class="n">other</span><span class="p">[</span><span class="n">key</span><span class="p">]:</span>
                <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="Basket.__ne__"><a class="viewcode-back" href="../../../../apidoc/aiida.tools.graph.html#aiida.tools.graph.age_entities.Basket.__ne__">[docs]</a>    <span class="k">def</span> <span class="fm">__ne__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="bp">self</span> <span class="o">==</span> <span class="n">other</span></div>

<div class="viewcode-block" id="Basket.__repr__"><a class="viewcode-back" href="../../../../apidoc/aiida.tools.graph.html#aiida.tools.graph.age_entities.Basket.__repr__">[docs]</a>    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">ret_str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">ret_str</span> <span class="o">+=</span> <span class="s1">&#39;  &#39;</span> <span class="o">+</span> <span class="n">key</span> <span class="o">+</span> <span class="s1">&#39;: &#39;</span>
            <span class="n">ret_str</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="k">return</span> <span class="n">ret_str</span></div>

<div class="viewcode-block" id="Basket.empty"><a class="viewcode-back" href="../../../../apidoc/aiida.tools.graph.html#aiida.tools.graph.age_entities.Basket.empty">[docs]</a>    <span class="k">def</span> <span class="nf">empty</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Empty every subset from its content&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">set_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dict</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">set_</span><span class="o">.</span><span class="n">empty</span><span class="p">()</span></div>

<div class="viewcode-block" id="Basket.get_template"><a class="viewcode-back" href="../../../../apidoc/aiida.tools.graph.html#aiida.tools.graph.age_entities.Basket.get_template">[docs]</a>    <span class="k">def</span> <span class="nf">get_template</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create new nasket with the same defining attributes for its internal containers.&quot;&quot;&quot;</span>
        <span class="n">new_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">new_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span><span class="o">.</span><span class="n">get_template</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">Basket</span><span class="p">(</span><span class="o">**</span><span class="n">new_dict</span><span class="p">)</span></div>

<div class="viewcode-block" id="Basket.copy"><a class="viewcode-back" href="../../../../apidoc/aiida.tools.graph.html#aiida.tools.graph.age_entities.Basket.copy">[docs]</a>    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create new instance with the same defining attributes and content.&quot;&quot;&quot;</span>
        <span class="n">new_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">new_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">Basket</span><span class="p">(</span><span class="o">**</span><span class="n">new_dict</span><span class="p">)</span></div></div>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, ECOLE POLYTECHNIQUE FEDERALE DE LAUSANNE (Theory and Simulation of Materials (THEOS) and National Centre for Computational Design and Discovery of Novel Materials (NCCR MARVEL)), Switzerland and ROBERT BOSCH LLC, USA. All rights reserved

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>