

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>aiida.cmdline.params.types.identifier &mdash; AiiDA 1.2.1 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../../../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../../../" src="../../../../../_static/documentation_options.js"></script>
        <script src="../../../../../_static/jquery.js"></script>
        <script src="../../../../../_static/underscore.js"></script>
        <script src="../../../../../_static/doctools.js"></script>
        <script src="../../../../../_static/language_data.js"></script>
        <script src="../../../../../_static/togglebutton.js"></script>
        <script src="../../../../../_static/contentui.js"></script>
        <script >var togglebuttonSelector = '.toggle';</script>
    
    <script type="text/javascript" src="../../../../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../../../_static/togglebutton.css" type="text/css" />
  <link rel="stylesheet" href="../../../../../_static/contentui.css" type="text/css" />
    <link rel="index" title="Index" href="../../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../../../index.html" class="icon icon-home"> AiiDA
          

          
          </a>

          
            
            
              <div class="version">
                1.2
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../intro/about.html">What is AiiDA</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../intro/get_started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../intro/installation.html">Advanced Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../intro/troubleshooting.html">Troubleshooting</a></li>
</ul>
<p class="caption"><span class="caption-text">Tutorial</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../tutorial/placeholder.html">Placeholder</a></li>
</ul>
<p class="caption"><span class="caption-text">How-To Guides</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../howto/placeholder.html">Placeholder</a></li>
</ul>
<p class="caption"><span class="caption-text">Topics</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../topics/placeholder.html">Placeholder</a></li>
</ul>
<p class="caption"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../reference/placeholder.html">Placeholder</a></li>
</ul>
<p class="caption"><span class="caption-text">Plugins</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../plugins/placeholder.html">Placeholder</a></li>
</ul>
<p class="caption"><span class="caption-text">Development</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../development/placeholder.html">Placeholder</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../../index.html">AiiDA</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../../../index.html">Module code</a> &raquo;</li>
        
          <li><a href="../../../../aiida.html">aiida</a> &raquo;</li>
        
      <li>aiida.cmdline.params.types.identifier</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for aiida.cmdline.params.types.identifier</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="c1">###########################################################################</span>
<span class="c1"># Copyright (c), The AiiDA team. All rights reserved.                     #</span>
<span class="c1"># This file is part of the AiiDA code.                                    #</span>
<span class="c1">#                                                                         #</span>
<span class="c1"># The code is hosted on GitHub at https://github.com/aiidateam/aiida-core #</span>
<span class="c1"># For further information on the license, see the LICENSE.txt file        #</span>
<span class="c1"># For further information please visit http://www.aiida.net               #</span>
<span class="c1">###########################################################################</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Module for custom click param type identifier</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">abc</span> <span class="kn">import</span> <span class="n">ABC</span><span class="p">,</span> <span class="n">abstractproperty</span>

<span class="kn">import</span> <span class="nn">click</span>

<span class="kn">from</span> <span class="nn">aiida.cmdline.utils.decorators</span> <span class="kn">import</span> <span class="n">with_dbenv</span>
<span class="kn">from</span> <span class="nn">aiida.plugins.entry_point</span> <span class="kn">import</span> <span class="n">get_entry_point_from_string</span>


<div class="viewcode-block" id="IdentifierParamType"><a class="viewcode-back" href="../../../../../apidoc/aiida.cmdline.params.types.html#aiida.cmdline.IdentifierParamType">[docs]</a><span class="k">class</span> <span class="nc">IdentifierParamType</span><span class="p">(</span><span class="n">click</span><span class="o">.</span><span class="n">ParamType</span><span class="p">,</span> <span class="n">ABC</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    An extension of click.ParamType for a generic identifier parameter. In AiiDA, orm entities can often be</span>
<span class="sd">    identified by either their ID, UUID or optionally some LABEL identifier. This parameter type implements</span>
<span class="sd">    the convert method, which attempts to convert a value passed to the command for a parameter with this type,</span>
<span class="sd">    to an orm entity. The actual loading of the entity is delegated to the orm class loader. Subclasses of this</span>
<span class="sd">    parameter type should implement the `orm_class_loader` method to return the appropriate orm class loader,</span>
<span class="sd">    which should be a subclass of `aiida.orm.utils.loaders.OrmEntityLoader` for the corresponding orm class.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="IdentifierParamType.__init__"><a class="viewcode-back" href="../../../../../apidoc/aiida.cmdline.params.types.html#aiida.cmdline.IdentifierParamType.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sub_classes</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Construct the parameter type, optionally specifying a tuple of entry points that reference classes</span>
<span class="sd">        that should be a sub class of the base orm class of the orm class loader. The classes pointed to by</span>
<span class="sd">        these entry points will be passed to the OrmEntityLoader when converting an identifier and they will</span>
<span class="sd">        restrict the query set by demanding that the class of the corresponding entity matches these sub classes.</span>

<span class="sd">        To prevent having to load the database environment at import time, the actual loading of the entry points</span>
<span class="sd">        is deferred until the call to `convert` is made. This is to keep the command line autocompletion light</span>
<span class="sd">        and responsive. The entry point strings will be validated, however, to see if the correspond to known</span>
<span class="sd">        entry points.</span>

<span class="sd">        :param sub_classes: a tuple of entry point strings that can narrow the set of orm classes that values</span>
<span class="sd">            will be mapped upon. These classes have to be strict sub classes of the base orm class defined</span>
<span class="sd">            by the orm class loader</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">aiida.common</span> <span class="kn">import</span> <span class="n">exceptions</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_sub_classes</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_entry_points</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="n">sub_classes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">sub_classes</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;sub_classes should be a tuple of entry point strings&#39;</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">entry_point_string</span> <span class="ow">in</span> <span class="n">sub_classes</span><span class="p">:</span>

                <span class="k">try</span><span class="p">:</span>
                    <span class="n">entry_point</span> <span class="o">=</span> <span class="n">get_entry_point_from_string</span><span class="p">(</span><span class="n">entry_point_string</span><span class="p">)</span>
                <span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="n">exceptions</span><span class="o">.</span><span class="n">EntryPointError</span><span class="p">)</span> <span class="k">as</span> <span class="n">exception</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> is not a valid entry point string: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">entry_point_string</span><span class="p">,</span> <span class="n">exception</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_entry_points</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">entry_point</span><span class="p">)</span></div>

    <span class="nd">@abstractproperty</span>
    <span class="nd">@with_dbenv</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">orm_class_loader</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the orm entity loader class, which should be a subclass of OrmEntityLoader. This class is supposed</span>
<span class="sd">        to be used to load the entity for a given identifier</span>

<span class="sd">        :return: the orm entity loader class for this ParamType</span>
<span class="sd">        &quot;&quot;&quot;</span>

<div class="viewcode-block" id="IdentifierParamType.convert"><a class="viewcode-back" href="../../../../../apidoc/aiida.cmdline.params.types.html#aiida.cmdline.IdentifierParamType.convert">[docs]</a>    <span class="nd">@with_dbenv</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">convert</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">param</span><span class="p">,</span> <span class="n">ctx</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Attempt to convert the given value to an instance of the orm class using the orm class loader.</span>

<span class="sd">        :return: the loaded orm entity</span>
<span class="sd">        :raises click.BadParameter: if the value is ambiguous and leads to multiple entities</span>
<span class="sd">        :raises click.BadParameter: if the value cannot be mapped onto any existing instance</span>
<span class="sd">        :raises RuntimeError: if the defined orm class loader is not a subclass of the OrmEntityLoader class</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">aiida.common</span> <span class="kn">import</span> <span class="n">exceptions</span>
        <span class="kn">from</span> <span class="nn">aiida.orm.utils.loaders</span> <span class="kn">import</span> <span class="n">OrmEntityLoader</span>

        <span class="n">value</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">param</span><span class="p">,</span> <span class="n">ctx</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">value</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">click</span><span class="o">.</span><span class="n">BadParameter</span><span class="p">(</span><span class="s1">&#39;the value for the identifier cannot be empty&#39;</span><span class="p">)</span>

        <span class="n">loader</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">orm_class_loader</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">loader</span><span class="p">,</span> <span class="n">OrmEntityLoader</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;the orm class loader should be a subclass of OrmEntityLoader&#39;</span><span class="p">)</span>

        <span class="c1"># If entry points where in the constructor, we load their corresponding classes, validate that they are valid</span>
        <span class="c1"># sub classes of the orm class loader and then pass it as the sub_class parameter to the load_entity call.</span>
        <span class="c1"># We store the loaded entry points in an instance variable, such that the loading only has to be done once.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_entry_points</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sub_classes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>

            <span class="n">sub_classes</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="k">for</span> <span class="n">entry_point</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_entry_points</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">sub_class</span> <span class="o">=</span> <span class="n">entry_point</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
                <span class="k">except</span> <span class="ne">ImportError</span> <span class="k">as</span> <span class="n">exception</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;failed to load the entry point </span><span class="si">{}</span><span class="s1">: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">entry_point</span><span class="p">,</span> <span class="n">exception</span><span class="p">))</span>

                <span class="k">if</span> <span class="ow">not</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">sub_class</span><span class="p">,</span> <span class="n">loader</span><span class="o">.</span><span class="n">orm_base_class</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                        <span class="s1">&#39;the class </span><span class="si">{}</span><span class="s1"> of entry point </span><span class="si">{}</span><span class="s1"> is not a sub class of </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                            <span class="n">sub_class</span><span class="p">,</span> <span class="n">entry_point</span><span class="p">,</span> <span class="n">loader</span><span class="o">.</span><span class="n">orm_base_class</span>
                        <span class="p">)</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">sub_classes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sub_class</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_sub_classes</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">sub_classes</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">entity</span> <span class="o">=</span> <span class="n">loader</span><span class="o">.</span><span class="n">load_entity</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">sub_classes</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_sub_classes</span><span class="p">)</span>
        <span class="k">except</span> <span class="p">(</span><span class="n">exceptions</span><span class="o">.</span><span class="n">MultipleObjectsError</span><span class="p">,</span> <span class="n">exceptions</span><span class="o">.</span><span class="n">NotExistent</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">)</span> <span class="k">as</span> <span class="n">exception</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">click</span><span class="o">.</span><span class="n">BadParameter</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">exception</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">entity</span></div></div>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, ECOLE POLYTECHNIQUE FEDERALE DE LAUSANNE (Theory and Simulation of Materials (THEOS) and National Centre for Computational Design and Discovery of Novel Materials (NCCR MARVEL)), Switzerland and ROBERT BOSCH LLC, USA. All rights reserved

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>