

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>aiida.cmdline.utils.ascii_vis &mdash; AiiDA 1.2.1 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../../" src="../../../../_static/documentation_options.js"></script>
        <script src="../../../../_static/jquery.js"></script>
        <script src="../../../../_static/underscore.js"></script>
        <script src="../../../../_static/doctools.js"></script>
        <script src="../../../../_static/language_data.js"></script>
        <script src="../../../../_static/togglebutton.js"></script>
        <script src="../../../../_static/contentui.js"></script>
        <script >var togglebuttonSelector = '.toggle';</script>
    
    <script type="text/javascript" src="../../../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/togglebutton.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/contentui.css" type="text/css" />
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../../index.html" class="icon icon-home"> AiiDA
          

          
          </a>

          
            
            
              <div class="version">
                1.2
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../intro/about.html">What is AiiDA</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../intro/get_started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../intro/installation.html">Advanced Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../intro/troubleshooting.html">Troubleshooting</a></li>
</ul>
<p class="caption"><span class="caption-text">Tutorial</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../tutorial/placeholder.html">Placeholder</a></li>
</ul>
<p class="caption"><span class="caption-text">How-To Guides</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../howto/placeholder.html">Placeholder</a></li>
</ul>
<p class="caption"><span class="caption-text">Topics</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../topics/placeholder.html">Placeholder</a></li>
</ul>
<p class="caption"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../reference/placeholder.html">Placeholder</a></li>
</ul>
<p class="caption"><span class="caption-text">Plugins</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../plugins/placeholder.html">Placeholder</a></li>
</ul>
<p class="caption"><span class="caption-text">Development</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../development/placeholder.html">Placeholder</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">AiiDA</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../../index.html">Module code</a> &raquo;</li>
        
          <li><a href="../../../aiida.html">aiida</a> &raquo;</li>
        
      <li>aiida.cmdline.utils.ascii_vis</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for aiida.cmdline.utils.ascii_vis</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="c1">###########################################################################</span>
<span class="c1"># Copyright (c), The AiiDA team. All rights reserved.                     #</span>
<span class="c1"># This file is part of the AiiDA code.                                    #</span>
<span class="c1">#                                                                         #</span>
<span class="c1"># The code is hosted on GitHub at https://github.com/aiidateam/aiida-core #</span>
<span class="c1"># For further information on the license, see the LICENSE.txt file        #</span>
<span class="c1"># For further information please visit http://www.aiida.net               #</span>
<span class="c1">###########################################################################</span>
<span class="sd">&quot;&quot;&quot;Utility functions to draw ASCII diagrams to the command line.&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">aiida.common.links</span> <span class="kn">import</span> <span class="n">LinkType</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;draw_children&#39;</span><span class="p">,</span> <span class="s1">&#39;draw_parents&#39;</span><span class="p">,</span> <span class="s1">&#39;format_call_graph&#39;</span><span class="p">)</span>

<span class="n">TREE_LAST_ENTRY</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\u2514\u2500\u2500</span><span class="s1"> &#39;</span>
<span class="n">TREE_MIDDLE_ENTRY</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\u251C\u2500\u2500</span><span class="s1"> &#39;</span>
<span class="n">TREE_FIRST_ENTRY</span> <span class="o">=</span> <span class="n">TREE_MIDDLE_ENTRY</span>


<span class="k">class</span> <span class="nc">NodeTreePrinter</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Utility functions for printing node trees.</span>

<span class="sd">    .. deprecated:: 1.1.0</span>
<span class="sd">        Will be removed in `v2.0.0`.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Note: when removing this code, also remove the `ete3` as a dependency as it will no longer be used.</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">print_node_tree</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">max_depth</span><span class="p">,</span> <span class="n">follow_links</span><span class="o">=</span><span class="p">()):</span>
        <span class="sd">&quot;&quot;&quot;Top-level function for printing node tree.&quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">warnings</span>
        <span class="kn">from</span> <span class="nn">aiida.common.warnings</span> <span class="kn">import</span> <span class="n">AiidaDeprecationWarning</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;class is deprecated and will be removed in `aiida-core==2.0.0`.&#39;</span><span class="p">,</span> <span class="n">AiidaDeprecationWarning</span><span class="p">)</span>  <span class="c1"># pylint: disable=no-member</span>
        <span class="kn">from</span> <span class="nn">ete3</span> <span class="kn">import</span> <span class="n">Tree</span>
        <span class="kn">from</span> <span class="nn">aiida.cmdline.utils.common</span> <span class="kn">import</span> <span class="n">get_node_summary</span>
        <span class="kn">from</span> <span class="nn">aiida.cmdline.utils</span> <span class="kn">import</span> <span class="n">echo</span>

        <span class="n">echo</span><span class="o">.</span><span class="n">echo</span><span class="p">(</span><span class="n">get_node_summary</span><span class="p">(</span><span class="n">node</span><span class="p">))</span>

        <span class="n">tree_string</span> <span class="o">=</span> <span class="s1">&#39;(</span><span class="si">{}</span><span class="s1">);&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">_build_tree</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">max_depth</span><span class="o">=</span><span class="n">max_depth</span><span class="p">,</span> <span class="n">follow_links</span><span class="o">=</span><span class="n">follow_links</span><span class="p">))</span>
        <span class="n">tmp</span> <span class="o">=</span> <span class="n">Tree</span><span class="p">(</span><span class="n">tree_string</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">echo</span><span class="o">.</span><span class="n">echo</span><span class="p">(</span><span class="n">tmp</span><span class="o">.</span><span class="n">get_ascii</span><span class="p">(</span><span class="n">show_internal</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_ctime</span><span class="p">(</span><span class="n">link_triple</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">link_triple</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">ctime</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_build_tree</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">show_pk</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">max_depth</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">follow_links</span><span class="o">=</span><span class="p">(),</span> <span class="n">depth</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return string with tree.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">max_depth</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">depth</span> <span class="o">&gt;</span> <span class="n">max_depth</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="n">children</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">get_outgoing</span><span class="p">(</span><span class="n">link_type</span><span class="o">=</span><span class="n">follow_links</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="bp">cls</span><span class="o">.</span><span class="n">_ctime</span><span class="p">):</span>
            <span class="n">child_str</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_build_tree</span><span class="p">(</span>
                <span class="n">entry</span><span class="o">.</span><span class="n">node</span><span class="p">,</span> <span class="n">show_pk</span><span class="p">,</span> <span class="n">follow_links</span><span class="o">=</span><span class="n">follow_links</span><span class="p">,</span> <span class="n">max_depth</span><span class="o">=</span><span class="n">max_depth</span><span class="p">,</span> <span class="n">depth</span><span class="o">=</span><span class="n">depth</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">child_str</span><span class="p">:</span>
                <span class="n">children</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">child_str</span><span class="p">)</span>

        <span class="n">out_values</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">children</span><span class="p">:</span>
            <span class="n">out_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;(&#39;</span><span class="p">)</span>
            <span class="n">out_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">children</span><span class="p">))</span>
            <span class="n">out_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;)&#39;</span><span class="p">)</span>

        <span class="n">lab</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span>

        <span class="k">if</span> <span class="n">show_pk</span><span class="p">:</span>
            <span class="n">lab</span> <span class="o">+=</span> <span class="s1">&#39; [</span><span class="si">{}</span><span class="s1">]&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">pk</span><span class="p">)</span>

        <span class="n">out_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lab</span><span class="p">)</span>

        <span class="k">return</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">out_values</span><span class="p">)</span>


<div class="viewcode-block" id="draw_parents"><a class="viewcode-back" href="../../../../apidoc/aiida.cmdline.utils.html#aiida.cmdline.utils.ascii_vis.draw_parents">[docs]</a><span class="k">def</span> <span class="nf">draw_parents</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">node_label</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">show_pk</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">dist</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">follow_links_of_type</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Print an ASCII tree of the parents of the given node.</span>

<span class="sd">    .. deprecated:: 1.1.0</span>
<span class="sd">        Will be removed in `v2.0.0`.</span>

<span class="sd">    :param node: The node to draw for</span>
<span class="sd">    :type node: :class:`aiida.orm.nodes.data.Data`</span>
<span class="sd">    :param node_label: The label to use for the nodes</span>
<span class="sd">    :type node_label: str</span>
<span class="sd">    :param show_pk: Show the PK of nodes alongside the label</span>
<span class="sd">    :type show_pk: bool</span>
<span class="sd">    :param dist: The number of steps away from this node to branch out</span>
<span class="sd">    :type dist: int</span>
<span class="sd">    :param follow_links_of_type: Follow links of this type when making steps,</span>
<span class="sd">        if None then it will follow CREATE and INPUT links</span>
<span class="sd">    :type follow_links_of_type: str</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">warnings</span>
    <span class="kn">from</span> <span class="nn">aiida.common.warnings</span> <span class="kn">import</span> <span class="n">AiidaDeprecationWarning</span>
    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;function is deprecated and will be removed in `aiida-core==2.0.0`.&#39;</span><span class="p">,</span> <span class="n">AiidaDeprecationWarning</span><span class="p">)</span>  <span class="c1"># pylint: disable=no-member</span>
    <span class="k">return</span> <span class="n">get_ascii_tree</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">node_label</span><span class="p">,</span> <span class="n">show_pk</span><span class="p">,</span> <span class="n">dist</span><span class="p">,</span> <span class="n">follow_links_of_type</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span></div>


<div class="viewcode-block" id="draw_children"><a class="viewcode-back" href="../../../../apidoc/aiida.cmdline.utils.html#aiida.cmdline.utils.ascii_vis.draw_children">[docs]</a><span class="k">def</span> <span class="nf">draw_children</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">node_label</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">show_pk</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">dist</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">follow_links_of_type</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Print an ASCII tree of the parents of the given node.</span>

<span class="sd">    .. deprecated:: 1.1.0</span>
<span class="sd">        Will be removed in `v2.0.0`.</span>

<span class="sd">    :param node: The node to draw for</span>
<span class="sd">    :type node: :class:`aiida.orm.nodes.data.Data`</span>
<span class="sd">    :param node_label: The label to use for the nodes</span>
<span class="sd">    :type node_label: str</span>
<span class="sd">    :param show_pk: Show the PK of nodes alongside the label</span>
<span class="sd">    :type show_pk: bool</span>
<span class="sd">    :param dist: The number of steps away from this node to branch out</span>
<span class="sd">    :type dist: int</span>
<span class="sd">    :param follow_links_of_type: Follow links of this type when making steps,</span>
<span class="sd">        if None then it will follow CREATE and INPUT links</span>
<span class="sd">    :type follow_links_of_type: str</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">warnings</span>
    <span class="kn">from</span> <span class="nn">aiida.common.warnings</span> <span class="kn">import</span> <span class="n">AiidaDeprecationWarning</span>
    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;function is deprecated and will be removed in `aiida-core==2.0.0`.&#39;</span><span class="p">,</span> <span class="n">AiidaDeprecationWarning</span><span class="p">)</span>  <span class="c1"># pylint: disable=no-member</span>
    <span class="k">return</span> <span class="n">get_ascii_tree</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">node_label</span><span class="p">,</span> <span class="n">show_pk</span><span class="p">,</span> <span class="n">dist</span><span class="p">,</span> <span class="n">follow_links_of_type</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span></div>


<span class="k">def</span> <span class="nf">get_ascii_tree</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">node_label</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">show_pk</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">max_depth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">follow_links_of_type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">descend</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get a string representing an ASCII tree for the given node.</span>

<span class="sd">    .. deprecated:: 1.1.0</span>
<span class="sd">        Will be removed in `v2.0.0`.</span>

<span class="sd">    :param node: The node to get the tree for</span>
<span class="sd">    :type node: :class:`aiida.orm.nodes.node.Node`</span>
<span class="sd">    :param node_label: What to label the nodes with (can be an attribute name)</span>
<span class="sd">    :type node_label: str</span>
<span class="sd">    :param show_pk: If True, show the pk with the node label</span>
<span class="sd">    :type show_pk: bool</span>
<span class="sd">    :param max_depth: The maximum depth to follow starting from the node</span>
<span class="sd">    :type max_depth: int</span>
<span class="sd">    :param follow_links_of_type: Follow links of a given type, can be None</span>
<span class="sd">    :type follow_links_of_type: One of the members from</span>
<span class="sd">        :class:`aiida.common.links.LinkType`</span>
<span class="sd">    :param descend: if True will follow outputs, if False inputs</span>
<span class="sd">    :type descend: bool</span>
<span class="sd">    :return: The string giving an ASCII representation of the tree from the node</span>
<span class="sd">    :rtype: str</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">warnings</span>
    <span class="kn">from</span> <span class="nn">aiida.common.warnings</span> <span class="kn">import</span> <span class="n">AiidaDeprecationWarning</span>
    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;function is deprecated and will be removed in `aiida-core==2.0.0`.&#39;</span><span class="p">,</span> <span class="n">AiidaDeprecationWarning</span><span class="p">)</span>  <span class="c1"># pylint: disable=no-member</span>
    <span class="kn">from</span> <span class="nn">ete3</span> <span class="kn">import</span> <span class="n">Tree</span>
    <span class="n">tree_string</span> <span class="o">=</span> <span class="n">build_tree</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">node_label</span><span class="p">,</span> <span class="n">show_pk</span><span class="p">,</span> <span class="n">max_depth</span><span class="p">,</span> <span class="n">follow_links_of_type</span><span class="p">,</span> <span class="n">descend</span><span class="p">)</span>
    <span class="n">tree</span> <span class="o">=</span> <span class="n">Tree</span><span class="p">(</span><span class="s1">&#39;(</span><span class="si">{}</span><span class="s1">);&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tree_string</span><span class="p">),</span> <span class="nb">format</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">tree</span><span class="o">.</span><span class="n">get_ascii</span><span class="p">(</span><span class="n">show_internal</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">build_tree</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">node_label</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">show_pk</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">max_depth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">follow_links_of_type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">descend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">depth</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Recursively build an ASCII string representation of the node tree</span>

<span class="sd">    .. deprecated:: 1.1.0</span>
<span class="sd">        Will be removed in `v2.0.0`.</span>

<span class="sd">    :param node: The node to get the tree for</span>
<span class="sd">    :type node: :class:`aiida.orm.nodes.node.Node`</span>
<span class="sd">    :param node_label: What to label the nodes with (can be an attribute name)</span>
<span class="sd">    :type node_label: str</span>
<span class="sd">    :param show_pk: If True, show the pk with the node label</span>
<span class="sd">    :type show_pk: bool</span>
<span class="sd">    :param max_depth: The maximum depth to follow starting from the node</span>
<span class="sd">    :type max_depth: int</span>
<span class="sd">    :param follow_links_of_type: Follow links of a given type, can be None</span>
<span class="sd">    :type follow_links_of_type: One of the members from</span>
<span class="sd">        :class:`aiida.common.links.LinkType`</span>
<span class="sd">    :param descend: if True will follow outputs, if False inputs</span>
<span class="sd">    :type descend: bool</span>
<span class="sd">    :param depth: the current depth</span>
<span class="sd">    :type depth: int</span>
<span class="sd">    :return: The string giving an ASCII representation of the tree from the node</span>
<span class="sd">    :rtype: str</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># pylint: disable=too-many-arguments</span>
    <span class="kn">import</span> <span class="nn">warnings</span>
    <span class="kn">from</span> <span class="nn">aiida.common.warnings</span> <span class="kn">import</span> <span class="n">AiidaDeprecationWarning</span>
    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;function is deprecated and will be removed in `aiida-core==2.0.0`.&#39;</span><span class="p">,</span> <span class="n">AiidaDeprecationWarning</span><span class="p">)</span>  <span class="c1"># pylint: disable=no-member</span>
    <span class="n">out_values</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">if</span> <span class="n">depth</span> <span class="o">&lt;</span> <span class="n">max_depth</span><span class="p">:</span>
        <span class="n">relatives</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="n">descend</span><span class="p">:</span>
            <span class="n">outputs</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">get_outgoing</span><span class="p">(</span><span class="n">link_type</span><span class="o">=</span><span class="n">follow_links_of_type</span><span class="p">)</span><span class="o">.</span><span class="n">all_nodes</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># ascend</span>
            <span class="k">if</span> <span class="n">follow_links_of_type</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">follow_links_of_type</span> <span class="o">=</span> <span class="p">(</span><span class="n">LinkType</span><span class="o">.</span><span class="n">CREATE</span><span class="p">,</span> <span class="n">LinkType</span><span class="o">.</span><span class="n">INPUT_CALC</span><span class="p">,</span> <span class="n">LinkType</span><span class="o">.</span><span class="n">INPUT_WORK</span><span class="p">)</span>

            <span class="n">outputs</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">get_incoming</span><span class="p">(</span><span class="n">link_type</span><span class="o">=</span><span class="n">follow_links_of_type</span><span class="p">)</span><span class="o">.</span><span class="n">all_nodes</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">outputs</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">node</span><span class="p">:</span> <span class="n">node</span><span class="o">.</span><span class="n">ctime</span><span class="p">):</span>
            <span class="n">relatives</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="n">build_tree</span><span class="p">(</span><span class="n">child</span><span class="p">,</span> <span class="n">node_label</span><span class="p">,</span> <span class="n">show_pk</span><span class="p">,</span> <span class="n">max_depth</span><span class="p">,</span> <span class="n">follow_links_of_type</span><span class="p">,</span> <span class="n">descend</span><span class="p">,</span> <span class="n">depth</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">relatives</span><span class="p">:</span>
            <span class="n">out_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;(</span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">relatives</span><span class="p">)))</span>

    <span class="n">out_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_generate_node_label</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">node_label</span><span class="p">,</span> <span class="n">show_pk</span><span class="p">))</span>

    <span class="k">return</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">out_values</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_generate_node_label</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">node_attr</span><span class="p">,</span> <span class="n">show_pk</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generate a label for the node.</span>

<span class="sd">    .. deprecated:: 1.1.0</span>
<span class="sd">        Will be removed in `v2.0.0`.</span>

<span class="sd">    :param node: The node to generate the label for</span>
<span class="sd">    :type node: :class:`aiida.orm.nodes.node.Node`</span>
<span class="sd">    :param node_attr: The attribute to use as the label, can be None</span>
<span class="sd">    :type node_attr: str</span>
<span class="sd">    :param show_pk: if True, show the PK alongside the label</span>
<span class="sd">    :type show_pk: bool</span>
<span class="sd">    :return: The generated label</span>
<span class="sd">    :rtype: str</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">warnings</span>
    <span class="kn">from</span> <span class="nn">aiida.common.warnings</span> <span class="kn">import</span> <span class="n">AiidaDeprecationWarning</span>
    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;function is deprecated and will be removed in `aiida-core==2.0.0`.&#39;</span><span class="p">,</span> <span class="n">AiidaDeprecationWarning</span><span class="p">)</span>  <span class="c1"># pylint: disable=no-member</span>
    <span class="n">label</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">node_attr</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">label</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">process_label</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="n">label</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">label</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">node_attr</span><span class="p">))</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">label</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="n">node_attr</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="k">pass</span>

    <span class="c1"># Couldn&#39;t find one, so just use the class name</span>
    <span class="k">if</span> <span class="n">label</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">label</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span>

    <span class="k">if</span> <span class="n">show_pk</span><span class="p">:</span>
        <span class="n">label</span> <span class="o">+=</span> <span class="s1">&#39; [</span><span class="si">{}</span><span class="s1">]&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">pk</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">label</span>


<span class="k">def</span> <span class="nf">calc_info</span><span class="p">(</span><span class="n">node</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return a string with the summary of the state of a CalculationNode.&quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">aiida.orm</span> <span class="kn">import</span> <span class="n">ProcessNode</span><span class="p">,</span> <span class="n">WorkChainNode</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">ProcessNode</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;Unknown type: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">node</span><span class="p">)))</span>

    <span class="n">process_label</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">process_label</span>
    <span class="n">process_state</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">process_state</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span>
    <span class="n">exit_status</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">exit_status</span>

    <span class="k">if</span> <span class="n">exit_status</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">string</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">&lt;</span><span class="si">{}</span><span class="s1">&gt; </span><span class="si">{}</span><span class="s1"> [</span><span class="si">{}</span><span class="s1">]&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">process_label</span><span class="p">,</span> <span class="n">node</span><span class="o">.</span><span class="n">pk</span><span class="p">,</span> <span class="n">process_state</span><span class="p">,</span> <span class="n">exit_status</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">string</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">&lt;</span><span class="si">{}</span><span class="s1">&gt; </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">process_label</span><span class="p">,</span> <span class="n">node</span><span class="o">.</span><span class="n">pk</span><span class="p">,</span> <span class="n">process_state</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">WorkChainNode</span><span class="p">)</span> <span class="ow">and</span> <span class="n">node</span><span class="o">.</span><span class="n">stepper_state_info</span><span class="p">:</span>
        <span class="n">string</span> <span class="o">+=</span> <span class="s1">&#39; [</span><span class="si">{}</span><span class="s1">]&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">stepper_state_info</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">string</span>


<div class="viewcode-block" id="format_call_graph"><a class="viewcode-back" href="../../../../apidoc/aiida.cmdline.utils.html#aiida.cmdline.utils.ascii_vis.format_call_graph">[docs]</a><span class="k">def</span> <span class="nf">format_call_graph</span><span class="p">(</span><span class="n">calc_node</span><span class="p">,</span> <span class="n">info_fn</span><span class="o">=</span><span class="n">calc_info</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Print a tree like the POSIX tree command for the calculation call graph</span>

<span class="sd">    :param calc_node: The calculation node</span>
<span class="sd">    :param info_fn: An optional function that takes the node and returns a string</span>
<span class="sd">        of information to be displayed for each node.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">call_tree</span> <span class="o">=</span> <span class="n">build_call_graph</span><span class="p">(</span><span class="n">calc_node</span><span class="p">,</span> <span class="n">info_fn</span><span class="o">=</span><span class="n">info_fn</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">format_tree_descending</span><span class="p">(</span><span class="n">call_tree</span><span class="p">)</span></div>


<span class="k">def</span> <span class="nf">build_call_graph</span><span class="p">(</span><span class="n">calc_node</span><span class="p">,</span> <span class="n">info_fn</span><span class="o">=</span><span class="n">calc_info</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Build the call graph of a given node.&quot;&quot;&quot;</span>
    <span class="n">info_string</span> <span class="o">=</span> <span class="n">info_fn</span><span class="p">(</span><span class="n">calc_node</span><span class="p">)</span>
    <span class="n">called</span> <span class="o">=</span> <span class="n">calc_node</span><span class="o">.</span><span class="n">called</span>
    <span class="n">called</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">ctime</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">called</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">info_string</span><span class="p">,</span> <span class="p">[</span><span class="n">build_call_graph</span><span class="p">(</span><span class="n">child</span><span class="p">,</span> <span class="n">info_fn</span><span class="p">)</span> <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">called</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">info_string</span>


<span class="k">def</span> <span class="nf">format_tree_descending</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">pos</span><span class="o">=-</span><span class="mi">1</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Format a descending tree.&quot;&quot;&quot;</span>
    <span class="c1"># pylint: disable=too-many-branches</span>
    <span class="n">text</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
        <span class="n">info</span> <span class="o">=</span> <span class="n">tree</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">info</span> <span class="o">=</span> <span class="n">tree</span>

    <span class="k">if</span> <span class="n">pos</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
        <span class="n">pre</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="k">elif</span> <span class="n">pos</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">pre</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="n">TREE_FIRST_ENTRY</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">pos</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">pre</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="n">TREE_MIDDLE_ENTRY</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">pre</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="n">TREE_LAST_ENTRY</span><span class="p">)</span>
    <span class="n">text</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pre</span><span class="p">,</span> <span class="n">info</span><span class="p">))</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="n">tree</span>
        <span class="n">num_entries</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">pos</span> <span class="ow">in</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]:</span>
            <span class="n">new_prefix</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">    &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">prefix</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">new_prefix</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="se">\u2502</span><span class="s1">   &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">prefix</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">entry</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="n">num_entries</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">pos</span> <span class="o">=</span> <span class="mi">2</span>
            <span class="k">elif</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">pos</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">pos</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">text</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">format_tree_descending</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">new_prefix</span><span class="p">,</span> <span class="n">pos</span><span class="p">))</span>

    <span class="k">return</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, ECOLE POLYTECHNIQUE FEDERALE DE LAUSANNE (Theory and Simulation of Materials (THEOS) and National Centre for Computational Design and Discovery of Novel Materials (NCCR MARVEL)), Switzerland and ROBERT BOSCH LLC, USA. All rights reserved

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>