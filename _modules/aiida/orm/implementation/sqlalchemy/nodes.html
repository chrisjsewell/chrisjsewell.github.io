

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>aiida.orm.implementation.sqlalchemy.nodes &mdash; AiiDA 1.2.1 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../../../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../../../" src="../../../../../_static/documentation_options.js"></script>
        <script src="../../../../../_static/jquery.js"></script>
        <script src="../../../../../_static/underscore.js"></script>
        <script src="../../../../../_static/doctools.js"></script>
        <script src="../../../../../_static/language_data.js"></script>
        <script src="../../../../../_static/togglebutton.js"></script>
        <script src="../../../../../_static/contentui.js"></script>
        <script >var togglebuttonSelector = '.toggle';</script>
    
    <script type="text/javascript" src="../../../../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../../../_static/togglebutton.css" type="text/css" />
  <link rel="stylesheet" href="../../../../../_static/contentui.css" type="text/css" />
    <link rel="index" title="Index" href="../../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../../../index.html" class="icon icon-home"> AiiDA
          

          
          </a>

          
            
            
              <div class="version">
                1.2
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../intro/about.html">What is AiiDA</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../intro/get_started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../intro/installation.html">Advanced Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../intro/troubleshooting.html">Troubleshooting</a></li>
</ul>
<p class="caption"><span class="caption-text">Tutorial</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../tutorial/placeholder.html">Placeholder</a></li>
</ul>
<p class="caption"><span class="caption-text">How-To Guides</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../howto/placeholder.html">Placeholder</a></li>
</ul>
<p class="caption"><span class="caption-text">Topics</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../topics/placeholder.html">Placeholder</a></li>
</ul>
<p class="caption"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../reference/placeholder.html">Placeholder</a></li>
</ul>
<p class="caption"><span class="caption-text">Plugins</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../plugins/placeholder.html">Placeholder</a></li>
</ul>
<p class="caption"><span class="caption-text">Development</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../development/placeholder.html">Placeholder</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../../index.html">AiiDA</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../../../index.html">Module code</a> &raquo;</li>
        
          <li><a href="../../../../aiida.html">aiida</a> &raquo;</li>
        
      <li>aiida.orm.implementation.sqlalchemy.nodes</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for aiida.orm.implementation.sqlalchemy.nodes</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="c1">###########################################################################</span>
<span class="c1"># Copyright (c), The AiiDA team. All rights reserved.                     #</span>
<span class="c1"># This file is part of the AiiDA code.                                    #</span>
<span class="c1">#                                                                         #</span>
<span class="c1"># The code is hosted on GitHub at https://github.com/aiidateam/aiida-core #</span>
<span class="c1"># For further information on the license, see the LICENSE.txt file        #</span>
<span class="c1"># For further information please visit http://www.aiida.net               #</span>
<span class="c1">###########################################################################</span>
<span class="sd">&quot;&quot;&quot;SqlAlchemy implementation of the `BackendNode` and `BackendNodeCollection` classes.&quot;&quot;&quot;</span>

<span class="c1"># pylint: disable=no-name-in-module,import-error</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.orm.exc</span> <span class="kn">import</span> <span class="n">NoResultFound</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.exc</span> <span class="kn">import</span> <span class="n">SQLAlchemyError</span>

<span class="kn">from</span> <span class="nn">aiida.backends.sqlalchemy</span> <span class="kn">import</span> <span class="n">get_scoped_session</span>
<span class="kn">from</span> <span class="nn">aiida.backends.sqlalchemy.models</span> <span class="kn">import</span> <span class="n">node</span> <span class="k">as</span> <span class="n">models</span>
<span class="kn">from</span> <span class="nn">aiida.common</span> <span class="kn">import</span> <span class="n">exceptions</span>
<span class="kn">from</span> <span class="nn">aiida.common.lang</span> <span class="kn">import</span> <span class="n">type_check</span>
<span class="kn">from</span> <span class="nn">aiida.orm.utils.node</span> <span class="kn">import</span> <span class="n">clean_value</span>

<span class="kn">from</span> <span class="nn">..</span> <span class="kn">import</span> <span class="n">BackendNode</span><span class="p">,</span> <span class="n">BackendNodeCollection</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">entities</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">utils</span> <span class="k">as</span> <span class="n">sqla_utils</span>
<span class="kn">from</span> <span class="nn">.computers</span> <span class="kn">import</span> <span class="n">SqlaComputer</span>
<span class="kn">from</span> <span class="nn">.users</span> <span class="kn">import</span> <span class="n">SqlaUser</span>


<div class="viewcode-block" id="SqlaNode"><a class="viewcode-back" href="../../../../../apidoc/aiida.orm.implementation.sqlalchemy.html#aiida.orm.implementation.sqlalchemy.nodes.SqlaNode">[docs]</a><span class="k">class</span> <span class="nc">SqlaNode</span><span class="p">(</span><span class="n">entities</span><span class="o">.</span><span class="n">SqlaModelEntity</span><span class="p">[</span><span class="n">models</span><span class="o">.</span><span class="n">DbNode</span><span class="p">],</span> <span class="n">BackendNode</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;SQLA Node backend entity&quot;&quot;&quot;</span>

    <span class="c1"># pylint: disable=too-many-public-methods</span>

    <span class="n">MODEL_CLASS</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DbNode</span>

<div class="viewcode-block" id="SqlaNode.__init__"><a class="viewcode-back" href="../../../../../apidoc/aiida.orm.implementation.sqlalchemy.html#aiida.orm.implementation.sqlalchemy.nodes.SqlaNode.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">backend</span><span class="p">,</span>
        <span class="n">node_type</span><span class="p">,</span>
        <span class="n">user</span><span class="p">,</span>
        <span class="n">computer</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">process_type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">label</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
        <span class="n">ctime</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">mtime</span><span class="o">=</span><span class="kc">None</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Construct a new `BackendNode` instance wrapping a new `DbNode` instance.</span>

<span class="sd">        :param backend: the backend</span>
<span class="sd">        :param node_type: the node type string</span>
<span class="sd">        :param user: associated `BackendUser`</span>
<span class="sd">        :param computer: associated `BackendComputer`</span>
<span class="sd">        :param label: string label</span>
<span class="sd">        :param description: string description</span>
<span class="sd">        :param ctime: The creation time as datetime object</span>
<span class="sd">        :param mtime: The modification time as datetime object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># pylint: disable=too-many-arguments</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">backend</span><span class="p">)</span>

        <span class="n">arguments</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;node_type&#39;</span><span class="p">:</span> <span class="n">node_type</span><span class="p">,</span>
            <span class="s1">&#39;process_type&#39;</span><span class="p">:</span> <span class="n">process_type</span><span class="p">,</span>
            <span class="s1">&#39;user&#39;</span><span class="p">:</span> <span class="n">user</span><span class="o">.</span><span class="n">dbmodel</span><span class="p">,</span>
            <span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="n">label</span><span class="p">,</span>
            <span class="s1">&#39;description&#39;</span><span class="p">:</span> <span class="n">description</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="n">type_check</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="n">SqlaUser</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">computer</span><span class="p">:</span>
            <span class="n">type_check</span><span class="p">(</span><span class="n">computer</span><span class="p">,</span> <span class="n">SqlaComputer</span><span class="p">,</span> <span class="s1">&#39;computer is of type </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">computer</span><span class="p">)))</span>
            <span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;dbcomputer&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">computer</span><span class="o">.</span><span class="n">dbmodel</span>

        <span class="k">if</span> <span class="n">ctime</span><span class="p">:</span>
            <span class="n">type_check</span><span class="p">(</span><span class="n">ctime</span><span class="p">,</span> <span class="n">datetime</span><span class="p">,</span> <span class="s1">&#39;the given ctime is of type </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">ctime</span><span class="p">)))</span>
            <span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;ctime&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ctime</span>

        <span class="k">if</span> <span class="n">mtime</span><span class="p">:</span>
            <span class="n">type_check</span><span class="p">(</span><span class="n">mtime</span><span class="p">,</span> <span class="n">datetime</span><span class="p">,</span> <span class="s1">&#39;the given mtime is of type </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">mtime</span><span class="p">)))</span>
            <span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;mtime&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mtime</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_dbmodel</span> <span class="o">=</span> <span class="n">sqla_utils</span><span class="o">.</span><span class="n">ModelWrapper</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">DbNode</span><span class="p">(</span><span class="o">**</span><span class="n">arguments</span><span class="p">))</span></div>

<div class="viewcode-block" id="SqlaNode.clone"><a class="viewcode-back" href="../../../../../apidoc/aiida.orm.implementation.sqlalchemy.html#aiida.orm.implementation.sqlalchemy.nodes.SqlaNode.clone">[docs]</a>    <span class="k">def</span> <span class="nf">clone</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return an unstored clone of ourselves.</span>

<span class="sd">        :return: an unstored `BackendNode` with the exact same attributes and extras as self</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">arguments</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;node_type&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dbmodel</span><span class="o">.</span><span class="n">node_type</span><span class="p">,</span>
            <span class="s1">&#39;process_type&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dbmodel</span><span class="o">.</span><span class="n">process_type</span><span class="p">,</span>
            <span class="s1">&#39;user&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dbmodel</span><span class="o">.</span><span class="n">user</span><span class="p">,</span>
            <span class="s1">&#39;dbcomputer&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dbmodel</span><span class="o">.</span><span class="n">dbcomputer</span><span class="p">,</span>
            <span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dbmodel</span><span class="o">.</span><span class="n">label</span><span class="p">,</span>
            <span class="s1">&#39;description&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dbmodel</span><span class="o">.</span><span class="n">description</span><span class="p">,</span>
            <span class="s1">&#39;attributes&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dbmodel</span><span class="o">.</span><span class="n">attributes</span><span class="p">,</span>
            <span class="s1">&#39;extras&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dbmodel</span><span class="o">.</span><span class="n">extras</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="n">clone</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">)</span>  <span class="c1"># pylint: disable=no-value-for-parameter</span>
        <span class="n">clone</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">backend</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_type</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">user</span><span class="p">)</span>
        <span class="n">clone</span><span class="o">.</span><span class="n">_dbmodel</span> <span class="o">=</span> <span class="n">sqla_utils</span><span class="o">.</span><span class="n">ModelWrapper</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">DbNode</span><span class="p">(</span><span class="o">**</span><span class="n">arguments</span><span class="p">))</span>  <span class="c1"># pylint: disable=protected-access</span>
        <span class="k">return</span> <span class="n">clone</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">computer</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the computer of this node.</span>

<span class="sd">        :return: the computer or None</span>
<span class="sd">        :rtype: `BackendComputer` or None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">backend</span><span class="o">.</span><span class="n">computers</span><span class="o">.</span><span class="n">from_dbmodel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dbmodel</span><span class="o">.</span><span class="n">dbcomputer</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

    <span class="nd">@computer</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">computer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">computer</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set the computer of this node.</span>

<span class="sd">        :param computer: a `BackendComputer`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">type_check</span><span class="p">(</span><span class="n">computer</span><span class="p">,</span> <span class="n">SqlaComputer</span><span class="p">,</span> <span class="n">allow_none</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">computer</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">computer</span> <span class="o">=</span> <span class="n">computer</span><span class="o">.</span><span class="n">dbmodel</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_dbmodel</span><span class="o">.</span><span class="n">dbcomputer</span> <span class="o">=</span> <span class="n">computer</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">user</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the user of this node.</span>

<span class="sd">        :return: the user</span>
<span class="sd">        :rtype: `BackendUser`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">backend</span><span class="o">.</span><span class="n">users</span><span class="o">.</span><span class="n">from_dbmodel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dbmodel</span><span class="o">.</span><span class="n">user</span><span class="p">)</span>

    <span class="nd">@user</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">user</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set the user of this node.</span>

<span class="sd">        :param user: a `BackendUser`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">type_check</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="n">SqlaUser</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dbmodel</span><span class="o">.</span><span class="n">user</span> <span class="o">=</span> <span class="n">user</span><span class="o">.</span><span class="n">dbmodel</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">attributes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the complete attributes dictionary.</span>

<span class="sd">        .. warning:: While the node is unstored, this will return references of the attributes on the database model,</span>
<span class="sd">            meaning that changes on the returned values (if they are mutable themselves, e.g. a list or dictionary) will</span>
<span class="sd">            automatically be reflected on the database model as well. As soon as the node is stored, the returned</span>
<span class="sd">            attributes will be a deep copy and mutations of the database attributes will have to go through the</span>
<span class="sd">            appropriate set methods. Therefore, once stored, retrieving a deep copy can be a heavy operation. If you</span>
<span class="sd">            only need the keys or some values, use the iterators `attributes_keys` and `attributes_items`, or the</span>
<span class="sd">            getters `get_attribute` and `get_attribute_many` instead.</span>

<span class="sd">        :return: the attributes as a dictionary</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dbmodel</span><span class="o">.</span><span class="n">attributes</span>

<div class="viewcode-block" id="SqlaNode.get_attribute"><a class="viewcode-back" href="../../../../../apidoc/aiida.orm.implementation.sqlalchemy.html#aiida.orm.implementation.sqlalchemy.nodes.SqlaNode.get_attribute">[docs]</a>    <span class="k">def</span> <span class="nf">get_attribute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the value of an attribute.</span>

<span class="sd">        .. warning:: While the node is unstored, this will return a reference of the attribute on the database model,</span>
<span class="sd">            meaning that changes on the returned value (if they are mutable themselves, e.g. a list or dictionary) will</span>
<span class="sd">            automatically be reflected on the database model as well. As soon as the node is stored, the returned</span>
<span class="sd">            attribute will be a deep copy and mutations of the database attributes will have to go through the</span>
<span class="sd">            appropriate set methods.</span>

<span class="sd">        :param key: name of the attribute</span>
<span class="sd">        :return: the value of the attribute</span>
<span class="sd">        :raises AttributeError: if the attribute does not exist</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dbmodel</span><span class="o">.</span><span class="n">attributes</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span> <span class="k">as</span> <span class="n">exception</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s1">&#39;attribute `</span><span class="si">{}</span><span class="s1">` does not exist&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">exception</span><span class="p">))</span></div>

<div class="viewcode-block" id="SqlaNode.get_attribute_many"><a class="viewcode-back" href="../../../../../apidoc/aiida.orm.implementation.sqlalchemy.html#aiida.orm.implementation.sqlalchemy.nodes.SqlaNode.get_attribute_many">[docs]</a>    <span class="k">def</span> <span class="nf">get_attribute_many</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">keys</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the values of multiple attributes.</span>

<span class="sd">        .. warning:: While the node is unstored, this will return references of the attributes on the database model,</span>
<span class="sd">            meaning that changes on the returned values (if they are mutable themselves, e.g. a list or dictionary) will</span>
<span class="sd">            automatically be reflected on the database model as well. As soon as the node is stored, the returned</span>
<span class="sd">            attributes will be a deep copy and mutations of the database attributes will have to go through the</span>
<span class="sd">            appropriate set methods. Therefore, once stored, retrieving a deep copy can be a heavy operation. If you</span>
<span class="sd">            only need the keys or some values, use the iterators `attributes_keys` and `attributes_items`, or the</span>
<span class="sd">            getters `get_attribute` and `get_attribute_many` instead.</span>

<span class="sd">        :param keys: a list of attribute names</span>
<span class="sd">        :return: a list of attribute values</span>
<span class="sd">        :raises AttributeError: if at least one attribute does not exist</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span> <span class="k">as</span> <span class="n">exception</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s1">&#39;attribute `</span><span class="si">{}</span><span class="s1">` does not exist&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">exception</span><span class="p">))</span></div>

<div class="viewcode-block" id="SqlaNode.set_attribute"><a class="viewcode-back" href="../../../../../apidoc/aiida.orm.implementation.sqlalchemy.html#aiida.orm.implementation.sqlalchemy.nodes.SqlaNode.set_attribute">[docs]</a>    <span class="k">def</span> <span class="nf">set_attribute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set an attribute to the given value.</span>

<span class="sd">        :param key: name of the attribute</span>
<span class="sd">        :param value: value of the attribute</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_stored</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">clean_value</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_dbmodel</span><span class="o">.</span><span class="n">attributes</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_flag_field</span><span class="p">(</span><span class="s1">&#39;attributes&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_flush_if_stored</span><span class="p">()</span></div>

<div class="viewcode-block" id="SqlaNode.set_attribute_many"><a class="viewcode-back" href="../../../../../apidoc/aiida.orm.implementation.sqlalchemy.html#aiida.orm.implementation.sqlalchemy.nodes.SqlaNode.set_attribute_many">[docs]</a>    <span class="k">def</span> <span class="nf">set_attribute_many</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attributes</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set multiple attributes.</span>

<span class="sd">        .. note:: This will override any existing attributes that are present in the new dictionary.</span>

<span class="sd">        :param attributes: a dictionary with the attributes to set</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_stored</span><span class="p">:</span>
            <span class="n">attributes</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="p">:</span> <span class="n">clean_value</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">attributes</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>

        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">attributes</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dbmodel</span><span class="o">.</span><span class="n">attributes</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_flag_field</span><span class="p">(</span><span class="s1">&#39;attributes&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_flush_if_stored</span><span class="p">()</span></div>

<div class="viewcode-block" id="SqlaNode.reset_attributes"><a class="viewcode-back" href="../../../../../apidoc/aiida.orm.implementation.sqlalchemy.html#aiida.orm.implementation.sqlalchemy.nodes.SqlaNode.reset_attributes">[docs]</a>    <span class="k">def</span> <span class="nf">reset_attributes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attributes</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Reset the attributes.</span>

<span class="sd">        .. note:: This will completely clear any existing attributes and replace them with the new dictionary.</span>

<span class="sd">        :param attributes: a dictionary with the attributes to set</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_stored</span><span class="p">:</span>
            <span class="n">attributes</span> <span class="o">=</span> <span class="n">clean_value</span><span class="p">(</span><span class="n">attributes</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">dbmodel</span><span class="o">.</span><span class="n">attributes</span> <span class="o">=</span> <span class="n">attributes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_flag_field</span><span class="p">(</span><span class="s1">&#39;attributes&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_flush_if_stored</span><span class="p">()</span></div>

<div class="viewcode-block" id="SqlaNode.delete_attribute"><a class="viewcode-back" href="../../../../../apidoc/aiida.orm.implementation.sqlalchemy.html#aiida.orm.implementation.sqlalchemy.nodes.SqlaNode.delete_attribute">[docs]</a>    <span class="k">def</span> <span class="nf">delete_attribute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Delete an attribute.</span>

<span class="sd">        :param key: name of the attribute</span>
<span class="sd">        :raises AttributeError: if the attribute does not exist</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_dbmodel</span><span class="o">.</span><span class="n">attributes</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">KeyError</span> <span class="k">as</span> <span class="n">exception</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s1">&#39;attribute `</span><span class="si">{}</span><span class="s1">` does not exist&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">exception</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_flag_field</span><span class="p">(</span><span class="s1">&#39;attributes&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_flush_if_stored</span><span class="p">()</span></div>

<div class="viewcode-block" id="SqlaNode.delete_attribute_many"><a class="viewcode-back" href="../../../../../apidoc/aiida.orm.implementation.sqlalchemy.html#aiida.orm.implementation.sqlalchemy.nodes.SqlaNode.delete_attribute_many">[docs]</a>    <span class="k">def</span> <span class="nf">delete_attribute_many</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">keys</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Delete multiple attributes.</span>

<span class="sd">        :param keys: names of the attributes to delete</span>
<span class="sd">        :raises AttributeError: if at least one of the attribute does not exist</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">non_existing_keys</span> <span class="o">=</span> <span class="p">[</span><span class="n">key</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">keys</span> <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dbmodel</span><span class="o">.</span><span class="n">attributes</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">non_existing_keys</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s1">&#39;attributes `</span><span class="si">{}</span><span class="s1">` do not exist&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">non_existing_keys</span><span class="p">)))</span>

        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dbmodel</span><span class="o">.</span><span class="n">attributes</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_flag_field</span><span class="p">(</span><span class="s1">&#39;attributes&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_flush_if_stored</span><span class="p">()</span></div>

<div class="viewcode-block" id="SqlaNode.clear_attributes"><a class="viewcode-back" href="../../../../../apidoc/aiida.orm.implementation.sqlalchemy.html#aiida.orm.implementation.sqlalchemy.nodes.SqlaNode.clear_attributes">[docs]</a>    <span class="k">def</span> <span class="nf">clear_attributes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Delete all attributes.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dbmodel</span><span class="o">.</span><span class="n">attributes</span> <span class="o">=</span> <span class="p">{}</span></div>

<div class="viewcode-block" id="SqlaNode.attributes_items"><a class="viewcode-back" href="../../../../../apidoc/aiida.orm.implementation.sqlalchemy.html#aiida.orm.implementation.sqlalchemy.nodes.SqlaNode.attributes_items">[docs]</a>    <span class="k">def</span> <span class="nf">attributes_items</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return an iterator over the attributes.</span>

<span class="sd">        :return: an iterator with attribute key value pairs</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dbmodel</span><span class="o">.</span><span class="n">attributes</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">yield</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span></div>

<div class="viewcode-block" id="SqlaNode.attributes_keys"><a class="viewcode-back" href="../../../../../apidoc/aiida.orm.implementation.sqlalchemy.html#aiida.orm.implementation.sqlalchemy.nodes.SqlaNode.attributes_keys">[docs]</a>    <span class="k">def</span> <span class="nf">attributes_keys</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return an iterator over the attribute keys.</span>

<span class="sd">        :return: an iterator with attribute keys</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dbmodel</span><span class="o">.</span><span class="n">attributes</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">yield</span> <span class="n">key</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">extras</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the complete extras dictionary.</span>

<span class="sd">        .. warning:: While the node is unstored, this will return references of the extras on the database model,</span>
<span class="sd">            meaning that changes on the returned values (if they are mutable themselves, e.g. a list or dictionary) will</span>
<span class="sd">            automatically be reflected on the database model as well. As soon as the node is stored, the returned extras</span>
<span class="sd">            will be a deep copy and mutations of the database extras will have to go through the appropriate set</span>
<span class="sd">            methods. Therefore, once stored, retrieving a deep copy can be a heavy operation. If you only need the keys</span>
<span class="sd">            or some values, use the iterators `extras_keys` and `extras_items`, or the getters `get_extra` and</span>
<span class="sd">            `get_extra_many` instead.</span>

<span class="sd">        :return: the extras as a dictionary</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dbmodel</span><span class="o">.</span><span class="n">extras</span>

<div class="viewcode-block" id="SqlaNode.get_extra"><a class="viewcode-back" href="../../../../../apidoc/aiida.orm.implementation.sqlalchemy.html#aiida.orm.implementation.sqlalchemy.nodes.SqlaNode.get_extra">[docs]</a>    <span class="k">def</span> <span class="nf">get_extra</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the value of an extra.</span>

<span class="sd">        .. warning:: While the node is unstored, this will return a reference of the extra on the database model,</span>
<span class="sd">            meaning that changes on the returned value (if they are mutable themselves, e.g. a list or dictionary) will</span>
<span class="sd">            automatically be reflected on the database model as well. As soon as the node is stored, the returned extra</span>
<span class="sd">            will be a deep copy and mutations of the database extras will have to go through the appropriate set</span>
<span class="sd">            methods.</span>

<span class="sd">        :param key: name of the extra</span>
<span class="sd">        :return: the value of the extra</span>
<span class="sd">        :raises AttributeError: if the extra does not exist</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dbmodel</span><span class="o">.</span><span class="n">extras</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span> <span class="k">as</span> <span class="n">exception</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s1">&#39;extra `</span><span class="si">{}</span><span class="s1">` does not exist&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">exception</span><span class="p">))</span></div>

<div class="viewcode-block" id="SqlaNode.get_extra_many"><a class="viewcode-back" href="../../../../../apidoc/aiida.orm.implementation.sqlalchemy.html#aiida.orm.implementation.sqlalchemy.nodes.SqlaNode.get_extra_many">[docs]</a>    <span class="k">def</span> <span class="nf">get_extra_many</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">keys</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the values of multiple extras.</span>

<span class="sd">        .. warning:: While the node is unstored, this will return references of the extras on the database model,</span>
<span class="sd">            meaning that changes on the returned values (if they are mutable themselves, e.g. a list or dictionary) will</span>
<span class="sd">            automatically be reflected on the database model as well. As soon as the node is stored, the returned extras</span>
<span class="sd">            will be a deep copy and mutations of the database extras will have to go through the appropriate set</span>
<span class="sd">            methods. Therefore, once stored, retrieving a deep copy can be a heavy operation. If you only need the keys</span>
<span class="sd">            or some values, use the iterators `extras_keys` and `extras_items`, or the getters `get_extra` and</span>
<span class="sd">            `get_extra_many` instead.</span>

<span class="sd">        :param keys: a list of extra names</span>
<span class="sd">        :return: a list of extra values</span>
<span class="sd">        :raises AttributeError: if at least one extra does not exist</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">get_extra</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span> <span class="k">as</span> <span class="n">exception</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s1">&#39;extra `</span><span class="si">{}</span><span class="s1">` does not exist&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">exception</span><span class="p">))</span></div>

<div class="viewcode-block" id="SqlaNode.set_extra"><a class="viewcode-back" href="../../../../../apidoc/aiida.orm.implementation.sqlalchemy.html#aiida.orm.implementation.sqlalchemy.nodes.SqlaNode.set_extra">[docs]</a>    <span class="k">def</span> <span class="nf">set_extra</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set an extra to the given value.</span>

<span class="sd">        :param key: name of the extra</span>
<span class="sd">        :param value: value of the extra</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_stored</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">clean_value</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_dbmodel</span><span class="o">.</span><span class="n">extras</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_flag_field</span><span class="p">(</span><span class="s1">&#39;extras&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_flush_if_stored</span><span class="p">()</span></div>

<div class="viewcode-block" id="SqlaNode.set_extra_many"><a class="viewcode-back" href="../../../../../apidoc/aiida.orm.implementation.sqlalchemy.html#aiida.orm.implementation.sqlalchemy.nodes.SqlaNode.set_extra_many">[docs]</a>    <span class="k">def</span> <span class="nf">set_extra_many</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">extras</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set multiple extras.</span>

<span class="sd">        .. note:: This will override any existing extras that are present in the new dictionary.</span>

<span class="sd">        :param extras: a dictionary with the extras to set</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_stored</span><span class="p">:</span>
            <span class="n">extras</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="p">:</span> <span class="n">clean_value</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">extras</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>

        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">extras</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dbmodel</span><span class="o">.</span><span class="n">extras</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_flag_field</span><span class="p">(</span><span class="s1">&#39;extras&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_flush_if_stored</span><span class="p">()</span></div>

<div class="viewcode-block" id="SqlaNode.reset_extras"><a class="viewcode-back" href="../../../../../apidoc/aiida.orm.implementation.sqlalchemy.html#aiida.orm.implementation.sqlalchemy.nodes.SqlaNode.reset_extras">[docs]</a>    <span class="k">def</span> <span class="nf">reset_extras</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">extras</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Reset the extras.</span>

<span class="sd">        .. note:: This will completely clear any existing extras and replace them with the new dictionary.</span>

<span class="sd">        :param extras: a dictionary with the extras to set</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dbmodel</span><span class="o">.</span><span class="n">extras</span> <span class="o">=</span> <span class="n">extras</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_flag_field</span><span class="p">(</span><span class="s1">&#39;extras&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_flush_if_stored</span><span class="p">()</span></div>

<div class="viewcode-block" id="SqlaNode.delete_extra"><a class="viewcode-back" href="../../../../../apidoc/aiida.orm.implementation.sqlalchemy.html#aiida.orm.implementation.sqlalchemy.nodes.SqlaNode.delete_extra">[docs]</a>    <span class="k">def</span> <span class="nf">delete_extra</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Delete an extra.</span>

<span class="sd">        :param key: name of the extra</span>
<span class="sd">        :raises AttributeError: if the extra does not exist</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_dbmodel</span><span class="o">.</span><span class="n">extras</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">KeyError</span> <span class="k">as</span> <span class="n">exception</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s1">&#39;extra `</span><span class="si">{}</span><span class="s1">` does not exist&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">exception</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_flag_field</span><span class="p">(</span><span class="s1">&#39;extras&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_flush_if_stored</span><span class="p">()</span></div>

<div class="viewcode-block" id="SqlaNode.delete_extra_many"><a class="viewcode-back" href="../../../../../apidoc/aiida.orm.implementation.sqlalchemy.html#aiida.orm.implementation.sqlalchemy.nodes.SqlaNode.delete_extra_many">[docs]</a>    <span class="k">def</span> <span class="nf">delete_extra_many</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">keys</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Delete multiple extras.</span>

<span class="sd">        :param keys: names of the extras to delete</span>
<span class="sd">        :raises AttributeError: if at least one of the extra does not exist</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">non_existing_keys</span> <span class="o">=</span> <span class="p">[</span><span class="n">key</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">keys</span> <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dbmodel</span><span class="o">.</span><span class="n">extras</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">non_existing_keys</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s1">&#39;extras `</span><span class="si">{}</span><span class="s1">` do not exist&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">non_existing_keys</span><span class="p">)))</span>

        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dbmodel</span><span class="o">.</span><span class="n">extras</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_flag_field</span><span class="p">(</span><span class="s1">&#39;extras&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_flush_if_stored</span><span class="p">()</span></div>

<div class="viewcode-block" id="SqlaNode.clear_extras"><a class="viewcode-back" href="../../../../../apidoc/aiida.orm.implementation.sqlalchemy.html#aiida.orm.implementation.sqlalchemy.nodes.SqlaNode.clear_extras">[docs]</a>    <span class="k">def</span> <span class="nf">clear_extras</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Delete all extras.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dbmodel</span><span class="o">.</span><span class="n">extras</span> <span class="o">=</span> <span class="p">{}</span></div>

<div class="viewcode-block" id="SqlaNode.extras_items"><a class="viewcode-back" href="../../../../../apidoc/aiida.orm.implementation.sqlalchemy.html#aiida.orm.implementation.sqlalchemy.nodes.SqlaNode.extras_items">[docs]</a>    <span class="k">def</span> <span class="nf">extras_items</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return an iterator over the extras.</span>

<span class="sd">        :return: an iterator with extra key value pairs</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dbmodel</span><span class="o">.</span><span class="n">extras</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">yield</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span></div>

<div class="viewcode-block" id="SqlaNode.extras_keys"><a class="viewcode-back" href="../../../../../apidoc/aiida.orm.implementation.sqlalchemy.html#aiida.orm.implementation.sqlalchemy.nodes.SqlaNode.extras_keys">[docs]</a>    <span class="k">def</span> <span class="nf">extras_keys</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return an iterator over the extra keys.</span>

<span class="sd">        :return: an iterator with extra keys</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dbmodel</span><span class="o">.</span><span class="n">extras</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">yield</span> <span class="n">key</span></div>

<div class="viewcode-block" id="SqlaNode._flag_field"><a class="viewcode-back" href="../../../../../apidoc/aiida.orm.implementation.sqlalchemy.html#aiida.orm.implementation.sqlalchemy.nodes.SqlaNode._flag_field">[docs]</a>    <span class="k">def</span> <span class="nf">_flag_field</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">field</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">aiida.backends.sqlalchemy.utils</span> <span class="kn">import</span> <span class="n">flag_modified</span>
        <span class="n">flag_modified</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dbmodel</span><span class="p">,</span> <span class="n">field</span><span class="p">)</span></div>

<div class="viewcode-block" id="SqlaNode._flush_if_stored"><a class="viewcode-back" href="../../../../../apidoc/aiida.orm.implementation.sqlalchemy.html#aiida.orm.implementation.sqlalchemy.nodes.SqlaNode._flush_if_stored">[docs]</a>    <span class="k">def</span> <span class="nf">_flush_if_stored</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dbmodel</span><span class="o">.</span><span class="n">is_saved</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_dbmodel</span><span class="o">.</span><span class="n">save</span><span class="p">()</span></div>

<div class="viewcode-block" id="SqlaNode.add_incoming"><a class="viewcode-back" href="../../../../../apidoc/aiida.orm.implementation.sqlalchemy.html#aiida.orm.implementation.sqlalchemy.nodes.SqlaNode.add_incoming">[docs]</a>    <span class="k">def</span> <span class="nf">add_incoming</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">link_type</span><span class="p">,</span> <span class="n">link_label</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Add a link of the given type from a given node to ourself.</span>

<span class="sd">        :param source: the node from which the link is coming</span>
<span class="sd">        :param link_type: the link type</span>
<span class="sd">        :param link_label: the link label</span>
<span class="sd">        :return: True if the proposed link is allowed, False otherwise</span>
<span class="sd">        :raise aiida.common.ModificationNotAllowed: if either source or target node is not stored</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">session</span> <span class="o">=</span> <span class="n">get_scoped_session</span><span class="p">()</span>

        <span class="n">type_check</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">SqlaNode</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_stored</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">exceptions</span><span class="o">.</span><span class="n">ModificationNotAllowed</span><span class="p">(</span><span class="s1">&#39;node has to be stored when adding an incoming link&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">source</span><span class="o">.</span><span class="n">is_stored</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">exceptions</span><span class="o">.</span><span class="n">ModificationNotAllowed</span><span class="p">(</span><span class="s1">&#39;source node has to be stored when adding a link from it&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_add_link</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">link_type</span><span class="p">,</span> <span class="n">link_label</span><span class="p">)</span>
        <span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span></div>

<div class="viewcode-block" id="SqlaNode._add_link"><a class="viewcode-back" href="../../../../../apidoc/aiida.orm.implementation.sqlalchemy.html#aiida.orm.implementation.sqlalchemy.nodes.SqlaNode._add_link">[docs]</a>    <span class="k">def</span> <span class="nf">_add_link</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">link_type</span><span class="p">,</span> <span class="n">link_label</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Add a link of the given type from a given node to ourself.</span>

<span class="sd">        :param source: the node from which the link is coming</span>
<span class="sd">        :param link_type: the link type</span>
<span class="sd">        :param link_label: the link label</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">aiida.backends.sqlalchemy.models.node</span> <span class="kn">import</span> <span class="n">DbLink</span>

        <span class="n">session</span> <span class="o">=</span> <span class="n">get_scoped_session</span><span class="p">()</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">session</span><span class="o">.</span><span class="n">begin_nested</span><span class="p">():</span>
                <span class="n">link</span> <span class="o">=</span> <span class="n">DbLink</span><span class="p">(</span><span class="n">input_id</span><span class="o">=</span><span class="n">source</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">output_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">link_label</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="n">link_type</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
                <span class="n">session</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">link</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">SQLAlchemyError</span> <span class="k">as</span> <span class="n">exception</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">exceptions</span><span class="o">.</span><span class="n">UniquenessError</span><span class="p">(</span><span class="s1">&#39;failed to create the link: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">exception</span><span class="p">))</span></div>

<div class="viewcode-block" id="SqlaNode.clean_values"><a class="viewcode-back" href="../../../../../apidoc/aiida.orm.implementation.sqlalchemy.html#aiida.orm.implementation.sqlalchemy.nodes.SqlaNode.clean_values">[docs]</a>    <span class="k">def</span> <span class="nf">clean_values</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dbmodel</span><span class="o">.</span><span class="n">attributes</span> <span class="o">=</span> <span class="n">clean_value</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dbmodel</span><span class="o">.</span><span class="n">attributes</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dbmodel</span><span class="o">.</span><span class="n">extras</span> <span class="o">=</span> <span class="n">clean_value</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dbmodel</span><span class="o">.</span><span class="n">extras</span><span class="p">)</span></div>

<div class="viewcode-block" id="SqlaNode.store"><a class="viewcode-back" href="../../../../../apidoc/aiida.orm.implementation.sqlalchemy.html#aiida.orm.implementation.sqlalchemy.nodes.SqlaNode.store">[docs]</a>    <span class="k">def</span> <span class="nf">store</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">links</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">with_transaction</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">clean</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>  <span class="c1"># pylint: disable=arguments-differ</span>
        <span class="sd">&quot;&quot;&quot;Store the node in the database.</span>

<span class="sd">        :param links: optional links to add before storing</span>
<span class="sd">        :param with_transaction: if False, do not use a transaction because the caller will already have opened one.</span>
<span class="sd">        :param clean: boolean, if True, will clean the attributes and extras before attempting to store</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">session</span> <span class="o">=</span> <span class="n">get_scoped_session</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">clean</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clean_values</span><span class="p">()</span>

        <span class="n">session</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dbmodel</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">links</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">link_triple</span> <span class="ow">in</span> <span class="n">links</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_add_link</span><span class="p">(</span><span class="o">*</span><span class="n">link_triple</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">with_transaction</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
            <span class="k">except</span> <span class="n">SQLAlchemyError</span><span class="p">:</span>
                <span class="n">session</span><span class="o">.</span><span class="n">rollback</span><span class="p">()</span>
                <span class="k">raise</span>

        <span class="k">return</span> <span class="bp">self</span></div></div>


<div class="viewcode-block" id="SqlaNodeCollection"><a class="viewcode-back" href="../../../../../apidoc/aiida.orm.implementation.sqlalchemy.html#aiida.orm.implementation.sqlalchemy.nodes.SqlaNodeCollection">[docs]</a><span class="k">class</span> <span class="nc">SqlaNodeCollection</span><span class="p">(</span><span class="n">BackendNodeCollection</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;The collection of Node entries.&quot;&quot;&quot;</span>

    <span class="n">ENTITY_CLASS</span> <span class="o">=</span> <span class="n">SqlaNode</span>

<div class="viewcode-block" id="SqlaNodeCollection.get"><a class="viewcode-back" href="../../../../../apidoc/aiida.orm.implementation.sqlalchemy.html#aiida.orm.implementation.sqlalchemy.nodes.SqlaNodeCollection.get">[docs]</a>    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pk</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a Node entry from the collection with the given id</span>

<span class="sd">        :param pk: id of the node</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">session</span> <span class="o">=</span> <span class="n">get_scoped_session</span><span class="p">()</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ENTITY_CLASS</span><span class="o">.</span><span class="n">from_dbmodel</span><span class="p">(</span><span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">DbNode</span><span class="p">)</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">pk</span><span class="p">)</span><span class="o">.</span><span class="n">one</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">backend</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">NoResultFound</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">exceptions</span><span class="o">.</span><span class="n">NotExistent</span><span class="p">(</span><span class="s2">&quot;Node with pk &#39;</span><span class="si">{}</span><span class="s2">&#39; not found&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pk</span><span class="p">))</span></div>

<div class="viewcode-block" id="SqlaNodeCollection.delete"><a class="viewcode-back" href="../../../../../apidoc/aiida.orm.implementation.sqlalchemy.html#aiida.orm.implementation.sqlalchemy.nodes.SqlaNodeCollection.delete">[docs]</a>    <span class="k">def</span> <span class="nf">delete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pk</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Remove a Node entry from the collection with the given id</span>

<span class="sd">        :param pk: id of the node to delete</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">session</span> <span class="o">=</span> <span class="n">get_scoped_session</span><span class="p">()</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">DbNode</span><span class="p">)</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">pk</span><span class="p">)</span><span class="o">.</span><span class="n">one</span><span class="p">()</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
            <span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
        <span class="k">except</span> <span class="n">NoResultFound</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">exceptions</span><span class="o">.</span><span class="n">NotExistent</span><span class="p">(</span><span class="s2">&quot;Node with pk &#39;</span><span class="si">{}</span><span class="s2">&#39; not found&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pk</span><span class="p">))</span></div></div>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, ECOLE POLYTECHNIQUE FEDERALE DE LAUSANNE (Theory and Simulation of Materials (THEOS) and National Centre for Computational Design and Discovery of Novel Materials (NCCR MARVEL)), Switzerland and ROBERT BOSCH LLC, USA. All rights reserved

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>