<!doctype html>
<html class="no-js" lang="en" data-content_root="../">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="index" title="Index" href="../genindex.html" /><link rel="search" title="Search" href="../search.html" /><link rel="prev" title="VS Code Extension" href="../components/vscode_extension.html" />

    <!-- Generated with Sphinx 7.3.7 and Furo 2024.05.06 -->
        <title>Development - Sphinx Language Support v0.0.6</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo.css?v=387cc868" />
    <link rel="stylesheet" type="text/css" href="../_static/graphviz.css?v=fd3f3429" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=87e54e7c" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo-extensions.css?v=36a5483c" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" /
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../index.html"><div class="brand">Sphinx Language Support v0.0.6</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../index.html">
  
  
  <span class="sidebar-brand-text">Sphinx Language Support v0.0.6</span>
  
</a><form class="sidebar-search-container" method="get" action="../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul>
<li class="toctree-l1"><a class="reference internal" href="../index.html">Quick Start</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">User Guides</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../usage/configuration.html">Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../usage/how_it_works.html">How it works</a></li>
<li class="toctree-l1"><a class="reference internal" href="../usage/troubleshooting.html">Troubleshooting</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Components</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../components/sphinx_db.html"><code class="docutils literal notranslate"><span class="pre">sphinx_db</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../components/sphinx_indexer.html"><code class="docutils literal notranslate"><span class="pre">sphinx_indexer</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../components/sphinx_lsp.html"><code class="docutils literal notranslate"><span class="pre">sphinx_lsp</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../components/vscode_extension.html">VS Code Extension</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Development</span></p>
<ul class="current">
<li class="toctree-l1 current current-page"><a class="current reference internal" href="#">Development</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="view-this-page">
  <a class="muted-link" href="../_sources/development/index.rst.txt" title="View this page">
    <svg><use href="#svg-eye"></use></svg>
    <span class="visually-hidden">View this page</span>
  </a>
</div>
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <section id="development">
<span id="id1"></span><h1>Development<a class="headerlink" href="#development" title="Link to this heading">¬∂</a></h1>
<section id="repository-structure">
<h2>Repository structure<a class="headerlink" href="#repository-structure" title="Link to this heading">¬∂</a></h2>
<p>This repository is a monorepo, consisting of the following packages:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">python/</span></code>: Contains the python packages.</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">rst_fast_parse/</span></code>: A fast parser for reStructuredText.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sphinx_db/</span></code>: An ORM schema for the sphinx index database.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sphinx_indexer/</span></code>: A Sphinx extension for creating a index database, during a Sphinx build.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sphinx_lsp/</span></code>: A language server for Sphinx documentation projects.</p>
<p>This reads from the sphinx index database and provides language server capabilities.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">vscode_uri/</span></code>: A library for handling URIs in language servers.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">vscode/</span></code>: Contains the code for the VS Code Extension.</p>
<ul class="simple">
<li><p>This is principally the language client, which starts and communicates with the language server.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">docs/</span></code>: Contains the documentation.</p></li>
</ul>
</section>
<section id="formatting-and-linting">
<h2>Formatting and linting<a class="headerlink" href="#formatting-and-linting" title="Link to this heading">¬∂</a></h2>
<p>The easiest way to run the formatting and linting is to use the <a class="reference external" href="https://pre-commit.com/">pre-commit</a> tool.
Install it, then run:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pre</span><span class="o">-</span><span class="n">commit</span> <span class="n">run</span> <span class="o">--</span><span class="nb">all</span>
</pre></div>
</div>
<p>This will run formatting and linting on all files in the repository (principally using <a class="reference external" href="https://docs.astral.sh/ruff/">ruff</a> and <a class="reference external" href="https://eslint.org/">eslint</a>).</p>
<p>To install as a pre-commit hook:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pre</span><span class="o">-</span><span class="n">commit</span> <span class="n">install</span>
</pre></div>
</div>
</section>
<section id="managing-the-python-code">
<h2>Managing the Python code<a class="headerlink" href="#managing-the-python-code" title="Link to this heading">¬∂</a></h2>
<p>The python code is managed principally using <a class="reference external" href="https://rye.astral.sh/">rye</a>, to manage a workspace of multiple packages.</p>
<p>Here are some useful commands (run from the root of the repository):</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">rye</span> <span class="pre">sync</span></code>: Create/update a virtualenv for the repository (in <code class="docutils literal notranslate"><span class="pre">.venv</span></code>).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">rye</span> <span class="pre">test</span> <span class="pre">-a</span></code>: Run the tests, against each package.
- <code class="docutils literal notranslate"><span class="pre">rye</span> <span class="pre">test</span> <span class="pre">-a</span> <span class="pre">--</span> <span class="pre">--cov=src</span></code>: Run the tests, with coverage, against each package.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">rye</span> <span class="pre">run</span> <span class="pre">check</span></code>: Run all of ruff formatting and linting, and mypy, for the entire repository.
- <code class="docutils literal notranslate"><span class="pre">rye</span> <span class="pre">format</span></code>: Code formatter (ruff), for the entire repository.
- <code class="docutils literal notranslate"><span class="pre">rye</span> <span class="pre">lint</span></code>: Run the linter (ruff), for the entire repository.
- <code class="docutils literal notranslate"><span class="pre">rye</span> <span class="pre">run</span> <span class="pre">mypy:all</span></code>: Run mypy, against each package.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">rye</span> <span class="pre">run</span> <span class="pre">docs:clean</span></code>: Build the documentation (removing any previous build first).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">rye</span> <span class="pre">run</span> <span class="pre">bumpver</span> <span class="pre">update</span> <span class="pre">--patch</span> <span class="pre">--dry</span></code>: Dry run of bumping the version number, across all packages.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">rye</span> <span class="pre">run</span> <span class="pre">bundle:dev</span></code>: Run a development install of packages into <code class="docutils literal notranslate"><span class="pre">vscode/bundled</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">rye</span> <span class="pre">run</span> <span class="pre">bundle:prod</span></code>: Run a production install of packages into <code class="docutils literal notranslate"><span class="pre">vscode/bundled</span></code>.</p></li>
</ul>
</section>
<section id="managing-the-vs-code-extension">
<h2>Managing the VS Code Extension<a class="headerlink" href="#managing-the-vs-code-extension" title="Link to this heading">¬∂</a></h2>
<p>The Typescript code is managed using <a class="reference external" href="https://www.npmjs.com/">npm</a>.</p>
<p>To run the extension in development mode, you must first install the dependencies into <code class="docutils literal notranslate"><span class="pre">vscode/node_modules</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="n">vscode</span>
<span class="n">npm</span> <span class="n">install</span>
</pre></div>
</div>
<p>You also need to install the Python bundled libraries into <code class="docutils literal notranslate"><span class="pre">vscode/bundled</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">rye</span> <span class="n">run</span> <span class="n">bundle</span><span class="p">:</span><span class="n">dev</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><code class="docutils literal notranslate"><span class="pre">bundle:dev</span></code> installs the libraries in development mode,
so that local changes to the libraries are reflected in the extension, without needing to reinstall,
although you will need to run the command ‚ÄúSphinx: Restart Server‚Äù command in VS Code.</p>
</div>
<p>Now, within a VS Code Window, you can press <code class="docutils literal notranslate"><span class="pre">F5</span></code> to start the extension in a new window
(or Select <cite>VSCode Extension</cite> from the ‚ÄúRun and Debug View‚Äù in the Sidebar).</p>
</section>
<section id="packaging-the-vs-code-extension">
<h2>Packaging the VS Code Extension<a class="headerlink" href="#packaging-the-vs-code-extension" title="Link to this heading">¬∂</a></h2>
<p>Packaging the extension involves creating a <code class="docutils literal notranslate"><span class="pre">.vsix</span></code> file (see <a class="reference external" href="https://code.visualstudio.com/api/working-with-extensions/publishing-extension#packaging-extensions">https://code.visualstudio.com/api/working-with-extensions/publishing-extension#packaging-extensions</a>).</p>
<p>First you may want to update the version numbers across the repository, e.g.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">rye</span> <span class="n">run</span> <span class="n">bumpver</span> <span class="n">update</span> <span class="o">--</span><span class="n">patch</span> <span class="o">--</span><span class="n">dry</span>
</pre></div>
</div>
<p>As above, you need to install the Javascript and Python dependencies into <code class="docutils literal notranslate"><span class="pre">vscode/node_modules</span></code> and <code class="docutils literal notranslate"><span class="pre">vscode/bundled</span></code> respectively.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>You must run <code class="docutils literal notranslate"><span class="pre">rye</span> <span class="pre">run</span> <span class="pre">bundle:prod</span></code> to install the Python libraries,
which will install the libraries in production mode, so that the libraries are not pointing to the local source code which is not included in the extension.</p>
</div>
<p>Then, you can run the following command to create the <code class="docutils literal notranslate"><span class="pre">.vsix</span></code> file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="n">vscode</span>
<span class="n">vsce</span> <span class="n">package</span> <span class="o">--</span><span class="n">pre</span><span class="o">-</span><span class="n">release</span>
</pre></div>
</div>
<p>This can be published to the Marketplace, or installed locally.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Currently all the bundled Python libraries are universal wheels,
and so it should not be necessary to perform platform-specific builds: <a class="reference external" href="https://code.visualstudio.com/api/working-with-extensions/publishing-extension#platformspecific-extensions">https://code.visualstudio.com/api/working-with-extensions/publishing-extension#platformspecific-extensions</a></p>
</div>
</section>
<section id="design-notes">
<h2>Design notes<a class="headerlink" href="#design-notes" title="Link to this heading">¬∂</a></h2>
<section id="why-rye">
<h3>Why rye?<a class="headerlink" href="#why-rye" title="Link to this heading">¬∂</a></h3>
<p>At the time of writing, the <a class="reference external" href="https://rye.astral.sh/">rye</a> is the only tool
that has a good story for working with a monorepo of multiple python packages.</p>
<p>It also has nice integrations with ruff etc.</p>
<p>Note, in the future, it looks like <code class="docutils literal notranslate"><span class="pre">uv</span></code> will subsume <code class="docutils literal notranslate"><span class="pre">rye</span></code>,
but with a ‚Äúclear migration path‚Äù (<a class="reference external" href="https://github.com/astral-sh/rye/discussions/1164#discussioncomment-9812734">https://github.com/astral-sh/rye/discussions/1164#discussioncomment-9812734</a>).</p>
<p>There is also work in hatch: <a class="reference external" href="https://github.com/pypa/hatch/issues/233#issuecomment-2132250445">https://github.com/pypa/hatch/issues/233#issuecomment-2132250445</a></p>
</section>
<section id="why-pygls">
<h3>Why pygls?<a class="headerlink" href="#why-pygls" title="Link to this heading">¬∂</a></h3>
<p>The <a class="reference external" href="https://microsoft.github.io/language-server-protocol/">language server protocol</a> is programming language agnostic
and so, in theory, any language can be used to implement the language server.
This is also made possible, by the creation of an sqlite database in the sphinx build which is also language agnostic.</p>
<p>There are benefits to writing the language server in TypeScript,
since <a class="reference external" href="https://github.com/microsoft/vscode-languageserver-node">https://github.com/microsoft/vscode-languageserver-node</a> is in essence the reference implementation,
and also since VS Code already ships with a NodeJS runtime,
so we wouldn‚Äôt have to worry about setting up the language server for the users system.</p>
<p>However, I run in to a problem when looking to use an sqlite library
(I was intending to use <a class="reference external" href="https://github.com/WiseLibs/better-sqlite3">https://github.com/WiseLibs/better-sqlite3</a> via <a class="reference external" href="https://orm.drizzle.team/docs/get-started-sqlite#better-sqlite3">https://orm.drizzle.team/docs/get-started-sqlite#better-sqlite3</a>).
This is built against certain NodeJS version / Operating System,
and so now you would essentially need some way to ship all builds and choose on-the-fly which one to use based on the users system üòï.
(see also <a class="reference external" href="https://stackoverflow.com/a/76866302">https://stackoverflow.com/a/76866302</a> and <a class="reference external" href="https://github.com/microsoft/vscode-discussions/discussions/16">https://github.com/microsoft/vscode-discussions/discussions/16</a>).</p>
<p>Given that Sphinx is a Python project, and since all python distributions come with sqlite3 built-in,
using python for the language server is the other obvious choice.
Although it introduces complications, in selecting a Python runtime, and injecting the language server into it,
this does come with the benefit of being able to share a common sqlite ORM between the indexer and the language server,
and making it easier for users to extend the language server with Python code.</p>
</section>
<section id="python-environment-discovery">
<h3>Python environment discovery<a class="headerlink" href="#python-environment-discovery" title="Link to this heading">¬∂</a></h3>
<p>The language server needs to be able to use a Python environment, within which to run the Sphinx language server.</p>
<p>This code is included in <code class="file docutils literal notranslate"><span class="pre">vscode/src/python.ts</span></code>,
and is principally based on the code in:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/microsoft/vscode-mypy/tree/v2023.6.0">https://github.com/microsoft/vscode-mypy/tree/v2023.6.0</a></p></li>
<li><p><a class="reference external" href="https://github.com/astral-sh/ruff-vscode/tree/2024.34.0">https://github.com/astral-sh/ruff-vscode/tree/2024.34.0</a></p></li>
</ul>
</section>
<section id="html-preview">
<h3>HTML Preview<a class="headerlink" href="#html-preview" title="Link to this heading">¬∂</a></h3>
<p>The HTML preview functionality is principally delegated to <a class="reference external" href="https://github.com/microsoft/vscode-livepreview">https://github.com/microsoft/vscode-livepreview</a>;
on a preview command, the extension will first ‚Äúask‚Äù the language server to provide the related HTML file given the source file,
and then a command is sent to the Live Preview extension to open the HTML file.
This also handles watching the HTML file for changes and updating the preview, etc.</p>
<p>By delegating to the Live Preview extension, we can avoid having to write/maintain our own HTML previewer,
I‚Äôm sure microsoft is can do a better job of it than us üòÑ.</p>
<p>The only feature currently missing is the ability to sync the position in the source file with the preview.
There are ways to pass messages to the WebView (<a class="reference external" href="https://code.visualstudio.com/api/extension-guides/webview#scripts-and-message-passing">https://code.visualstudio.com/api/extension-guides/webview#scripts-and-message-passing</a>),
and there is a feature request for this: <a class="reference external" href="https://github.com/microsoft/vscode-livepreview/issues/214">https://github.com/microsoft/vscode-livepreview/issues/214</a>.</p>
</section>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          
          <a class="prev-page" href="../components/vscode_extension.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">VS Code Extension</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2024, Chris Sewell
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Development</a><ul>
<li><a class="reference internal" href="#repository-structure">Repository structure</a></li>
<li><a class="reference internal" href="#formatting-and-linting">Formatting and linting</a></li>
<li><a class="reference internal" href="#managing-the-python-code">Managing the Python code</a></li>
<li><a class="reference internal" href="#managing-the-vs-code-extension">Managing the VS Code Extension</a></li>
<li><a class="reference internal" href="#packaging-the-vs-code-extension">Packaging the VS Code Extension</a></li>
<li><a class="reference internal" href="#design-notes">Design notes</a><ul>
<li><a class="reference internal" href="#why-rye">Why rye?</a></li>
<li><a class="reference internal" href="#why-pygls">Why pygls?</a></li>
<li><a class="reference internal" href="#python-environment-discovery">Python environment discovery</a></li>
<li><a class="reference internal" href="#html-preview">HTML Preview</a></li>
</ul>
</li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="../_static/documentation_options.js?v=1fd71caa"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/scripts/furo.js?v=4e2eecee"></script>
    <script src="../_static/design-tabs.js?v=f930bc37"></script>
    </body>
</html>